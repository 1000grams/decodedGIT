StagesAvailable:
- Original
- Processed
TemplateBody: !!omap
- Description: (SO0276) - generative-ai-application-builder-on-aws - DeploymentPlatformStack
    - Version v3.0.0
- Metadata: !!omap
  - AWS::CloudFormation::Interface: !!omap
    - ParameterGroups:
      - !!omap
        - Label: !!omap
          - default: Please provide admin user email
        - Parameters:
          - AdminUserEmail
      - !!omap
        - Label: !!omap
          - default: 'Optional: If you would like to deploy the solution with a VPC
              Configuration'
        - Parameters:
          - VpcEnabled
          - CreateNewVpc
          - IPAMPoolId
      - !!omap
        - Label: !!omap
          - default: 'Optional: If you would like to deploy the solution with a Web
              Application'
        - Parameters:
          - DeployUI
      - !!omap
        - Label: !!omap
          - default: 'Optional: Existing VPC configuration to use, if you would like
              to deploy the solution in a VPC and with your existing VPC configuration.'
        - Parameters:
          - ExistingVpcId
          - ExistingPrivateSubnetIds
          - ExistingSecurityGroupIds
          - VpcAzs
      - !!omap
        - Label: !!omap
          - default: 'Optional: If you would like to provide a sub domain for the
              UserPoolClient configuration. If not provided, a hashed value using
              the AWS Account number, current region, and stack name, will be used
              as sub-domain name'
        - Parameters:
          - CognitoDomainPrefix
      - !!omap
        - Label: !!omap
          - default: 'Optional: If you would like to provide a Cognito UserPool and
              UserPoolClient, you can pass their IDs here. Otherwise, a new pool and
              client will be created for you'
        - Parameters:
          - ExistingCognitoUserPoolId
          - ExistingCognitoUserPoolClient
- Parameters: !!omap
  - VpcEnabled: !!omap
    - Type: String
    - Default: No
    - AllowedPattern: ^Yes|No$
    - AllowedValues:
      - Yes
      - No
    - Description: Should the stacks resources be deployed within a VPC
  - CreateNewVpc: !!omap
    - Type: String
    - Default: No
    - AllowedPattern: ^Yes|No$
    - AllowedValues:
      - Yes
      - No
    - Description: Select "Yes", if you would like to create a new VPC
  - IPAMPoolId: !!omap
    - Type: String
    - Default: ''
    - AllowedPattern: ^$|^ipam-pool-([0-9a-zA-Z])+$
    - ConstraintDescription: The provided IPAM Pool Id is not a valid format. IPAM
        Id should be be of the following format "^ipam-pool-([0-9a-zA-Z])+$"
    - Description: If you would like to assign the CIDR range using AWS VPC IP Address
        Manager, please provide the IPAM pool Id to use
    - MaxLength: 50
  - DeployUI: !!omap
    - Type: String
    - Default: Yes
    - AllowedValues:
      - Yes
      - No
    - Description: Please select the option to deploy the front end UI for this deployment.
        Selecting No, will only create the infrastructure to host the APIs, the authentication
        for the APIs, and backend processing
  - CognitoDomainPrefix: !!omap
    - Type: String
    - Default: ''
    - AllowedPattern: ^$|^[a-z0-9](?:[a-z0-9\-]{0,61}[a-z0-9])?$
    - ConstraintDescription: The provided domain prefix is not a valid format. The
        domain prefix should be be of the following format "^[a-z0-9](?:[a-z0-9\-]{0,61}[a-z0-9])?$"
    - Description: If you would like to provide a domain for the Cognito User Pool
        Client, please enter a value. If a value is not provided, the deployment will
        generate one
    - MaxLength: 63
  - ExistingVpcId: !!omap
    - Type: String
    - Default: ''
    - AllowedPattern: ^$|^vpc-\w{8}(\w{9})?$
    - Description: VPC ID of an existing VPC to be used for the use case.
  - ExistingPrivateSubnetIds: !!omap
    - Type: CommaDelimitedList
    - Default: ''
    - AllowedPattern: ^$|^subnet-\w{8}(\w{9})?$
    - ConstraintDescription: If using an existing VPC configuration, please provide
        a valid list of subnet Ids for AWS Lambda function configuration
    - Description: Comma separated list of subnet IDs of existing private subnets
        to be used to deploy the AWS Lambda function
  - VpcAzs: !!omap
    - Type: CommaDelimitedList
    - Default: ''
    - AllowedPattern: ^$|^[a-z0-9-]+$
    - ConstraintDescription: If using an existing VPC, please provide a valid list
        of AZs
    - Description: Comma separated list of AZs in which subnets of the VPCs are created
  - ExistingSecurityGroupIds: !!omap
    - Type: CommaDelimitedList
    - Default: ''
    - AllowedPattern: ^$|^sg-\w{8}(\w{9})?$
    - ConstraintDescription: If using an existing VPC, please provide a valid list
        of Security Group IDs for AWS Lambda function configuration
    - Description: Comma separated list of security groups of the existing vpc to
        be used for configuring lambda functions
  - AdminUserEmail: !!omap
    - Type: String
    - AllowedPattern: '[A-Za-z0-9_!#$%&''*+/=?`{|}~^.-]+@[A-Za-z0-9.-]+$'
    - ConstraintDescription: Please provide a valid email
    - Description: Email required to create the default user for the admin platform
  - ExistingCognitoUserPoolId: !!omap
    - Type: String
    - Default: ''
    - AllowedPattern: ^$|^[0-9a-zA-Z_-]{9,24}$
    - Description: UserPoolId of an existing cognito user pool which this use case
        will be authenticated with. Typically will be provided when deploying from
        the deployment platform, but can be omitted when deploying this use-case stack
        standalone.
    - MaxLength: 24
  - ExistingCognitoUserPoolClient: !!omap
    - Type: String
    - Default: ''
    - AllowedPattern: ^$|^[a-z0-9]{3,128}$
    - Description: Optional - Provide a User Pool Client (App Client) to use an existing
        one. If not provided a new User Pool Client will be created. This parameter
        can only be provided if an existing User Pool Id is provided
    - MaxLength: 128
- Conditions: !!omap
  - VPCEnabledCondition: !!omap
    - Fn::Equals:
      - !!omap
        - Ref: VpcEnabled
      - Yes
  - CreateNewVPCCondition: !!omap
    - Fn::Equals:
      - !!omap
        - Ref: CreateNewVpc
      - Yes
  - DeployVPCCondition: !!omap
    - Fn::And:
      - !!omap
        - Condition: CreateNewVPCCondition
      - !!omap
        - Condition: VPCEnabledCondition
  - IPAMPoolIdProvidedCondition: !!omap
    - Fn::Not:
      - !!omap
        - Fn::Equals:
          - !!omap
            - Ref: IPAMPoolId
          - ''
  - AnonymousDataAWSCondition: !!omap
    - Fn::Equals:
      - !!omap
        - Fn::FindInMap:
          - Solution
          - Data
          - SendAnonymousUsageData
      - Yes
  - IsInternalUserCondition: !!omap
    - Fn::Equals:
      - !!omap
        - Fn::Select:
          - 0
          - !!omap
            - Fn::Split:
              - .
              - !!omap
                - Fn::Select:
                  - 1
                  - !!omap
                    - Fn::Split:
                      - '@'
                      - !!omap
                        - Ref: AdminUserEmail
      - amazon
  - DeployWebAppUIInfrastructureCondition: !!omap
    - Fn::Equals:
      - !!omap
        - Ref: DeployUI
      - Yes
  - UseCaseManagementSetupCreateApiResourcesConditionF9F71A85: !!omap
    - Fn::Equals:
      - 'true'
      - 'false'
  - UseCaseManagementSetupUseCaseEndpointSetupCreateApiRoutesCondition0060F23A: !!omap
    - Fn::Or:
      - !!omap
        - Fn::Equals:
          - DeploymentPlatform
          - DeploymentPlatform
      - !!omap
        - Condition: UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
  - UseCaseManagementSetupUseCaseEndpointSetupDeployVPCIfLambdaExistsFE27E265: !!omap
    - Fn::And:
      - !!omap
        - Condition: DeployVPCCondition
      - !!omap
        - Condition: UseCaseManagementSetupUseCaseEndpointSetupCreateApiRoutesCondition0060F23A
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentConditionE2E28337: !!omap
    - Fn::Equals:
      - 'true'
      - 'false'
  - CreateFeedbackResources: !!omap
    - Fn::Equals:
      - 'true'
      - 'true'
  - DeployCustomDashboard: !!omap
    - Fn::Equals:
      - !!omap
        - Fn::FindInMap:
          - FeaturesToDeploy
          - Deploy
          - CustomDashboard
      - Yes
  - CDKMetadataAvailable: !!omap
    - Fn::Or:
      - !!omap
        - Fn::Or:
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - af-south-1
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - ap-east-1
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - ap-northeast-1
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - ap-northeast-2
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - ap-northeast-3
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - ap-south-1
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - ap-south-2
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - ap-southeast-1
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - ap-southeast-2
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - ap-southeast-3
      - !!omap
        - Fn::Or:
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - ap-southeast-4
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - ca-central-1
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - ca-west-1
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - cn-north-1
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - cn-northwest-1
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - eu-central-1
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - eu-central-2
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - eu-north-1
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - eu-south-1
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - eu-south-2
      - !!omap
        - Fn::Or:
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - eu-west-1
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - eu-west-2
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - eu-west-3
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - il-central-1
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - me-central-1
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - me-south-1
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - sa-east-1
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - us-east-1
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - us-east-2
          - !!omap
            - Fn::Equals:
              - !!omap
                - Ref: AWS::Region
              - us-west-1
      - !!omap
        - Fn::Equals:
          - !!omap
            - Ref: AWS::Region
          - us-west-2
- Rules: !!omap
  - CheckIfVPCParamsProvided: !!omap
    - RuleCondition: !!omap
      - Fn::And:
        - !!omap
          - Fn::Equals:
            - !!omap
              - Ref: VpcEnabled
            - Yes
        - !!omap
          - Fn::Equals:
            - !!omap
              - Ref: CreateNewVpc
            - No
    - Assertions:
      - !!omap
        - Assert: !!omap
          - Fn::Not:
            - !!omap
              - Fn::Equals:
                - !!omap
                  - Ref: ExistingVpcId
                - ''
        - AssertDescription: To use existing VPC, you must provide a value for parameter
            ExistingVpcId
      - !!omap
        - Assert: !!omap
          - Fn::Not:
            - !!omap
              - Fn::Contains:
                - !!omap
                  - Ref: ExistingPrivateSubnetIds
                - ''
        - AssertDescription: To use existing VPC, private subnet Ids should be provided.
      - !!omap
        - Assert: !!omap
          - Fn::Not:
            - !!omap
              - Fn::Contains:
                - !!omap
                  - Ref: ExistingSecurityGroupIds
                - ''
        - AssertDescription: To use existing VPC, SecurityGroups associated with the
            subnets should be provided.
  - CheckIfExistingVPCParamsAreProvidedWhenNotAllowed: !!omap
    - RuleCondition: !!omap
      - Fn::Or:
        - !!omap
          - Fn::And:
            - !!omap
              - Fn::Equals:
                - !!omap
                  - Ref: VpcEnabled
                - Yes
            - !!omap
              - Fn::Equals:
                - !!omap
                  - Ref: CreateNewVpc
                - Yes
        - !!omap
          - Fn::Equals:
            - !!omap
              - Ref: VpcEnabled
            - No
    - Assertions:
      - !!omap
        - Assert: !!omap
          - Fn::Equals:
            - !!omap
              - Ref: ExistingVpcId
            - ''
        - AssertDescription: When creating a new VPC, you can not provide an existing
            VPC ID
      - !!omap
        - Assert: !!omap
          - Fn::Contains:
            - !!omap
              - Ref: ExistingPrivateSubnetIds
            - ''
        - AssertDescription: If you are not using a VPC or "CreateNewVpc" is set as
            "Yes", you can not provide existing subnet IDs
      - !!omap
        - Assert: !!omap
          - Fn::Contains:
            - !!omap
              - Ref: VpcAzs
            - ''
        - AssertDescription: If you are not using a VPC or "CreateNewVpc" is set as
            "Yes", you can not provide AZs.
      - !!omap
        - Assert: !!omap
          - Fn::Contains:
            - !!omap
              - Ref: ExistingSecurityGroupIds
            - ''
        - AssertDescription: If you are not using a VPC or "CreateNewVpc" is set as
            "Yes", you can not provide SecurityGroups
  - CheckIfDeloyVpcNotSetIfVpcEnabledIsFalse: !!omap
    - RuleCondition: !!omap
      - Fn::Equals:
        - !!omap
          - Ref: VpcEnabled
        - No
    - Assertions:
      - !!omap
        - Assert: !!omap
          - Fn::Equals:
            - !!omap
              - Ref: CreateNewVpc
            - No
        - AssertDescription: Deployment is not VPC enabled, first select "VpcEnabled"
            to "Yes", and then select "CreateNewVpc" to "Yes" to create a new VPC
  - CheckIfIPAMPoolIdCanBeProvided: !!omap
    - RuleCondition: !!omap
      - Fn::Or:
        - !!omap
          - Fn::And:
            - !!omap
              - Fn::Equals:
                - !!omap
                  - Ref: VpcEnabled
                - Yes
            - !!omap
              - Fn::Equals:
                - !!omap
                  - Ref: CreateNewVpc
                - No
        - !!omap
          - Fn::And:
            - !!omap
              - Fn::Equals:
                - !!omap
                  - Ref: VpcEnabled
                - No
            - !!omap
              - Fn::Equals:
                - !!omap
                  - Ref: CreateNewVpc
                - No
    - Assertions:
      - !!omap
        - Assert: !!omap
          - Fn::Equals:
            - !!omap
              - Ref: IPAMPoolId
            - ''
        - AssertDescription: To use AWS VPC IP Address Manager, first select "VpcEnabled"
            to "Yes", and then select "CreateNewVpc" to "Yes"
  - CognitoUserPoolAndClientRule: !!omap
    - RuleCondition: !!omap
      - Fn::Not:
        - !!omap
          - Fn::Equals:
            - !!omap
              - Ref: ExistingCognitoUserPoolId
            - ''
    - Assertions:
      - !!omap
        - Assert: !!omap
          - Fn::Not:
            - !!omap
              - Fn::Equals:
                - !!omap
                  - Ref: ExistingCognitoUserPoolClient
                - ''
        - AssertDescription: If an existing User Pool Id is provided, then an existing
            User Pool Client Id must also be provided.
  - CognitoDomainNotProvidedIfPoolIsRule: !!omap
    - RuleCondition: !!omap
      - Fn::Not:
        - !!omap
          - Fn::Equals:
            - !!omap
              - Ref: ExistingCognitoUserPoolId
            - ''
    - Assertions:
      - !!omap
        - Assert: !!omap
          - Fn::Equals:
            - !!omap
              - Ref: CognitoDomainPrefix
            - ''
        - AssertDescription: If an existing User Pool Id is provided, then a domain
            name for the User Pool Client must not be provided.
- Resources: !!omap
  - DeploymentPlatformSetupAccessLog67D5D503: !!omap
    - Type: AWS::S3::Bucket
    - Properties: !!omap
      - BucketEncryption: !!omap
        - ServerSideEncryptionConfiguration:
          - !!omap
            - ServerSideEncryptionByDefault: !!omap
              - SSEAlgorithm: AES256
      - PublicAccessBlockConfiguration: !!omap
        - BlockPublicAcls: true
        - BlockPublicPolicy: true
        - IgnorePublicAcls: true
        - RestrictPublicBuckets: true
    - UpdateReplacePolicy: Retain
    - DeletionPolicy: Retain
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: This S3 bucket is used as the access logging bucket for another
                bucket
            - id: AwsSolutions-S1
      - cfn_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - id: F14
            - reason: This bucket is used as an access logging bucket and hence requires
                PublicReadWrite ACL configuration
          - !!omap
            - id: W35
            - reason: The bucket is an access logging and hence it does not have an
                access log configured for itself
  - DeploymentPlatformSetupAccessLogPolicy2FB262B2: !!omap
    - Type: AWS::S3::BucketPolicy
    - Properties: !!omap
      - Bucket: !!omap
        - Ref: DeploymentPlatformSetupAccessLog67D5D503
      - PolicyDocument: !!omap
        - Statement:
          - !!omap
            - Action: s3:*
            - Condition: !!omap
              - Bool: !!omap
                - aws:SecureTransport: 'false'
            - Effect: Deny
            - Principal: !!omap
              - AWS: '*'
            - Resource:
              - !!omap
                - Fn::GetAtt:
                  - DeploymentPlatformSetupAccessLog67D5D503
                  - Arn
              - !!omap
                - Fn::Join:
                  - ''
                  - - !!omap
                      - Fn::GetAtt:
                        - DeploymentPlatformSetupAccessLog67D5D503
                        - Arn
                    - /*
        - Version: '2012-10-17'
    - UpdateReplacePolicy: Retain
    - DeletionPolicy: Retain
  - DeploymentPlatformSetupInfraSetupCustomResourceDynamoDBPolicy9530C9CF: !!omap
    - Type: AWS::IAM::Policy
    - Properties: !!omap
      - PolicyDocument: !!omap
        - Statement:
          - !!omap
            - Action:
              - dynamodb:GetItem
              - dynamodb:PutItem
              - dynamodb:UpdateItem
            - Effect: Allow
            - Resource: !!omap
              - Fn::Join:
                - ''
                - - 'arn:'
                  - !!omap
                    - Ref: AWS::Partition
                  - ':dynamodb:'
                  - !!omap
                    - Ref: AWS::Region
                  - ':'
                  - !!omap
                    - Ref: AWS::AccountId
                  - :table/*
          - !!omap
            - Action: lambda:GetFunction
            - Effect: Allow
            - Resource: !!omap
              - Fn::Join:
                - ''
                - - 'arn:'
                  - !!omap
                    - Ref: AWS::Partition
                  - ':lambda:'
                  - !!omap
                    - Ref: AWS::Region
                  - ':'
                  - !!omap
                    - Ref: AWS::AccountId
                  - :function:*
          - !!omap
            - Action:
              - logs:CreateLogGroup
              - logs:DescribeLogGroups
              - logs:PutRetentionPolicy
            - Effect: Allow
            - Resource:
              - !!omap
                - Fn::Join:
                  - ''
                  - - 'arn:'
                    - !!omap
                      - Ref: AWS::Partition
                    - ':logs:'
                    - !!omap
                      - Ref: AWS::Region
                    - ':'
                    - !!omap
                      - Ref: AWS::AccountId
                    - :log-group:/aws/lambda/*
              - !!omap
                - Fn::Join:
                  - ''
                  - - 'arn:'
                    - !!omap
                      - Ref: AWS::Partition
                    - ':logs:'
                    - !!omap
                      - Ref: AWS::Region
                    - ':'
                    - !!omap
                      - Ref: AWS::AccountId
                    - :log-group::log-stream:*
        - Version: '2012-10-17'
      - PolicyName: DeploymentPlatformSetupInfraSetupCustomResourceDynamoDBPolicy9530C9CF
      - Roles:
        - !!omap
          - Ref: DeploymentPlatformSetupCustomResourceLambdaRole3C444A9D
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: Lambda role policy is to read and write dynamodb buckets for
                model info and configuration
            - id: AwsSolutions-IAM5
            - applies_to:
              - Resource::arn:<AWS::Partition>:dynamodb:<AWS::Region>:<AWS::AccountId>:table/*
              - Resource::arn:<AWS::Partition>:lambda:<AWS::Region>:<AWS::AccountId>:function:*
              - Resource::arn:<AWS::Partition>:logs:<AWS::Region>:<AWS::AccountId>:log-group:/aws/lambda/*
              - Resource::arn:<AWS::Partition>:logs:<AWS::Region>:<AWS::AccountId>:log-group::log-stream:*
  - DeploymentPlatformSetupInfraSetupCustomResource5473231F: !!omap
    - Type: AWS::Lambda::Function
    - Properties: !!omap
      - Code: !!omap
        - S3Bucket: !!omap
          - Fn::Sub: solutions-${AWS::Region}
        - S3Key: generative-ai-application-builder-on-aws/v3.0.0/assete263bf7584e41967891494d57d581cb0b0aefeea06772dda56252b21cb777499.zip
      - Description: A custom resource lambda function to perform operations based
          on operation type
      - Environment: !!omap
        - Variables: !!omap
          - POWERTOOLS_SERVICE_NAME: CUSTOM-RESOURCE
          - AWS_SDK_USER_AGENT: '{ "user_agent_extra": "AWSSOLUTION/SO0276/v3.0.0"
              }'
      - Handler: lambda_func.handler
      - Layers:
        - !!omap
          - Ref: Boto3Layer463A0AEA
        - !!omap
          - Ref: PythonUserAgentLayer6958F3C0
      - Role: !!omap
        - Fn::GetAtt:
          - DeploymentPlatformSetupCustomResourceLambdaRole3C444A9D
          - Arn
      - Runtime: python3.13
      - Timeout: 900
      - TracingConfig: !!omap
        - Mode: Active
    - DependsOn:
      - DeploymentPlatformSetupCustomResourceLambdaRoleDefaultPolicy1B835079
      - DeploymentPlatformSetupCustomResourceLambdaRole3C444A9D
    - Metadata: !!omap
      - aws:asset:path: asset.e263bf7584e41967891494d57d581cb0b0aefeea06772dda56252b21cb777499
      - aws:asset:is-bundled: true
      - aws:asset:property: Code
      - cfn_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - id: W89
            - reason: VPC is not mandated in the solution. This lambda has no business
                logic but only gathers metrics. Hence is not deployed in a VPC
          - !!omap
            - id: W92
            - reason: The solution does not enforce reserved concurrency
  - DeploymentPlatformSetupInfraSetupCustomResourceLogRetention7B85E9E4: !!omap
    - Type: Custom::CW_LOG_RETENTION
    - Properties: !!omap
      - ServiceToken: !!omap
        - Fn::GetAtt:
          - DeploymentPlatformSetupInfraSetupCustomResource5473231F
          - Arn
      - FunctionName: !!omap
        - Ref: DeploymentPlatformSetupInfraSetupCustomResource5473231F
      - Resource: CW_LOG_RETENTION
    - UpdateReplacePolicy: Delete
    - DeletionPolicy: Delete
  - DeploymentPlatformSetupInfraSetupScheduledAnonymousMetrics34A8D055: !!omap
    - Type: AWS::Lambda::Function
    - Properties: !!omap
      - Code: !!omap
        - S3Bucket: !!omap
          - Fn::Sub: solutions-${AWS::Region}
        - S3Key: generative-ai-application-builder-on-aws/v3.0.0/assete263bf7584e41967891494d57d581cb0b0aefeea06772dda56252b21cb777499.zip
      - Description: A lambda function that runs as per defined schedule to publish
          metrics
      - Environment: !!omap
        - Variables: !!omap
          - POWERTOOLS_SERVICE_NAME: ANONYMOUS-CW-METRICS
          - SOLUTION_ID: SO0276
          - SOLUTION_VERSION: v3.0.0
          - USE_CASE_UUID: !!omap
            - Fn::GetAtt:
              - DeploymentPlatformSetupGenUUIDE08D47F0
              - UUID
          - REST_API_NAME: !!omap
            - Fn::Join:
              - ''
              - - !!omap
                  - Fn::Select:
                    - 1
                    - !!omap
                      - Fn::Split:
                        - /
                        - !!omap
                          - Ref: UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
                - -UseCaseManagementAPI
          - AWS_SDK_USER_AGENT: '{ "user_agent_extra": "AWSSOLUTION/SO0276/v3.0.0"
              }'
      - Handler: lambda_ops_metrics.handler
      - Layers:
        - !!omap
          - Ref: Boto3Layer463A0AEA
        - !!omap
          - Ref: PythonUserAgentLayer6958F3C0
      - Role: !!omap
        - Fn::GetAtt:
          - DeploymentPlatformSetupScheduledMetricsLambdaRole89420F9F
          - Arn
      - Runtime: python3.13
      - Timeout: 900
      - TracingConfig: !!omap
        - Mode: Active
    - DependsOn:
      - DeploymentPlatformSetupScheduledMetricsLambdaRoleDefaultPolicy7CE81C15
      - DeploymentPlatformSetupScheduledMetricsLambdaRole89420F9F
    - Metadata: !!omap
      - aws:asset:path: asset.e263bf7584e41967891494d57d581cb0b0aefeea06772dda56252b21cb777499
      - aws:asset:is-bundled: true
      - aws:asset:property: Code
      - cfn_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - id: W89
            - reason: VPC is not mandated in the solution. This lambda has no business
                logic but only gathers metrics. Hence is not deployed in a VPC
          - !!omap
            - id: W92
            - reason: The solution does not enforce reserved concurrency
    - Condition: AnonymousDataAWSCondition
  - DeploymentPlatformSetupInfraSetupScheduleLogRetentionF1D0F3ED: !!omap
    - Type: Custom::CW_LOG_RETENTION
    - Properties: !!omap
      - ServiceToken: !!omap
        - Fn::GetAtt:
          - DeploymentPlatformSetupInfraSetupCustomResource5473231F
          - Arn
      - FunctionName: !!omap
        - Ref: DeploymentPlatformSetupInfraSetupScheduledAnonymousMetrics34A8D055
      - Resource: CW_LOG_RETENTION
    - UpdateReplacePolicy: Delete
    - DeletionPolicy: Delete
    - Condition: AnonymousDataAWSCondition
  - DeploymentPlatformSetupInfraSetupGetMetricsDataPolicy82387FDA: !!omap
    - Type: AWS::IAM::Policy
    - Properties: !!omap
      - PolicyDocument: !!omap
        - Statement:
          - !!omap
            - Action: cloudwatch:GetMetricData
            - Effect: Allow
            - Resource: '*'
        - Version: '2012-10-17'
      - PolicyName: DeploymentPlatformSetupInfraSetupGetMetricsDataPolicy82387FDA
      - Roles:
        - !!omap
          - Ref: DeploymentPlatformSetupScheduledMetricsLambdaRole89420F9F
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: Lambda requires this permission to read metrics from CloudWatch
                logs
            - id: AwsSolutions-IAM5
  - DeploymentPlatformSetupInfraSetupMetricsPublishFrequencyB2020316: !!omap
    - Type: AWS::Events::Rule
    - Properties: !!omap
      - ScheduleExpression: rate(3 hours)
      - State: ENABLED
      - Targets:
        - !!omap
          - Arn: !!omap
            - Fn::GetAtt:
              - DeploymentPlatformSetupInfraSetupScheduledAnonymousMetrics34A8D055
              - Arn
          - Id: Target0
    - Condition: AnonymousDataAWSCondition
  - ? DeploymentPlatformSetupInfraSetupMetricsPublishFrequencyAllowEventRuleDeploymentPlatformStackDeploymentPlatformSetupInfraSetupScheduledAnonymousMetricsCE3BF48507FDD1A2
    : !!omap
    - Type: AWS::Lambda::Permission
    - Properties: !!omap
      - Action: lambda:InvokeFunction
      - FunctionName: !!omap
        - Fn::GetAtt:
          - DeploymentPlatformSetupInfraSetupScheduledAnonymousMetrics34A8D055
          - Arn
      - Principal: events.amazonaws.com
      - SourceArn: !!omap
        - Fn::GetAtt:
          - DeploymentPlatformSetupInfraSetupMetricsPublishFrequencyB2020316
          - Arn
    - Condition: AnonymousDataAWSCondition
  - DeploymentPlatformSetupCustomResourceLambdaRole3C444A9D: !!omap
    - Type: AWS::IAM::Role
    - Properties: !!omap
      - AssumeRolePolicyDocument: !!omap
        - Statement:
          - !!omap
            - Action: sts:AssumeRole
            - Effect: Allow
            - Principal: !!omap
              - Service: lambda.amazonaws.com
        - Version: '2012-10-17'
      - Policies:
        - !!omap
          - PolicyDocument: !!omap
            - Statement:
              - !!omap
                - Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                - Effect: Allow
                - Resource: !!omap
                  - Fn::Join:
                    - ''
                    - - 'arn:'
                      - !!omap
                        - Ref: AWS::Partition
                      - ':logs:'
                      - !!omap
                        - Ref: AWS::Region
                      - ':'
                      - !!omap
                        - Ref: AWS::AccountId
                      - :log-group:/aws/lambda/*
              - !!omap
                - Action: logs:PutLogEvents
                - Effect: Allow
                - Resource: !!omap
                  - Fn::Join:
                    - ''
                    - - 'arn:'
                      - !!omap
                        - Ref: AWS::Partition
                      - ':logs:'
                      - !!omap
                        - Ref: AWS::Region
                      - ':'
                      - !!omap
                        - Ref: AWS::AccountId
                      - :log-group:/aws/lambda/*:log-stream:*
            - Version: '2012-10-17'
          - PolicyName: LambdaFunctionServiceRolePolicy
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: Lambda functions has the required permission to write CloudWatch
                Logs. It uses custom policy instead of arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
                with tighter permissions.
            - id: AwsSolutions-IAM5
            - applies_to:
              - Resource::arn:<AWS::Partition>:logs:<AWS::Region>:<AWS::AccountId>:log-group:/aws/lambda/*
          - !!omap
            - reason: Lambda function has the required permission to write CloudWatch
                Log streams. It uses custom policy instead of arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
                with tighter permissions.
            - id: AwsSolutions-IAM5
            - applies_to:
              - Resource::arn:<AWS::Partition>:logs:<AWS::Region>:<AWS::AccountId>:log-group:/aws/lambda/*:log-stream:*
          - !!omap
            - reason: Even though the resource is "*", the actions have been scoped
                down only to the ones required by the solution
            - id: AwsSolutions-IAM5
            - applies_to:
              - Action::ec2:*ssignPrivateIpAddresses
              - Action::ec2:De*NetworkInterface
      - cfn_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - id: W11
            - reason: The exact resource arn is unknown at this time. Hence wildcard.
                The arns are have been restricted to the account and region where
                possible, except for "ec2:Describe" calls which require the arn to
                be a wildcard
          - !!omap
            - id: W12
            - reason: The exact resource arn is unknown at this time. Hence wildcard.
                The arns are have been restricted to the account and region where
                possible, except for "ec2:Describe" calls which require the arn to
                be a wildcard
          - !!omap
            - id: W13
            - reason: The exact resource arn is unknown at this time. Hence wildcard.
                The arns are have been restricted to the account and region where
                possible, except for "ec2:Describe" calls which require the arn to
                be a wildcard
          - !!omap
            - id: F10
            - reason: The inline policy avoids a rare race condition between the lambda,
                Role and the policy resource creation.
  - DeploymentPlatformSetupCustomResourceLambdaRoleDefaultPolicy1B835079: !!omap
    - Type: AWS::IAM::Policy
    - Properties: !!omap
      - PolicyDocument: !!omap
        - Statement:
          - !!omap
            - Action:
              - xray:PutTelemetryRecords
              - xray:PutTraceSegments
            - Effect: Allow
            - Resource: '*'
        - Version: '2012-10-17'
      - PolicyName: DeploymentPlatformSetupCustomResourceLambdaRoleDefaultPolicy1B835079
      - Roles:
        - !!omap
          - Ref: DeploymentPlatformSetupCustomResourceLambdaRole3C444A9D
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: Lambda role policy is configured to read data from S3 bucket
            - id: AwsSolutions-IAM5
            - applies_to:
              - Action::s3:Abort*
              - Action::s3:DeleteObject*
              - Resource::<SetupAppConfig016B0097.Arn>/*
          - !!omap
            - reason: The wildcard permission is required to publish events for x-ray
                insights
            - id: AwsSolutions-IAM5
            - applies_to:
              - Resource::*
  - DeploymentPlatformSetupScheduledMetricsLambdaRole89420F9F: !!omap
    - Type: AWS::IAM::Role
    - Properties: !!omap
      - AssumeRolePolicyDocument: !!omap
        - Statement:
          - !!omap
            - Action: sts:AssumeRole
            - Effect: Allow
            - Principal: !!omap
              - Service: lambda.amazonaws.com
        - Version: '2012-10-17'
      - Policies:
        - !!omap
          - PolicyDocument: !!omap
            - Statement:
              - !!omap
                - Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                - Effect: Allow
                - Resource: !!omap
                  - Fn::Join:
                    - ''
                    - - 'arn:'
                      - !!omap
                        - Ref: AWS::Partition
                      - ':logs:'
                      - !!omap
                        - Ref: AWS::Region
                      - ':'
                      - !!omap
                        - Ref: AWS::AccountId
                      - :log-group:/aws/lambda/*
              - !!omap
                - Action: logs:PutLogEvents
                - Effect: Allow
                - Resource: !!omap
                  - Fn::Join:
                    - ''
                    - - 'arn:'
                      - !!omap
                        - Ref: AWS::Partition
                      - ':logs:'
                      - !!omap
                        - Ref: AWS::Region
                      - ':'
                      - !!omap
                        - Ref: AWS::AccountId
                      - :log-group:/aws/lambda/*:log-stream:*
            - Version: '2012-10-17'
          - PolicyName: LambdaFunctionServiceRolePolicy
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: Lambda functions has the required permission to write CloudWatch
                Logs. It uses custom policy instead of arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
                with tighter permissions.
            - id: AwsSolutions-IAM5
            - applies_to:
              - Resource::arn:<AWS::Partition>:logs:<AWS::Region>:<AWS::AccountId>:log-group:/aws/lambda/*
          - !!omap
            - reason: Lambda function has the required permission to write CloudWatch
                Log streams. It uses custom policy instead of arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
                with tighter permissions.
            - id: AwsSolutions-IAM5
            - applies_to:
              - Resource::arn:<AWS::Partition>:logs:<AWS::Region>:<AWS::AccountId>:log-group:/aws/lambda/*:log-stream:*
          - !!omap
            - reason: Even though the resource is "*", the actions have been scoped
                down only to the ones required by the solution
            - id: AwsSolutions-IAM5
            - applies_to:
              - Action::ec2:*ssignPrivateIpAddresses
              - Action::ec2:De*NetworkInterface
          - !!omap
            - reason: This policy allows get metric data from CloudWatch and has been
                specified per the AWS documentation.
            - id: AwsSolutions-IAM5
            - applies_to:
              - Resource::*
      - cfn_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - id: W11
            - reason: The exact resource arn is unknown at this time. Hence wildcard.
                The arns are have been restricted to the account and region where
                possible, except for "ec2:Describe" calls which require the arn to
                be a wildcard
          - !!omap
            - id: W12
            - reason: The exact resource arn is unknown at this time. Hence wildcard.
                The arns are have been restricted to the account and region where
                possible, except for "ec2:Describe" calls which require the arn to
                be a wildcard
          - !!omap
            - id: W13
            - reason: The exact resource arn is unknown at this time. Hence wildcard.
                The arns are have been restricted to the account and region where
                possible, except for "ec2:Describe" calls which require the arn to
                be a wildcard
          - !!omap
            - id: F10
            - reason: The inline policy avoids a rare race condition between the lambda,
                Role and the policy resource creation.
  - DeploymentPlatformSetupScheduledMetricsLambdaRoleDefaultPolicy7CE81C15: !!omap
    - Type: AWS::IAM::Policy
    - Properties: !!omap
      - PolicyDocument: !!omap
        - Statement:
          - !!omap
            - Action:
              - xray:PutTelemetryRecords
              - xray:PutTraceSegments
            - Effect: Allow
            - Resource: '*'
        - Version: '2012-10-17'
      - PolicyName: DeploymentPlatformSetupScheduledMetricsLambdaRoleDefaultPolicy7CE81C15
      - Roles:
        - !!omap
          - Ref: DeploymentPlatformSetupScheduledMetricsLambdaRole89420F9F
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: The wildcard permission is required to publish events for x-ray
                insights
            - id: AwsSolutions-IAM5
            - applies_to:
              - Resource::*
  - DeploymentPlatformSetupGenUUIDE08D47F0: !!omap
    - Type: Custom::GenUUID
    - Properties: !!omap
      - ServiceToken: !!omap
        - Fn::GetAtt:
          - DeploymentPlatformSetupInfraSetupCustomResource5473231F
          - Arn
      - Resource: GEN_UUID
    - UpdateReplacePolicy: Delete
    - DeletionPolicy: Delete
  - DeploymentPlatformSetupOpsCustomDashboardC1C0C18E: !!omap
    - Type: AWS::CloudWatch::Dashboard
    - Properties: !!omap
      - DashboardBody: !!omap
        - Fn::Join:
          - ''
          - - '{"start":"start","end":"end","periodOverride":"auto","widgets":[{"type":"metric","width":6,"height":6,"x":0,"y":0,"properties":{"view":"timeSeries","title":"REST
              Endpoint Hits","region":"'
            - !!omap
              - Ref: AWS::Region
            - '","metrics":[["AWS/ApiGateway","Count","ApiName","'
            - !!omap
              - Fn::Select:
                - 1
                - !!omap
                  - Fn::Split:
                    - /
                    - !!omap
                      - Ref: UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
            - -UseCaseManagementAPI",{"color":"#9467bd","label":"Count","period":3600,"stat":"SampleCount"}],["AWS/ApiGateway","CacheHitCount","ApiName","
            - !!omap
              - Fn::Select:
                - 1
                - !!omap
                  - Fn::Split:
                    - /
                    - !!omap
                      - Ref: UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
            - -UseCaseManagementAPI",{"color":"#2ca02c","label":"CacheHitCount","period":3600,"stat":"SampleCount"}],["AWS/ApiGateway","CacheMissCount","ApiName","
            - !!omap
              - Fn::Select:
                - 1
                - !!omap
                  - Fn::Split:
                    - /
                    - !!omap
                      - Ref: UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
            - -UseCaseManagementAPI",{"color":"#d62728","label":"CacheMissCount","period":3600,"stat":"SampleCount"}]],"yAxis":{}}},{"type":"metric","width":6,"height":6,"x":6,"y":0,"properties":{"view":"timeSeries","title":"REST
              Endpoint Latency Stats","region":"
            - !!omap
              - Ref: AWS::Region
            - '","metrics":[["AWS/ApiGateway","Latency","ApiName","'
            - !!omap
              - Fn::Select:
                - 1
                - !!omap
                  - Fn::Split:
                    - /
                    - !!omap
                      - Ref: UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
            - -UseCaseManagementAPI",{"color":"#ff7f0e","label":"AverageLatency","period":3600}],["AWS/ApiGateway","IntegrationLatency","ApiName","
            - !!omap
              - Fn::Select:
                - 1
                - !!omap
                  - Fn::Split:
                    - /
                    - !!omap
                      - Ref: UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
            - -UseCaseManagementAPI",{"color":"#1f77b4","label":"MaxIntegrationLatency","period":3600,"stat":"Maximum"}],["AWS/ApiGateway","Latency","ApiName","
            - !!omap
              - Fn::Select:
                - 1
                - !!omap
                  - Fn::Split:
                    - /
                    - !!omap
                      - Ref: UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
            - -UseCaseManagementAPI",{"color":"#2ca02c","label":"MaxLatency","period":3600,"stat":"Maximum"}]],"yAxis":{}}},{"type":"metric","width":6,"height":6,"x":12,"y":0,"properties":{"view":"timeSeries","title":"Cognito
              Sign-ins & Sign-ups","region":"
            - !!omap
              - Ref: AWS::Region
            - '","metrics":[["AWS/Cognito","SignInSuccesses","UserPool","'
            - !!omap
              - Fn::GetAtt:
                - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
                - Outputs.DeploymentPlatformCognitoSetupUserPoolId0A73EB1C
            - '","UserPoolClient","'
            - !!omap
              - Fn::GetAtt:
                - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
                - Outputs.DeploymentPlatformCognitoSetupUserPoolClientIdFE2BD0AE
            - '",{"color":"#1f77b4","label":"SignInSuccessesCount","period":3600,"stat":"SampleCount"}],["AWS/Cognito","SignInSuccesses","UserPool","'
            - !!omap
              - Fn::GetAtt:
                - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
                - Outputs.DeploymentPlatformCognitoSetupUserPoolId0A73EB1C
            - '","UserPoolClient","'
            - !!omap
              - Fn::GetAtt:
                - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
                - Outputs.DeploymentPlatformCognitoSetupUserPoolClientIdFE2BD0AE
            - '",{"color":"#ff7f0e","label":"AverageSignInSuccesses","period":3600}],["AWS/Cognito","SignUpSuccesses","UserPool","'
            - !!omap
              - Fn::GetAtt:
                - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
                - Outputs.DeploymentPlatformCognitoSetupUserPoolId0A73EB1C
            - '","UserPoolClient","Admin",{"color":"#7f7f7f","label":"SignUpSuccessesCount","period":3600,"stat":"SampleCount"}],["AWS/Cognito","SignUpSuccesses","UserPool","'
            - !!omap
              - Fn::GetAtt:
                - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
                - Outputs.DeploymentPlatformCognitoSetupUserPoolId0A73EB1C
            - '","UserPoolClient","Admin",{"color":"#9467bd","label":"AverageSignUpSuccesses","period":3600}]],"yAxis":{}}},{"type":"metric","width":6,"height":6,"x":18,"y":0,"properties":{"view":"timeSeries","title":"Stack
              Deployment Status Stats","region":"'
            - !!omap
              - Ref: AWS::Region
            - '","metrics":[["Solution/UseCaseDeployments","UCInitiationSuccess","service","UseCaseManagement",{"color":"#1f77b4","label":"UCInitiationSuccessCount","period":3600,"stat":"SampleCount"}],["Solution/UseCaseDeployments","UCInitiationFailure","service","UseCaseManagement",{"color":"#ff7f0e","label":"UCInitiationFailureCount","period":3600,"stat":"SampleCount"}],["Solution/UseCaseDeployments","UCDeletionSuccess","service","UseCaseManagement",{"color":"#9467bd","label":"UCDeletionSuccessCount","period":3600,"stat":"SampleCount"}],["Solution/UseCaseDeployments","UCDeletionFailure","service","UseCaseManagement",{"color":"#d62728","label":"UCDeletionFailureCount","period":3600,"stat":"SampleCount"}],["Solution/UseCaseDeployments","UCUpdateSuccess","service","UseCaseManagement",{"color":"#2ca02c","label":"UCUpdateSuccessCount","period":3600,"stat":"SampleCount"}],["Solution/UseCaseDeployments","UCUpdateFailure","service","UseCaseManagement",{"color":"#8c564b","label":"UCUpdateFailureCount","period":3600,"stat":"SampleCount"}],["Solution/UseCaseDeployments","UCDescribeSuccess","service","UseCaseManagement",{"color":"#e377c2","label":"UCDescribeSuccessCount","period":3600,"stat":"SampleCount"}],["Solution/UseCaseDeployments","UCDescribeFailure","service","UseCaseManagement",{"color":"#7f7f7f","label":"UCDescribeFailureCount","period":3600,"stat":"SampleCount"}]],"yAxis":{}}}]}'
      - DashboardName: !!omap
        - Fn::Join:
          - ''
          - - !!omap
              - Ref: AWS::StackName
            - '-'
            - !!omap
              - Ref: AWS::Region
            - -Dashboard
    - DeletionPolicy: Delete
    - Condition: DeployCustomDashboard
  - DeploymentPlatformSetupWriteToSSMBE1096BE: !!omap
    - Type: AWS::IAM::Policy
    - Properties: !!omap
      - PolicyDocument: !!omap
        - Statement:
          - !!omap
            - Action:
              - ssm:DeleteParameter
              - ssm:GetParameter
              - ssm:PutParameter
            - Effect: Allow
            - Resource: !!omap
              - Fn::Join:
                - ''
                - - 'arn:'
                  - !!omap
                    - Ref: AWS::Partition
                  - ':ssm:'
                  - !!omap
                    - Ref: AWS::Region
                  - ':'
                  - !!omap
                    - Ref: AWS::AccountId
                  - :parameter/gaab-webconfig/*
        - Version: '2012-10-17'
      - PolicyName: DeploymentPlatformSetupWriteToSSMBE1096BE
      - Roles:
        - !!omap
          - Ref: DeploymentPlatformSetupCustomResourceLambdaRole3C444A9D
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: Permission is required to delete old webconfig ssm parameters
            - id: AwsSolutions-IAM5
            - applies_to:
              - Resource::arn:<AWS::Partition>:ssm:<AWS::Region>:<AWS::AccountId>:parameter/gaab-webconfig/*
  - DeploymentPlatformSetupGetCognitoUserPoolInfo2A3390CD: !!omap
    - Type: AWS::IAM::Policy
    - Properties: !!omap
      - PolicyDocument: !!omap
        - Statement:
          - !!omap
            - Action: cognito-idp:DescribeUserPool
            - Effect: Allow
            - Resource: !!omap
              - Fn::Join:
                - ''
                - - 'arn:'
                  - !!omap
                    - Ref: AWS::Partition
                  - ':cognito-idp:'
                  - !!omap
                    - Ref: AWS::Region
                  - ':'
                  - !!omap
                    - Ref: AWS::AccountId
                  - :userpool/
                  - !!omap
                    - Fn::GetAtt:
                      - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
                      - Outputs.DeploymentPlatformCognitoSetupUserPoolId0A73EB1C
        - Version: '2012-10-17'
      - PolicyName: DeploymentPlatformSetupGetCognitoUserPoolInfo2A3390CD
      - Roles:
        - !!omap
          - Ref: DeploymentPlatformSetupCustomResourceLambdaRole3C444A9D
  - DeploymentPlatformSetupSolutionHelperAnonymousData96B2086D: !!omap
    - Type: Custom::AnonymousData
    - Properties: !!omap
      - ServiceToken: !!omap
        - Fn::GetAtt:
          - DeploymentPlatformSetupInfraSetupCustomResource5473231F
          - Arn
      - Resource: ANONYMOUS_METRIC
      - SolutionId: SO0276
      - Version: v3.0.0
      - UUID: !!omap
        - Fn::GetAtt:
          - DeploymentPlatformSetupGenUUIDE08D47F0
          - UUID
      - VPC_ENABLED: !!omap
        - Ref: VpcEnabled
      - CREATE_VPC: !!omap
        - Ref: CreateNewVpc
    - UpdateReplacePolicy: Delete
    - DeletionPolicy: Delete
    - Condition: AnonymousDataAWSCondition
  - VPCDeploymentPlatformVPCNestedStackDeploymentPlatformVPCNestedStackResource186D2208: !!omap
    - Type: AWS::CloudFormation::Stack
    - Properties: !!omap
      - Parameters: !!omap
        - CustomResourceLambdaArn: !!omap
          - Fn::GetAtt:
            - DeploymentPlatformSetupInfraSetupCustomResource5473231F
            - Arn
        - CustomResourceRoleArn: !!omap
          - Fn::GetAtt:
            - DeploymentPlatformSetupCustomResourceLambdaRole3C444A9D
            - Arn
        - AccessLoggingBucketArn: !!omap
          - Fn::GetAtt:
            - DeploymentPlatformSetupAccessLog67D5D503
            - Arn
        - IPAMPoolId: !!omap
          - Ref: IPAMPoolId
        - referencetoDeploymentPlatformStackRegistrySetup483F1675Id: !!omap
          - Fn::GetAtt:
            - RegistrySetupCC2515F0
            - Id
      - TemplateURL: !!omap
        - Fn::Join:
          - ''
          - - https://solutions-reference.s3.
            - !!omap
              - Ref: AWS::URLSuffix
            - /
            - generative-ai-application-builder-on-aws/v3.0.0/DeploymentPlatformStackVPCDeploymentPlatformVPC42C65300.nested.template
    - DependsOn:
      - RegistrySetupCC2515F0
    - UpdateReplacePolicy: Delete
    - DeletionPolicy: Delete
    - Metadata: !!omap
      - aws:asset:path: DeploymentPlatformStackVPCDeploymentPlatformVPC42C65300.nested.template.json
      - aws:asset:property: TemplateURL
    - Condition: DeployVPCCondition
  - WebAppNestedStackWebAppNestedStackResource4E994CA7: !!omap
    - Type: AWS::CloudFormation::Stack
    - Properties: !!omap
      - Parameters: !!omap
        - CustomResourceLambdaArn: !!omap
          - Fn::GetAtt:
            - DeploymentPlatformSetupInfraSetupCustomResource5473231F
            - Arn
        - CustomResourceRoleArn: !!omap
          - Fn::GetAtt:
            - DeploymentPlatformSetupCustomResourceLambdaRole3C444A9D
            - Arn
        - AccessLoggingBucketArn: !!omap
          - Fn::GetAtt:
            - DeploymentPlatformSetupAccessLog67D5D503
            - Arn
        - UseCaseUUID: !!omap
          - Fn::GetAtt:
            - DeploymentPlatformSetupGenUUIDE08D47F0
            - UUID
        - referencetoDeploymentPlatformStackRegistrySetup483F1675Id: !!omap
          - Fn::GetAtt:
            - RegistrySetupCC2515F0
            - Id
      - TemplateURL: !!omap
        - Fn::Join:
          - ''
          - - https://solutions-reference.s3.
            - !!omap
              - Ref: AWS::URLSuffix
            - /
            - generative-ai-application-builder-on-aws/v3.0.0/DeploymentPlatformStackWebApp990B70E2.nested.template
    - DependsOn:
      - DeploymentPlatformSetupAccessLogPolicy2FB262B2
      - RegistrySetupCC2515F0
    - UpdateReplacePolicy: Delete
    - DeletionPolicy: Delete
    - Metadata: !!omap
      - aws:asset:path: DeploymentPlatformStackWebApp990B70E2.nested.template.json
      - aws:asset:property: TemplateURL
    - Condition: DeployWebAppUIInfrastructureCondition
  - DeploymentPlatformStorageDeploymentPlatformStorageNestedStackDeploymentPlatformStorageNestedStackResourceF56260D3: !!omap
    - Type: AWS::CloudFormation::Stack
    - Properties: !!omap
      - Parameters: !!omap
        - CustomResourceLambdaArn: !!omap
          - Fn::GetAtt:
            - DeploymentPlatformSetupInfraSetupCustomResource5473231F
            - Arn
        - CustomResourceRoleArn: !!omap
          - Fn::GetAtt:
            - DeploymentPlatformSetupCustomResourceLambdaRole3C444A9D
            - Arn
        - AccessLoggingBucketArn: !!omap
          - Fn::GetAtt:
            - DeploymentPlatformSetupAccessLog67D5D503
            - Arn
        - referencetoDeploymentPlatformStackRegistrySetup483F1675Id: !!omap
          - Fn::GetAtt:
            - RegistrySetupCC2515F0
            - Id
      - TemplateURL: !!omap
        - Fn::Join:
          - ''
          - - https://solutions-reference.s3.
            - !!omap
              - Ref: AWS::URLSuffix
            - /
            - generative-ai-application-builder-on-aws/v3.0.0/DeploymentPlatformStackDeploymentPlatformStorage5B30492E.nested.template
    - DependsOn:
      - RegistrySetupCC2515F0
    - UpdateReplacePolicy: Delete
    - DeletionPolicy: Delete
    - Metadata: !!omap
      - aws:asset:path: DeploymentPlatformStackDeploymentPlatformStorage5B30492E.nested.template.json
      - aws:asset:property: TemplateURL
  - DeploymentPlatformStorageDDBUCMLPolicy9154E8BF: !!omap
    - Type: AWS::IAM::Policy
    - Properties: !!omap
      - PolicyDocument: !!omap
        - Statement:
          - !!omap
            - Action:
              - dynamodb:Batch*
              - dynamodb:ConditionCheckItem
              - dynamodb:DeleteItem
              - dynamodb:Get*
              - dynamodb:PutItem
              - dynamodb:Query
              - dynamodb:Scan
              - dynamodb:UpdateItem
            - Effect: Allow
            - Resource:
              - !!omap
                - Fn::GetAtt:
                  - DeploymentPlatformStorageDeploymentPlatformStorageNestedStackDeploymentPlatformStorageNestedStackResourceF56260D3
                  - Outputs.DeploymentPlatformStackDeploymentPlatformStorageLLMConfigTable9EB214F1Arn
              - !!omap
                - Fn::GetAtt:
                  - DeploymentPlatformStorageDeploymentPlatformStorageNestedStackDeploymentPlatformStorageNestedStackResourceF56260D3
                  - Outputs.DeploymentPlatformStackDeploymentPlatformStorageModelInfoStorageModelInfoStore6E739C0DArn
              - !!omap
                - Fn::GetAtt:
                  - DeploymentPlatformStorageDeploymentPlatformStorageNestedStackDeploymentPlatformStorageNestedStackResourceF56260D3
                  - Outputs.DeploymentPlatformStackDeploymentPlatformStorageUseCasesTable8AE1DCF5Arn
        - Version: '2012-10-17'
      - PolicyName: DeploymentPlatformStorageDDBUCMLPolicy9154E8BF
      - Roles:
        - !!omap
          - Fn::GetAtt:
            - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
            - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementUCMLRole7D6F4C25Ref
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: The IAM role allows the Lambda function to create, delete table.
                Table name is not known
            - id: AwsSolutions-IAM5
            - applies_to:
              - Action::dynamodb:Batch*
              - Action::dynamodb:Get*
  - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421: !!omap
    - Type: AWS::CloudFormation::Stack
    - Properties: !!omap
      - Parameters: !!omap
        - DefaultUserEmail: !!omap
          - Ref: AdminUserEmail
        - ApplicationTrademarkName: Generative AI Application Builder on AWS
        - WebConfigSSMKey: !!omap
          - Fn::Join:
            - ''
            - - /gaab-webconfig/
              - !!omap
                - Ref: AWS::StackName
        - CustomResourceLambdaArn: !!omap
          - Fn::GetAtt:
            - DeploymentPlatformSetupInfraSetupCustomResource5473231F
            - Arn
        - CustomResourceRoleArn: !!omap
          - Fn::GetAtt:
            - DeploymentPlatformSetupCustomResourceLambdaRole3C444A9D
            - Arn
        - ExistingSecurityGroupIds: !!omap
          - Fn::If:
            - DeployVPCCondition
            - !!omap
              - Fn::GetAtt:
                - VPCDeploymentPlatformVPCNestedStackDeploymentPlatformVPCNestedStackResource186D2208
                - Outputs.SecurityGroupIds
            - !!omap
              - Fn::Join:
                - ','
                - !!omap
                  - Ref: ExistingSecurityGroupIds
        - ExistingPrivateSubnetIds: !!omap
          - Fn::If:
            - DeployVPCCondition
            - !!omap
              - Fn::GetAtt:
                - VPCDeploymentPlatformVPCNestedStackDeploymentPlatformVPCNestedStackResource186D2208
                - Outputs.PrivateSubnetIds
            - !!omap
              - Fn::Join:
                - ','
                - !!omap
                  - Ref: ExistingPrivateSubnetIds
        - CognitoDomainPrefix: !!omap
          - Ref: CognitoDomainPrefix
        - CloudFrontUrl: !!omap
          - Fn::If:
            - DeployWebAppUIInfrastructureCondition
            - !!omap
              - Fn::Join:
                - ''
                - - https://
                  - !!omap
                    - Fn::GetAtt:
                      - WebAppNestedStackWebAppNestedStackResource4E994CA7
                      - Outputs.DeploymentPlatformStackWebAppWebsiteUICloudFrontDistribution38CBCDC5DomainName
            - !!omap
              - Ref: AWS::NoValue
        - DeployUI: !!omap
          - Ref: DeployUI
        - AccessLoggingBucketArn: !!omap
          - Fn::GetAtt:
            - DeploymentPlatformSetupAccessLog67D5D503
            - Arn
        - ExistingCognitoUserPoolId: !!omap
          - Ref: ExistingCognitoUserPoolId
        - ExistingCognitoUserPoolClientId: !!omap
          - Ref: ExistingCognitoUserPoolClient
        - ? referencetoDeploymentPlatformStackDeploymentPlatformStorageDeploymentPlatformStorageNestedStackDeploymentPlatformStorageNestedStackResource0080A447OutputsDeploymentPlatformStackDeploymentPlatformStorageUseCasesTable8AE1DCF5Ref
          : !!omap
          - Fn::GetAtt:
            - DeploymentPlatformStorageDeploymentPlatformStorageNestedStackDeploymentPlatformStorageNestedStackResourceF56260D3
            - Outputs.DeploymentPlatformStackDeploymentPlatformStorageUseCasesTable8AE1DCF5Ref
        - ? referencetoDeploymentPlatformStackDeploymentPlatformStorageDeploymentPlatformStorageNestedStackDeploymentPlatformStorageNestedStackResource0080A447OutputsDeploymentPlatformStackDeploymentPlatformStorageModelInfoStorageModelInfoStore6E739C0DRef
          : !!omap
          - Fn::GetAtt:
            - DeploymentPlatformStorageDeploymentPlatformStorageNestedStackDeploymentPlatformStorageNestedStackResourceF56260D3
            - Outputs.DeploymentPlatformStackDeploymentPlatformStorageModelInfoStorageModelInfoStore6E739C0DRef
        - ? referencetoDeploymentPlatformStackDeploymentPlatformStorageDeploymentPlatformStorageNestedStackDeploymentPlatformStorageNestedStackResource0080A447OutputsDeploymentPlatformStackDeploymentPlatformStorageLLMConfigTable9EB214F1Ref
          : !!omap
          - Fn::GetAtt:
            - DeploymentPlatformStorageDeploymentPlatformStorageNestedStackDeploymentPlatformStorageNestedStackResourceF56260D3
            - Outputs.DeploymentPlatformStackDeploymentPlatformStorageLLMConfigTable9EB214F1Ref
        - referencetoDeploymentPlatformStackAwsNodeSdkLayer390CBFFFRef: !!omap
          - Ref: AwsNodeSdkLayer42C7A59C
        - referencetoDeploymentPlatformStackNodeUserAgentLayer24384C79Ref: !!omap
          - Ref: NodeUserAgentLayer02526341
        - ? referencetoDeploymentPlatformStackDeploymentPlatformStorageDeploymentPlatformStorageNestedStackDeploymentPlatformStorageNestedStackResource0080A447OutputsDeploymentPlatformStackDeploymentPlatformStorageModelInfoStorageModelInfoStore6E739C0DArn
          : !!omap
          - Fn::GetAtt:
            - DeploymentPlatformStorageDeploymentPlatformStorageNestedStackDeploymentPlatformStorageNestedStackResourceF56260D3
            - Outputs.DeploymentPlatformStackDeploymentPlatformStorageModelInfoStorageModelInfoStore6E739C0DArn
        - referencetoDeploymentPlatformStackRegistrySetup483F1675Id: !!omap
          - Fn::GetAtt:
            - RegistrySetupCC2515F0
            - Id
      - TemplateURL: !!omap
        - Fn::Join:
          - ''
          - - https://solutions-reference.s3.
            - !!omap
              - Ref: AWS::URLSuffix
            - /
            - generative-ai-application-builder-on-aws/v3.0.0/DeploymentPlatformStackUseCaseManagementSetupUseCaseManagement4D56BB38.nested.template
    - DependsOn:
      - RegistrySetupCC2515F0
    - UpdateReplacePolicy: Delete
    - DeletionPolicy: Delete
    - Metadata: !!omap
      - aws:asset:path: DeploymentPlatformStackUseCaseManagementSetupUseCaseManagement4D56BB38.nested.template.json
      - aws:asset:property: TemplateURL
  - UseCaseManagementSetupRequestProcessorRestAuthorizerRole9B42FEFC: !!omap
    - Type: AWS::IAM::Role
    - Properties: !!omap
      - AssumeRolePolicyDocument: !!omap
        - Statement:
          - !!omap
            - Action: sts:AssumeRole
            - Effect: Allow
            - Principal: !!omap
              - Service: lambda.amazonaws.com
        - Version: '2012-10-17'
      - Policies:
        - !!omap
          - PolicyDocument: !!omap
            - Statement:
              - !!omap
                - Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                - Effect: Allow
                - Resource: !!omap
                  - Fn::Join:
                    - ''
                    - - 'arn:'
                      - !!omap
                        - Ref: AWS::Partition
                      - ':logs:'
                      - !!omap
                        - Ref: AWS::Region
                      - ':'
                      - !!omap
                        - Ref: AWS::AccountId
                      - :log-group:/aws/lambda/*
              - !!omap
                - Action: logs:PutLogEvents
                - Effect: Allow
                - Resource: !!omap
                  - Fn::Join:
                    - ''
                    - - 'arn:'
                      - !!omap
                        - Ref: AWS::Partition
                      - ':logs:'
                      - !!omap
                        - Ref: AWS::Region
                      - ':'
                      - !!omap
                        - Ref: AWS::AccountId
                      - :log-group:/aws/lambda/*:log-stream:*
            - Version: '2012-10-17'
          - PolicyName: LambdaFunctionServiceRolePolicy
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: Lambda functions has the required permission to write CloudWatch
                Logs. It uses custom policy instead of arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
                with tighter permissions.
            - id: AwsSolutions-IAM5
            - applies_to:
              - Resource::arn:<AWS::Partition>:logs:<AWS::Region>:<AWS::AccountId>:log-group:/aws/lambda/*
          - !!omap
            - reason: Lambda function has the required permission to write CloudWatch
                Log streams. It uses custom policy instead of arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
                with tighter permissions.
            - id: AwsSolutions-IAM5
            - applies_to:
              - Resource::arn:<AWS::Partition>:logs:<AWS::Region>:<AWS::AccountId>:log-group:/aws/lambda/*:log-stream:*
          - !!omap
            - reason: Even though the resource is "*", the actions have been scoped
                down only to the ones required by the solution
            - id: AwsSolutions-IAM5
            - applies_to:
              - Action::ec2:*ssignPrivateIpAddresses
              - Action::ec2:De*NetworkInterface
          - !!omap
            - reason: Lambda authorizer needs to describe any user pool to validate
                tokens from multiple user pools. Additional scoping down is found
                in the authorizer
            - id: AwsSolutions-IAM5
      - cfn_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - id: W11
            - reason: The exact resource arn is unknown at this time. Hence wildcard.
                The arns are have been restricted to the account and region where
                possible, except for "ec2:Describe" calls which require the arn to
                be a wildcard
          - !!omap
            - id: W12
            - reason: The exact resource arn is unknown at this time. Hence wildcard.
                The arns are have been restricted to the account and region where
                possible, except for "ec2:Describe" calls which require the arn to
                be a wildcard
          - !!omap
            - id: W13
            - reason: The exact resource arn is unknown at this time. Hence wildcard.
                The arns are have been restricted to the account and region where
                possible, except for "ec2:Describe" calls which require the arn to
                be a wildcard
          - !!omap
            - id: F10
            - reason: The inline policy avoids a rare race condition between the lambda,
                Role and the policy resource creation.
  - UseCaseManagementSetupRequestProcessorRestAuthorizerRoleDefaultPolicy2312A063: !!omap
    - Type: AWS::IAM::Policy
    - Properties: !!omap
      - PolicyDocument: !!omap
        - Statement:
          - !!omap
            - Action: cognito-idp:DescribeUserPoolClient
            - Effect: Allow
            - Resource: !!omap
              - Fn::Join:
                - ''
                - - 'arn:aws:cognito-idp:'
                  - !!omap
                    - Ref: AWS::Region
                  - ':'
                  - !!omap
                    - Ref: AWS::AccountId
                  - :userpool/*
        - Version: '2012-10-17'
      - PolicyName: UseCaseManagementSetupRequestProcessorRestAuthorizerRoleDefaultPolicy2312A063
      - Roles:
        - !!omap
          - Ref: UseCaseManagementSetupRequestProcessorRestAuthorizerRole9B42FEFC
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: Lambda authorizer needs to describe any user pool to validate
                tokens from multiple user pools. Additional scoping down is found
                in the authorizer
            - id: AwsSolutions-IAM5
  - UseCaseManagementSetupRequestProcessorDeploymentRestAuthorizer2B81EC22: !!omap
    - Type: AWS::Lambda::Function
    - Properties: !!omap
      - Code: !!omap
        - S3Bucket: !!omap
          - Fn::Sub: solutions-${AWS::Region}
        - S3Key: generative-ai-application-builder-on-aws/v3.0.0/asset51c67e91bc5ff0cbff3158910b74182af37b735b62f380d7c2f49b6a1a72a766.zip
      - Description: Authorizes REST API requests based on Cognito user pool groups
      - Environment: !!omap
        - Variables: !!omap
          - USER_POOL_ID: !!omap
            - Fn::GetAtt:
              - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
              - Outputs.DeploymentPlatformCognitoSetupUserPoolId0A73EB1C
          - CLIENT_ID: !!omap
            - Fn::GetAtt:
              - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
              - Outputs.DeploymentPlatformCognitoSetupUserPoolClientIdFE2BD0AE
          - COGNITO_POLICY_TABLE_NAME: !!omap
            - Fn::GetAtt:
              - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
              - Outputs.DeploymentPlatformCognitoSetupCognitoGroupPolicyTableName0C5E8F79
          - AWS_SDK_USER_AGENT: '{ "customUserAgent": [["AWSSOLUTION/SO0276/v3.0.0"]]
              }'
          - AWS_NODEJS_CONNECTION_REUSE_ENABLED: '1'
      - Handler: rest-authorizer.handler
      - Layers:
        - !!omap
          - Ref: AwsNodeSdkLayer42C7A59C
        - !!omap
          - Ref: NodeUserAgentLayer02526341
      - Role: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupRequestProcessorRestAuthorizerRole9B42FEFC
          - Arn
      - Runtime: nodejs22.x
      - Timeout: 900
    - DependsOn:
      - UseCaseManagementSetupRequestProcessorRestAuthorizerRoleDefaultPolicy2312A063
      - UseCaseManagementSetupRequestProcessorRestAuthorizerRole9B42FEFC
    - Metadata: !!omap
      - aws:asset:path: asset.51c67e91bc5ff0cbff3158910b74182af37b735b62f380d7c2f49b6a1a72a766
      - aws:asset:is-bundled: true
      - aws:asset:property: Code
      - cfn_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - id: W89
            - reason: VPC deployment is not enforced. This REST authorizer is not
                configured within a VPC
          - !!omap
            - id: W92
            - reason: The solution does not enforce reserved concurrency
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestAuthorizerDeploymentPlatformStackUseCaseManagementSetupRequestProcessorRestCustomRequestAuthorizer537B59D4Permissions3FBB7A58
    : !!omap
    - Type: AWS::Lambda::Permission
    - Properties: !!omap
      - Action: lambda:InvokeFunction
      - FunctionName: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupRequestProcessorDeploymentRestAuthorizer2B81EC22
          - Arn
      - Principal: apigateway.amazonaws.com
      - SourceArn: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':execute-api:'
            - !!omap
              - Ref: AWS::Region
            - ':'
            - !!omap
              - Ref: AWS::AccountId
            - ':'
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
            - /authorizers/
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorRestCustomRequestAuthorizerCDD89059
  - UseCaseManagementSetupRequestProcessorDeploymentRestAuthorizerAPIGatewayInvoke7E420FA2: !!omap
    - Type: AWS::Lambda::Permission
    - Properties: !!omap
      - Action: lambda:InvokeFunction
      - FunctionName: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupRequestProcessorDeploymentRestAuthorizer2B81EC22
          - Arn
      - Principal: apigateway.amazonaws.com
      - SourceArn: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':execute-api:'
            - !!omap
              - Ref: AWS::Region
            - ':'
            - !!omap
              - Ref: AWS::AccountId
            - ':'
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
            - /*
  - UseCaseManagementSetupRequestProcessorRestAuthLogRetention78B8FC64: !!omap
    - Type: Custom::CW_LOG_RETENTION
    - Properties: !!omap
      - ServiceToken: !!omap
        - Fn::GetAtt:
          - DeploymentPlatformSetupInfraSetupCustomResource5473231F
          - Arn
      - FunctionName: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestAuthorizer2B81EC22
      - Resource: CW_LOG_RETENTION
    - UpdateReplacePolicy: Delete
    - DeletionPolicy: Delete
  - UseCaseManagementSetupRequestProcessorLambdaPolicyTablePolicy835B4D04: !!omap
    - Type: AWS::IAM::Policy
    - Properties: !!omap
      - PolicyDocument: !!omap
        - Statement:
          - !!omap
            - Action:
              - dynamodb:BatchGetItem
              - dynamodb:GetItem
              - dynamodb:Query
            - Effect: Allow
            - Resource: !!omap
              - Fn::Join:
                - ''
                - - 'arn:aws:dynamodb:'
                  - !!omap
                    - Ref: AWS::Region
                  - ':'
                  - !!omap
                    - Ref: AWS::AccountId
                  - :table/
                  - !!omap
                    - Fn::GetAtt:
                      - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
                      - Outputs.DeploymentPlatformCognitoSetupCognitoGroupPolicyTableName0C5E8F79
        - Version: '2012-10-17'
      - PolicyName: UseCaseManagementSetupRequestProcessorLambdaPolicyTablePolicy835B4D04
      - Roles:
        - !!omap
          - Ref: UseCaseManagementSetupRequestProcessorRestAuthorizerRole9B42FEFC
  - UseCaseManagementSetupRequestProcessorRestCustomRequestAuthorizerCDD89059: !!omap
    - Type: AWS::ApiGateway::Authorizer
    - Properties: !!omap
      - AuthorizerResultTtlInSeconds: 0
      - AuthorizerUri: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Fn::Select:
                - 1
                - !!omap
                  - Fn::Split:
                    - ':'
                    - !!omap
                      - Fn::GetAtt:
                        - UseCaseManagementSetupRequestProcessorDeploymentRestAuthorizer2B81EC22
                        - Arn
            - ':apigateway:'
            - !!omap
              - Fn::Select:
                - 3
                - !!omap
                  - Fn::Split:
                    - ':'
                    - !!omap
                      - Fn::GetAtt:
                        - UseCaseManagementSetupRequestProcessorDeploymentRestAuthorizer2B81EC22
                        - Arn
            - :lambda:path/2015-03-31/functions/
            - !!omap
              - Fn::GetAtt:
                - UseCaseManagementSetupRequestProcessorDeploymentRestAuthorizer2B81EC22
                - Arn
            - /invocations
      - IdentitySource: method.request.header.Authorization
      - Name: DeploymentPlatformStackUseCaseManagementSetupRequestProcessorRestCustomRequestAuthorizer537B59D4
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
      - Type: REQUEST
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointApiAccessLogGroupFB4EFA7D: !!omap
    - Type: AWS::Logs::LogGroup
    - Properties: !!omap
      - RetentionInDays: 3653
    - UpdateReplacePolicy: Retain
    - DeletionPolicy: Retain
    - Metadata: !!omap
      - cfn_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - id: W84
            - reason: By default CloudWatchLogs LogGroups data is encrypted using
                the CloudWatch server-side encryption keys (AWS Managed Keys)
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F: !!omap
    - Type: AWS::ApiGateway::RestApi
    - Properties: !!omap
      - Description: API endpoint to access use case management functions
      - EndpointConfiguration: !!omap
        - Types:
          - EDGE
      - Name: !!omap
        - Fn::Join:
          - ''
          - - !!omap
              - Ref: AWS::StackName
            - -UseCaseManagementAPI
    - Metadata: !!omap
      - cfn_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - id: W87
            - reason: Since caching is not enabled, cache encryption is also not enabled
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiDeployment8CA28FB1a9b78346e213302778bfd9542d49f78f
    : !!omap
    - Type: AWS::ApiGateway::Deployment
    - Properties: !!omap
      - Description: API endpoint to access use case management functions
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
    - DependsOn:
      - UseCaseManagementSetupFeedbackSetupStackNestedStackFeedbackSetupStackNestedStackResourceCA537136
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointBadRequestBodyResponseEF90EA9F
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointBadRequestDefaultResponseE22C6436
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointBadRequestParametersResponse97FE3D57
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsuseCaseIdDELETE1F46F92B
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsuseCaseIdGET49E7D36E
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsuseCaseIdOPTIONS34A36241
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsuseCaseIdPATCHB08FB161
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsuseCaseId1B4DA213
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsGET93EE3992
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsOPTIONS226E9606
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsPOST68876F12
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsBB1D9109
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApifeedbackuseCaseIdOPTIONS144DB212
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApifeedbackuseCaseIdPOST3C555B45
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApifeedbackuseCaseIdEE4BB80E
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApifeedback61DB2B5B
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeproviderNamemodelIdGET1CDDE10A
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeproviderNamemodelIdOPTIONS7646D3AE
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeproviderNamemodelId88C0A3B5
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeproviderNameGET6D685A8B
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeproviderNameOPTIONS481D07FD
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeproviderNameC996A9BE
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeprovidersGET54F880DB
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeprovidersOPTIONSDD79CF85
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeprovidersD9729BFA
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeCC855208
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfo471EE02C
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfousecasetypesGETFE1D2400
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfousecasetypesOPTIONSA2D8A0E9
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfousecasetypes44F4208C
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeployUseCaseApiBodyModel2E7FF7C8
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeployUseCaseResponseModel053210C2
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointInternalServerErrorDefaultResponse973BC431
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointRequestValidator38E09551
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointUpdateUseCaseApiBodyModel556ECDCC
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointUpdateUseCaseResponseModel43C6C5F9
      - UseCaseManagementSetupRequestProcessorRestCustomRequestAuthorizerCDD89059
    - Metadata: !!omap
      - cfn_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - id: W45
            - reason: ApiGateway has AccessLogging enabled in AWS::ApiGateway::Stage
                resource, but cfn_nag checks for it in AWS::ApiGateway::Deployment
                resource
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiDeploymentStageprodE2564A5F: !!omap
    - Type: AWS::ApiGateway::Stage
    - Properties: !!omap
      - AccessLogSetting: !!omap
        - DestinationArn: !!omap
          - Fn::GetAtt:
            - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointApiAccessLogGroupFB4EFA7D
            - Arn
        - Format: $context.identity.sourceIp $context.identity.caller $context.identity.user
            [$context.requestTime] "$context.httpMethod $context.resourcePath $context.protocol"
            $context.status $context.responseLength $context.requestId
      - DeploymentId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiDeployment8CA28FB1a9b78346e213302778bfd9542d49f78f
      - MethodSettings:
        - !!omap
          - DataTraceEnabled: false
          - HttpMethod: '*'
          - LoggingLevel: OFF
          - MetricsEnabled: true
          - ResourcePath: /*
          - ThrottlingBurstLimit: 5
          - ThrottlingRateLimit: 5
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
      - StageName: prod
      - TracingEnabled: true
    - Metadata: !!omap
      - guard: !!omap
        - SuppressedRules:
          - API_GW_CACHE_ENABLED_AND_ENCRYPTED
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: Turning off execution logs as recommended best practice in the
                ApiGateway service documentation
            - id: AwsSolutions-APIG6
      - cfn_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - id: W87
            - reason: Caching is not configured for this endpoint, hence CacheEncryption
                configurations don't apply
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsBB1D9109: !!omap
    - Type: AWS::ApiGateway::Resource
    - Properties: !!omap
      - ParentId: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
          - RootResourceId
      - PathPart: deployments
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsuseCaseId1B4DA213: !!omap
    - Type: AWS::ApiGateway::Resource
    - Properties: !!omap
      - ParentId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsBB1D9109
      - PathPart: '{useCaseId}'
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsuseCaseIdOPTIONS34A36241
    : !!omap
    - Type: AWS::ApiGateway::Method
    - Properties: !!omap
      - ApiKeyRequired: false
      - AuthorizationType: NONE
      - HttpMethod: OPTIONS
      - Integration: !!omap
        - IntegrationResponses:
          - !!omap
            - ResponseParameters: !!omap
              - method.response.header.Access-Control-Allow-Headers: '''Content-Type,
                  Access-Control-Allow-Headers, X-Requested-With, Authorization'''
              - method.response.header.Access-Control-Allow-Origin: '''*'''
              - method.response.header.Access-Control-Allow-Methods: '''GET,PATCH,DELETE,OPTIONS'''
            - StatusCode: '204'
        - RequestTemplates: !!omap
          - application/json: '{ statusCode: 200 }'
        - Type: MOCK
      - MethodResponses:
        - !!omap
          - ResponseParameters: !!omap
            - method.response.header.Access-Control-Allow-Headers: true
            - method.response.header.Access-Control-Allow-Origin: true
            - method.response.header.Access-Control-Allow-Methods: true
          - StatusCode: '204'
      - ResourceId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsuseCaseId1B4DA213
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: A Custom authorizer must be used in order to authenticate using
                Cognito user groups
            - id: AwsSolutions-COG4
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsuseCaseIdPATCHApiPermissionDeploymentPlatformStackUseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLaEFA75A42
    : !!omap
    - Type: AWS::Lambda::Permission
    - Properties: !!omap
      - Action: lambda:InvokeFunction
      - FunctionName: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
          - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementUseCaseMgmt7269A93AArn
      - Principal: apigateway.amazonaws.com
      - SourceArn: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':execute-api:'
            - !!omap
              - Ref: AWS::Region
            - ':'
            - !!omap
              - Ref: AWS::AccountId
            - ':'
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
            - /
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiDeploymentStageprodE2564A5F
            - /PATCH/deployments/*
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsuseCaseIdPATCHApiPermissionTestDeploymentPlatformStackUseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPoiF45B02D6
    : !!omap
    - Type: AWS::Lambda::Permission
    - Properties: !!omap
      - Action: lambda:InvokeFunction
      - FunctionName: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
          - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementUseCaseMgmt7269A93AArn
      - Principal: apigateway.amazonaws.com
      - SourceArn: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':execute-api:'
            - !!omap
              - Ref: AWS::Region
            - ':'
            - !!omap
              - Ref: AWS::AccountId
            - ':'
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
            - /test-invoke-stage/PATCH/deployments/*
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsuseCaseIdPATCHB08FB161: !!omap
    - Type: AWS::ApiGateway::Method
    - Properties: !!omap
      - AuthorizationType: CUSTOM
      - AuthorizerId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorRestCustomRequestAuthorizerCDD89059
      - HttpMethod: PATCH
      - Integration: !!omap
        - IntegrationHttpMethod: POST
        - PassthroughBehavior: NEVER
        - Type: AWS_PROXY
        - Uri: !!omap
          - Fn::Join:
            - ''
            - - 'arn:'
              - !!omap
                - Ref: AWS::Partition
              - ':apigateway:'
              - !!omap
                - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - !!omap
                - Fn::GetAtt:
                  - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
                  - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementUseCaseMgmt7269A93AArn
              - /invocations
      - MethodResponses:
        - !!omap
          - ResponseModels: !!omap
            - application/json: !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointUpdateUseCaseResponseModel43C6C5F9
          - StatusCode: '200'
      - OperationName: UpdateUseCase
      - RequestModels: !!omap
        - application/json: !!omap
          - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointUpdateUseCaseApiBodyModel556ECDCC
      - RequestParameters: !!omap
        - method.request.header.authorization: true
      - RequestValidatorId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointRequestValidator38E09551
      - ResourceId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsuseCaseId1B4DA213
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: A Custom authorizer must be used in order to authenticate using
                Cognito user groups
            - id: AwsSolutions-COG4
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsuseCaseIdDELETEApiPermissionDeploymentPlatformStackUseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLC92042FA
    : !!omap
    - Type: AWS::Lambda::Permission
    - Properties: !!omap
      - Action: lambda:InvokeFunction
      - FunctionName: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
          - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementUseCaseMgmt7269A93AArn
      - Principal: apigateway.amazonaws.com
      - SourceArn: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':execute-api:'
            - !!omap
              - Ref: AWS::Region
            - ':'
            - !!omap
              - Ref: AWS::AccountId
            - ':'
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
            - /
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiDeploymentStageprodE2564A5F
            - /DELETE/deployments/*
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsuseCaseIdDELETEApiPermissionTestDeploymentPlatformStackUseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPoF340F832
    : !!omap
    - Type: AWS::Lambda::Permission
    - Properties: !!omap
      - Action: lambda:InvokeFunction
      - FunctionName: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
          - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementUseCaseMgmt7269A93AArn
      - Principal: apigateway.amazonaws.com
      - SourceArn: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':execute-api:'
            - !!omap
              - Ref: AWS::Region
            - ':'
            - !!omap
              - Ref: AWS::AccountId
            - ':'
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
            - /test-invoke-stage/DELETE/deployments/*
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsuseCaseIdDELETE1F46F92B
    : !!omap
    - Type: AWS::ApiGateway::Method
    - Properties: !!omap
      - AuthorizationType: CUSTOM
      - AuthorizerId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorRestCustomRequestAuthorizerCDD89059
      - HttpMethod: DELETE
      - Integration: !!omap
        - IntegrationHttpMethod: POST
        - PassthroughBehavior: NEVER
        - Type: AWS_PROXY
        - Uri: !!omap
          - Fn::Join:
            - ''
            - - 'arn:'
              - !!omap
                - Ref: AWS::Partition
              - ':apigateway:'
              - !!omap
                - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - !!omap
                - Fn::GetAtt:
                  - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
                  - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementUseCaseMgmt7269A93AArn
              - /invocations
      - OperationName: DeleteUseCase
      - RequestParameters: !!omap
        - method.request.querystring.permanent: false
        - method.request.header.authorization: true
      - RequestValidatorId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointRequestValidator38E09551
      - ResourceId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsuseCaseId1B4DA213
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: A Custom authorizer must be used in order to authenticate using
                Cognito user groups
            - id: AwsSolutions-COG4
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsuseCaseIdGETApiPermissionDeploymentPlatformStackUseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLamb2FB1BC7D
    : !!omap
    - Type: AWS::Lambda::Permission
    - Properties: !!omap
      - Action: lambda:InvokeFunction
      - FunctionName: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
          - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementUseCaseMgmt7269A93AArn
      - Principal: apigateway.amazonaws.com
      - SourceArn: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':execute-api:'
            - !!omap
              - Ref: AWS::Region
            - ':'
            - !!omap
              - Ref: AWS::AccountId
            - ':'
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
            - /
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiDeploymentStageprodE2564A5F
            - /GET/deployments/*
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsuseCaseIdGETApiPermissionTestDeploymentPlatformStackUseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointD9FCB66E
    : !!omap
    - Type: AWS::Lambda::Permission
    - Properties: !!omap
      - Action: lambda:InvokeFunction
      - FunctionName: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
          - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementUseCaseMgmt7269A93AArn
      - Principal: apigateway.amazonaws.com
      - SourceArn: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':execute-api:'
            - !!omap
              - Ref: AWS::Region
            - ':'
            - !!omap
              - Ref: AWS::AccountId
            - ':'
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
            - /test-invoke-stage/GET/deployments/*
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsuseCaseIdGET49E7D36E: !!omap
    - Type: AWS::ApiGateway::Method
    - Properties: !!omap
      - AuthorizationType: CUSTOM
      - AuthorizerId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorRestCustomRequestAuthorizerCDD89059
      - HttpMethod: GET
      - Integration: !!omap
        - IntegrationHttpMethod: POST
        - PassthroughBehavior: NEVER
        - Type: AWS_PROXY
        - Uri: !!omap
          - Fn::Join:
            - ''
            - - 'arn:'
              - !!omap
                - Ref: AWS::Partition
              - ':apigateway:'
              - !!omap
                - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - !!omap
                - Fn::GetAtt:
                  - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
                  - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementUseCaseMgmt7269A93AArn
              - /invocations
      - OperationName: GetUseCase
      - RequestParameters: !!omap
        - method.request.header.authorization: true
      - RequestValidatorId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointRequestValidator38E09551
      - ResourceId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsuseCaseId1B4DA213
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: A Custom authorizer must be used in order to authenticate using
                Cognito user groups
            - id: AwsSolutions-COG4
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsOPTIONS226E9606: !!omap
    - Type: AWS::ApiGateway::Method
    - Properties: !!omap
      - ApiKeyRequired: false
      - AuthorizationType: NONE
      - HttpMethod: OPTIONS
      - Integration: !!omap
        - IntegrationResponses:
          - !!omap
            - ResponseParameters: !!omap
              - method.response.header.Access-Control-Allow-Headers: '''Content-Type,
                  Access-Control-Allow-Headers, X-Requested-With, Authorization'''
              - method.response.header.Access-Control-Allow-Origin: '''*'''
              - method.response.header.Access-Control-Allow-Methods: '''POST,GET,OPTIONS'''
            - StatusCode: '204'
        - RequestTemplates: !!omap
          - application/json: '{ statusCode: 200 }'
        - Type: MOCK
      - MethodResponses:
        - !!omap
          - ResponseParameters: !!omap
            - method.response.header.Access-Control-Allow-Headers: true
            - method.response.header.Access-Control-Allow-Origin: true
            - method.response.header.Access-Control-Allow-Methods: true
          - StatusCode: '204'
      - ResourceId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsBB1D9109
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: A Custom authorizer must be used in order to authenticate using
                Cognito user groups
            - id: AwsSolutions-COG4
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsGETApiPermissionDeploymentPlatformStackUseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApi80725706
    : !!omap
    - Type: AWS::Lambda::Permission
    - Properties: !!omap
      - Action: lambda:InvokeFunction
      - FunctionName: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
          - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementUseCaseMgmt7269A93AArn
      - Principal: apigateway.amazonaws.com
      - SourceArn: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':execute-api:'
            - !!omap
              - Ref: AWS::Region
            - ':'
            - !!omap
              - Ref: AWS::AccountId
            - ':'
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
            - /
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiDeploymentStageprodE2564A5F
            - /GET/deployments
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsGETApiPermissionTestDeploymentPlatformStackUseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRes1B0F83BA
    : !!omap
    - Type: AWS::Lambda::Permission
    - Properties: !!omap
      - Action: lambda:InvokeFunction
      - FunctionName: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
          - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementUseCaseMgmt7269A93AArn
      - Principal: apigateway.amazonaws.com
      - SourceArn: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':execute-api:'
            - !!omap
              - Ref: AWS::Region
            - ':'
            - !!omap
              - Ref: AWS::AccountId
            - ':'
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
            - /test-invoke-stage/GET/deployments
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsGET93EE3992: !!omap
    - Type: AWS::ApiGateway::Method
    - Properties: !!omap
      - AuthorizationType: CUSTOM
      - AuthorizerId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorRestCustomRequestAuthorizerCDD89059
      - HttpMethod: GET
      - Integration: !!omap
        - IntegrationHttpMethod: POST
        - PassthroughBehavior: NEVER
        - Type: AWS_PROXY
        - Uri: !!omap
          - Fn::Join:
            - ''
            - - 'arn:'
              - !!omap
                - Ref: AWS::Partition
              - ':apigateway:'
              - !!omap
                - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - !!omap
                - Fn::GetAtt:
                  - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
                  - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementUseCaseMgmt7269A93AArn
              - /invocations
      - OperationName: GetUseCases
      - RequestParameters: !!omap
        - method.request.querystring.pageNumber: true
        - method.request.querystring.searchFilter: false
        - method.request.header.authorization: true
      - RequestValidatorId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointRequestValidator38E09551
      - ResourceId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsBB1D9109
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: A Custom authorizer must be used in order to authenticate using
                Cognito user groups
            - id: AwsSolutions-COG4
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsPOSTApiPermissionDeploymentPlatformStackUseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestAp2440C5F6
    : !!omap
    - Type: AWS::Lambda::Permission
    - Properties: !!omap
      - Action: lambda:InvokeFunction
      - FunctionName: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
          - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementUseCaseMgmt7269A93AArn
      - Principal: apigateway.amazonaws.com
      - SourceArn: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':execute-api:'
            - !!omap
              - Ref: AWS::Region
            - ':'
            - !!omap
              - Ref: AWS::AccountId
            - ':'
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
            - /
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiDeploymentStageprodE2564A5F
            - /POST/deployments
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsPOSTApiPermissionTestDeploymentPlatformStackUseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaReB233F758
    : !!omap
    - Type: AWS::Lambda::Permission
    - Properties: !!omap
      - Action: lambda:InvokeFunction
      - FunctionName: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
          - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementUseCaseMgmt7269A93AArn
      - Principal: apigateway.amazonaws.com
      - SourceArn: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':execute-api:'
            - !!omap
              - Ref: AWS::Region
            - ':'
            - !!omap
              - Ref: AWS::AccountId
            - ':'
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
            - /test-invoke-stage/POST/deployments
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsPOST68876F12: !!omap
    - Type: AWS::ApiGateway::Method
    - Properties: !!omap
      - AuthorizationType: CUSTOM
      - AuthorizerId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorRestCustomRequestAuthorizerCDD89059
      - HttpMethod: POST
      - Integration: !!omap
        - IntegrationHttpMethod: POST
        - PassthroughBehavior: NEVER
        - Type: AWS_PROXY
        - Uri: !!omap
          - Fn::Join:
            - ''
            - - 'arn:'
              - !!omap
                - Ref: AWS::Partition
              - ':apigateway:'
              - !!omap
                - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - !!omap
                - Fn::GetAtt:
                  - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
                  - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementUseCaseMgmt7269A93AArn
              - /invocations
      - MethodResponses:
        - !!omap
          - ResponseModels: !!omap
            - application/json: !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeployUseCaseResponseModel053210C2
          - StatusCode: '200'
      - OperationName: DeployUseCase
      - RequestModels: !!omap
        - application/json: !!omap
          - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeployUseCaseApiBodyModel2E7FF7C8
      - RequestParameters: !!omap
        - method.request.header.authorization: true
      - RequestValidatorId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointRequestValidator38E09551
      - ResourceId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApideploymentsBB1D9109
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: A Custom authorizer must be used in order to authenticate using
                Cognito user groups
            - id: AwsSolutions-COG4
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfo471EE02C: !!omap
    - Type: AWS::ApiGateway::Resource
    - Properties: !!omap
      - ParentId: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
          - RootResourceId
      - PathPart: model-info
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfousecasetypes44F4208C: !!omap
    - Type: AWS::ApiGateway::Resource
    - Properties: !!omap
      - ParentId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfo471EE02C
      - PathPart: use-case-types
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfousecasetypesOPTIONSA2D8A0E9
    : !!omap
    - Type: AWS::ApiGateway::Method
    - Properties: !!omap
      - ApiKeyRequired: false
      - AuthorizationType: NONE
      - HttpMethod: OPTIONS
      - Integration: !!omap
        - IntegrationResponses:
          - !!omap
            - ResponseParameters: !!omap
              - method.response.header.Access-Control-Allow-Headers: '''Content-Type,
                  Access-Control-Allow-Headers, X-Requested-With, Authorization'''
              - method.response.header.Access-Control-Allow-Origin: '''*'''
              - method.response.header.Access-Control-Allow-Methods: '''GET,OPTIONS'''
            - StatusCode: '204'
        - RequestTemplates: !!omap
          - application/json: '{ statusCode: 200 }'
        - Type: MOCK
      - MethodResponses:
        - !!omap
          - ResponseParameters: !!omap
            - method.response.header.Access-Control-Allow-Headers: true
            - method.response.header.Access-Control-Allow-Origin: true
            - method.response.header.Access-Control-Allow-Methods: true
          - StatusCode: '204'
      - ResourceId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfousecasetypes44F4208C
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: A Custom authorizer must be used in order to authenticate using
                Cognito user groups
            - id: AwsSolutions-COG4
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfousecasetypesGETApiPermissionDeploymentPlatformStackUseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLam318D8722
    : !!omap
    - Type: AWS::Lambda::Permission
    - Properties: !!omap
      - Action: lambda:InvokeFunction
      - FunctionName: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
          - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementModelInfo57CA1403Arn
      - Principal: apigateway.amazonaws.com
      - SourceArn: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':execute-api:'
            - !!omap
              - Ref: AWS::Region
            - ':'
            - !!omap
              - Ref: AWS::AccountId
            - ':'
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
            - /
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiDeploymentStageprodE2564A5F
            - /GET/model-info/use-case-types
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfousecasetypesGETApiPermissionTestDeploymentPlatformStackUseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPoin17A94506
    : !!omap
    - Type: AWS::Lambda::Permission
    - Properties: !!omap
      - Action: lambda:InvokeFunction
      - FunctionName: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
          - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementModelInfo57CA1403Arn
      - Principal: apigateway.amazonaws.com
      - SourceArn: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':execute-api:'
            - !!omap
              - Ref: AWS::Region
            - ':'
            - !!omap
              - Ref: AWS::AccountId
            - ':'
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
            - /test-invoke-stage/GET/model-info/use-case-types
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfousecasetypesGETFE1D2400: !!omap
    - Type: AWS::ApiGateway::Method
    - Properties: !!omap
      - AuthorizationType: CUSTOM
      - AuthorizerId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorRestCustomRequestAuthorizerCDD89059
      - HttpMethod: GET
      - Integration: !!omap
        - IntegrationHttpMethod: POST
        - PassthroughBehavior: NEVER
        - Type: AWS_PROXY
        - Uri: !!omap
          - Fn::Join:
            - ''
            - - 'arn:'
              - !!omap
                - Ref: AWS::Partition
              - ':apigateway:'
              - !!omap
                - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - !!omap
                - Fn::GetAtt:
                  - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
                  - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementModelInfo57CA1403Arn
              - /invocations
      - OperationName: GetUseCaseTypes
      - RequestParameters: !!omap
        - method.request.header.authorization: true
      - RequestValidatorId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointRequestValidator38E09551
      - ResourceId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfousecasetypes44F4208C
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: A Custom authorizer must be used in order to authenticate using
                Cognito user groups
            - id: AwsSolutions-COG4
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeCC855208: !!omap
    - Type: AWS::ApiGateway::Resource
    - Properties: !!omap
      - ParentId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfo471EE02C
      - PathPart: '{useCaseType}'
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeprovidersD9729BFA
    : !!omap
    - Type: AWS::ApiGateway::Resource
    - Properties: !!omap
      - ParentId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeCC855208
      - PathPart: providers
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeprovidersOPTIONSDD79CF85
    : !!omap
    - Type: AWS::ApiGateway::Method
    - Properties: !!omap
      - ApiKeyRequired: false
      - AuthorizationType: NONE
      - HttpMethod: OPTIONS
      - Integration: !!omap
        - IntegrationResponses:
          - !!omap
            - ResponseParameters: !!omap
              - method.response.header.Access-Control-Allow-Headers: '''Content-Type,
                  Access-Control-Allow-Headers, X-Requested-With, Authorization'''
              - method.response.header.Access-Control-Allow-Origin: '''*'''
              - method.response.header.Access-Control-Allow-Methods: '''GET,OPTIONS'''
            - StatusCode: '204'
        - RequestTemplates: !!omap
          - application/json: '{ statusCode: 200 }'
        - Type: MOCK
      - MethodResponses:
        - !!omap
          - ResponseParameters: !!omap
            - method.response.header.Access-Control-Allow-Headers: true
            - method.response.header.Access-Control-Allow-Origin: true
            - method.response.header.Access-Control-Allow-Methods: true
          - StatusCode: '204'
      - ResourceId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeprovidersD9729BFA
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: A Custom authorizer must be used in order to authenticate using
                Cognito user groups
            - id: AwsSolutions-COG4
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeprovidersGETApiPermissionDeploymentPlatformStackUseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEnd6FD79C86
    : !!omap
    - Type: AWS::Lambda::Permission
    - Properties: !!omap
      - Action: lambda:InvokeFunction
      - FunctionName: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
          - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementModelInfo57CA1403Arn
      - Principal: apigateway.amazonaws.com
      - SourceArn: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':execute-api:'
            - !!omap
              - Ref: AWS::Region
            - ':'
            - !!omap
              - Ref: AWS::AccountId
            - ':'
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
            - /
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiDeploymentStageprodE2564A5F
            - /GET/model-info/*/providers
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeprovidersGETApiPermissionTestDeploymentPlatformStackUseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRes99FB5804
    : !!omap
    - Type: AWS::Lambda::Permission
    - Properties: !!omap
      - Action: lambda:InvokeFunction
      - FunctionName: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
          - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementModelInfo57CA1403Arn
      - Principal: apigateway.amazonaws.com
      - SourceArn: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':execute-api:'
            - !!omap
              - Ref: AWS::Region
            - ':'
            - !!omap
              - Ref: AWS::AccountId
            - ':'
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
            - /test-invoke-stage/GET/model-info/*/providers
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeprovidersGET54F880DB
    : !!omap
    - Type: AWS::ApiGateway::Method
    - Properties: !!omap
      - AuthorizationType: CUSTOM
      - AuthorizerId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorRestCustomRequestAuthorizerCDD89059
      - HttpMethod: GET
      - Integration: !!omap
        - IntegrationHttpMethod: POST
        - PassthroughBehavior: NEVER
        - Type: AWS_PROXY
        - Uri: !!omap
          - Fn::Join:
            - ''
            - - 'arn:'
              - !!omap
                - Ref: AWS::Partition
              - ':apigateway:'
              - !!omap
                - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - !!omap
                - Fn::GetAtt:
                  - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
                  - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementModelInfo57CA1403Arn
              - /invocations
      - OperationName: GetModelProviders
      - RequestParameters: !!omap
        - method.request.header.authorization: true
      - RequestValidatorId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointRequestValidator38E09551
      - ResourceId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeprovidersD9729BFA
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: A Custom authorizer must be used in order to authenticate using
                Cognito user groups
            - id: AwsSolutions-COG4
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeproviderNameC996A9BE
    : !!omap
    - Type: AWS::ApiGateway::Resource
    - Properties: !!omap
      - ParentId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeCC855208
      - PathPart: '{providerName}'
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeproviderNameOPTIONS481D07FD
    : !!omap
    - Type: AWS::ApiGateway::Method
    - Properties: !!omap
      - ApiKeyRequired: false
      - AuthorizationType: NONE
      - HttpMethod: OPTIONS
      - Integration: !!omap
        - IntegrationResponses:
          - !!omap
            - ResponseParameters: !!omap
              - method.response.header.Access-Control-Allow-Headers: '''Content-Type,
                  Access-Control-Allow-Headers, X-Requested-With, Authorization'''
              - method.response.header.Access-Control-Allow-Origin: '''*'''
              - method.response.header.Access-Control-Allow-Methods: '''GET,OPTIONS'''
            - StatusCode: '204'
        - RequestTemplates: !!omap
          - application/json: '{ statusCode: 200 }'
        - Type: MOCK
      - MethodResponses:
        - !!omap
          - ResponseParameters: !!omap
            - method.response.header.Access-Control-Allow-Headers: true
            - method.response.header.Access-Control-Allow-Origin: true
            - method.response.header.Access-Control-Allow-Methods: true
          - StatusCode: '204'
      - ResourceId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeproviderNameC996A9BE
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: A Custom authorizer must be used in order to authenticate using
                Cognito user groups
            - id: AwsSolutions-COG4
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeproviderNameGETApiPermissionDeploymentPlatformStackUseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestB185C368
    : !!omap
    - Type: AWS::Lambda::Permission
    - Properties: !!omap
      - Action: lambda:InvokeFunction
      - FunctionName: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
          - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementModelInfo57CA1403Arn
      - Principal: apigateway.amazonaws.com
      - SourceArn: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':execute-api:'
            - !!omap
              - Ref: AWS::Region
            - ':'
            - !!omap
              - Ref: AWS::AccountId
            - ':'
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
            - /
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiDeploymentStageprodE2564A5F
            - /GET/model-info/*/*
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeproviderNameGETApiPermissionTestDeploymentPlatformStackUseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeployment5EF8DE70
    : !!omap
    - Type: AWS::Lambda::Permission
    - Properties: !!omap
      - Action: lambda:InvokeFunction
      - FunctionName: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
          - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementModelInfo57CA1403Arn
      - Principal: apigateway.amazonaws.com
      - SourceArn: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':execute-api:'
            - !!omap
              - Ref: AWS::Region
            - ':'
            - !!omap
              - Ref: AWS::AccountId
            - ':'
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
            - /test-invoke-stage/GET/model-info/*/*
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeproviderNameGET6D685A8B
    : !!omap
    - Type: AWS::ApiGateway::Method
    - Properties: !!omap
      - AuthorizationType: CUSTOM
      - AuthorizerId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorRestCustomRequestAuthorizerCDD89059
      - HttpMethod: GET
      - Integration: !!omap
        - IntegrationHttpMethod: POST
        - PassthroughBehavior: NEVER
        - Type: AWS_PROXY
        - Uri: !!omap
          - Fn::Join:
            - ''
            - - 'arn:'
              - !!omap
                - Ref: AWS::Partition
              - ':apigateway:'
              - !!omap
                - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - !!omap
                - Fn::GetAtt:
                  - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
                  - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementModelInfo57CA1403Arn
              - /invocations
      - OperationName: GetModels
      - RequestParameters: !!omap
        - method.request.header.authorization: true
      - RequestValidatorId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointRequestValidator38E09551
      - ResourceId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeproviderNameC996A9BE
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: A Custom authorizer must be used in order to authenticate using
                Cognito user groups
            - id: AwsSolutions-COG4
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeproviderNamemodelId88C0A3B5
    : !!omap
    - Type: AWS::ApiGateway::Resource
    - Properties: !!omap
      - ParentId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeproviderNameC996A9BE
      - PathPart: '{modelId}'
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeproviderNamemodelIdOPTIONS7646D3AE
    : !!omap
    - Type: AWS::ApiGateway::Method
    - Properties: !!omap
      - ApiKeyRequired: false
      - AuthorizationType: NONE
      - HttpMethod: OPTIONS
      - Integration: !!omap
        - IntegrationResponses:
          - !!omap
            - ResponseParameters: !!omap
              - method.response.header.Access-Control-Allow-Headers: '''Content-Type,
                  Access-Control-Allow-Headers, X-Requested-With, Authorization'''
              - method.response.header.Access-Control-Allow-Origin: '''*'''
              - method.response.header.Access-Control-Allow-Methods: '''GET,OPTIONS'''
            - StatusCode: '204'
        - RequestTemplates: !!omap
          - application/json: '{ statusCode: 200 }'
        - Type: MOCK
      - MethodResponses:
        - !!omap
          - ResponseParameters: !!omap
            - method.response.header.Access-Control-Allow-Headers: true
            - method.response.header.Access-Control-Allow-Origin: true
            - method.response.header.Access-Control-Allow-Methods: true
          - StatusCode: '204'
      - ResourceId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeproviderNamemodelId88C0A3B5
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: A Custom authorizer must be used in order to authenticate using
                Cognito user groups
            - id: AwsSolutions-COG4
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeproviderNamemodelIdGETApiPermissionDeploymentPlatformStackUseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymAD282245
    : !!omap
    - Type: AWS::Lambda::Permission
    - Properties: !!omap
      - Action: lambda:InvokeFunction
      - FunctionName: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
          - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementModelInfo57CA1403Arn
      - Principal: apigateway.amazonaws.com
      - SourceArn: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':execute-api:'
            - !!omap
              - Ref: AWS::Region
            - ':'
            - !!omap
              - Ref: AWS::AccountId
            - ':'
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
            - /
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiDeploymentStageprodE2564A5F
            - /GET/model-info/*/*/*
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeproviderNamemodelIdGETApiPermissionTestDeploymentPlatformStackUseCaseManagementSetupRequestProcessorDeploymentRestEndpointDep21F372CE
    : !!omap
    - Type: AWS::Lambda::Permission
    - Properties: !!omap
      - Action: lambda:InvokeFunction
      - FunctionName: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
          - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementModelInfo57CA1403Arn
      - Principal: apigateway.amazonaws.com
      - SourceArn: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':execute-api:'
            - !!omap
              - Ref: AWS::Region
            - ':'
            - !!omap
              - Ref: AWS::AccountId
            - ':'
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
            - /test-invoke-stage/GET/model-info/*/*/*
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeproviderNamemodelIdGET1CDDE10A
    : !!omap
    - Type: AWS::ApiGateway::Method
    - Properties: !!omap
      - AuthorizationType: CUSTOM
      - AuthorizerId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorRestCustomRequestAuthorizerCDD89059
      - HttpMethod: GET
      - Integration: !!omap
        - IntegrationHttpMethod: POST
        - PassthroughBehavior: NEVER
        - Type: AWS_PROXY
        - Uri: !!omap
          - Fn::Join:
            - ''
            - - 'arn:'
              - !!omap
                - Ref: AWS::Partition
              - ':apigateway:'
              - !!omap
                - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - !!omap
                - Fn::GetAtt:
                  - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
                  - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementModelInfo57CA1403Arn
              - /invocations
      - OperationName: GetModelInfo
      - RequestParameters: !!omap
        - method.request.header.authorization: true
      - RequestValidatorId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointRequestValidator38E09551
      - ResourceId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApimodelinfouseCaseTypeproviderNamemodelId88C0A3B5
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: A Custom authorizer must be used in order to authenticate using
                Cognito user groups
            - id: AwsSolutions-COG4
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApifeedback61DB2B5B: !!omap
    - Type: AWS::ApiGateway::Resource
    - Properties: !!omap
      - ParentId: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
          - RootResourceId
      - PathPart: feedback
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
    - Condition: CreateFeedbackResources
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApifeedbackuseCaseIdEE4BB80E: !!omap
    - Type: AWS::ApiGateway::Resource
    - Properties: !!omap
      - ParentId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApifeedback61DB2B5B
      - PathPart: '{useCaseId}'
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
    - Condition: CreateFeedbackResources
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApifeedbackuseCaseIdOPTIONS144DB212: !!omap
    - Type: AWS::ApiGateway::Method
    - Properties: !!omap
      - ApiKeyRequired: false
      - AuthorizationType: NONE
      - HttpMethod: OPTIONS
      - Integration: !!omap
        - IntegrationResponses:
          - !!omap
            - ResponseParameters: !!omap
              - method.response.header.Access-Control-Allow-Headers: '''Content-Type,
                  Access-Control-Allow-Headers, X-Requested-With, Authorization'''
              - method.response.header.Access-Control-Allow-Origin: '''*'''
              - method.response.header.Access-Control-Allow-Methods: '''POST,OPTIONS'''
            - StatusCode: '204'
        - RequestTemplates: !!omap
          - application/json: '{ statusCode: 200 }'
        - Type: MOCK
      - MethodResponses:
        - !!omap
          - ResponseParameters: !!omap
            - method.response.header.Access-Control-Allow-Headers: true
            - method.response.header.Access-Control-Allow-Origin: true
            - method.response.header.Access-Control-Allow-Methods: true
          - StatusCode: '204'
      - ResourceId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApifeedbackuseCaseIdEE4BB80E
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
    - Condition: CreateFeedbackResources
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApifeedbackuseCaseIdPOSTApiPermissionDeploymentPlatformStackUseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaC894672C
    : !!omap
    - Type: AWS::Lambda::Permission
    - Properties: !!omap
      - Action: lambda:InvokeFunction
      - FunctionName: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupFeedbackSetupStackNestedStackFeedbackSetupStackNestedStackResourceCA537136
          - Outputs.DeploymentPlatformStackUseCaseManagementSetupFeedbackSetupStackFeedbackManagementLambdaD5D27D85Arn
      - Principal: apigateway.amazonaws.com
      - SourceArn: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':execute-api:'
            - !!omap
              - Ref: AWS::Region
            - ':'
            - !!omap
              - Ref: AWS::AccountId
            - ':'
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
            - /
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiDeploymentStageprodE2564A5F
            - /POST/feedback/*
    - Condition: CreateFeedbackResources
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApifeedbackuseCaseIdPOSTApiPermissionTestDeploymentPlatformStackUseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLaA104131F
    : !!omap
    - Type: AWS::Lambda::Permission
    - Properties: !!omap
      - Action: lambda:InvokeFunction
      - FunctionName: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupFeedbackSetupStackNestedStackFeedbackSetupStackNestedStackResourceCA537136
          - Outputs.DeploymentPlatformStackUseCaseManagementSetupFeedbackSetupStackFeedbackManagementLambdaD5D27D85Arn
      - Principal: apigateway.amazonaws.com
      - SourceArn: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':execute-api:'
            - !!omap
              - Ref: AWS::Region
            - ':'
            - !!omap
              - Ref: AWS::AccountId
            - ':'
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
            - /test-invoke-stage/POST/feedback/*
    - Condition: CreateFeedbackResources
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApifeedbackuseCaseIdPOST3C555B45: !!omap
    - Type: AWS::ApiGateway::Method
    - Properties: !!omap
      - AuthorizationType: CUSTOM
      - AuthorizerId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorRestCustomRequestAuthorizerCDD89059
      - HttpMethod: POST
      - Integration: !!omap
        - IntegrationHttpMethod: POST
        - PassthroughBehavior: NEVER
        - Type: AWS_PROXY
        - Uri: !!omap
          - Fn::Join:
            - ''
            - - 'arn:'
              - !!omap
                - Ref: AWS::Partition
              - ':apigateway:'
              - !!omap
                - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - !!omap
                - Fn::GetAtt:
                  - UseCaseManagementSetupFeedbackSetupStackNestedStackFeedbackSetupStackNestedStackResourceCA537136
                  - Outputs.DeploymentPlatformStackUseCaseManagementSetupFeedbackSetupStackFeedbackManagementLambdaD5D27D85Arn
              - /invocations
      - OperationName: SubmitFeedback
      - RequestModels: !!omap
        - application/json: !!omap
          - Fn::GetAtt:
            - UseCaseManagementSetupFeedbackSetupStackNestedStackFeedbackSetupStackNestedStackResourceCA537136
            - Outputs.DeploymentPlatformStackUseCaseManagementSetupFeedbackSetupStackProvideFeedbackApiRequestModelFAFB6D72Ref
      - RequestParameters: !!omap
        - method.request.header.authorization: true
      - RequestValidatorId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointRequestValidator38E09551
      - ResourceId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApifeedbackuseCaseIdEE4BB80E
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: A Custom authorizer must be used in order to authenticate using
                Cognito user groups
            - id: AwsSolutions-COG4
    - Condition: CreateFeedbackResources
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiUsagePlanD00ABF48: !!omap
    - Type: AWS::ApiGateway::UsagePlan
    - Properties: !!omap
      - ApiStages:
        - !!omap
          - ApiId: !!omap
            - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
          - Stage: !!omap
            - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiDeploymentStageprodE2564A5F
          - Throttle: !!omap []
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiCloudWatchRole15571B15: !!omap
    - Type: AWS::IAM::Role
    - Properties: !!omap
      - AssumeRolePolicyDocument: !!omap
        - Statement:
          - !!omap
            - Action: sts:AssumeRole
            - Effect: Allow
            - Principal: !!omap
              - Service: apigateway.amazonaws.com
        - Version: '2012-10-17'
      - Policies:
        - !!omap
          - PolicyDocument: !!omap
            - Statement:
              - !!omap
                - Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                  - logs:DescribeLogGroups
                  - logs:DescribeLogStreams
                  - logs:FilterLogEvents
                  - logs:GetLogEvents
                  - logs:PutLogEvents
                - Effect: Allow
                - Resource: !!omap
                  - Fn::Join:
                    - ''
                    - - 'arn:'
                      - !!omap
                        - Ref: AWS::Partition
                      - ':logs:'
                      - !!omap
                        - Ref: AWS::Region
                      - ':'
                      - !!omap
                        - Ref: AWS::AccountId
                      - :*
            - Version: '2012-10-17'
          - PolicyName: LambdaRestApiCloudWatchRolePolicy
    - Metadata: !!omap
      - guard: !!omap
        - SuppressedRules:
          - IAM_NO_INLINE_POLICY_CHECK
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: Permission generated by the ApiGatewayToLambda construct to
                allow CloudWatch Logs to be used
            - id: AwsSolutions-IAM5
            - applies_to:
              - Resource::arn:<AWS::Partition>:logs:<AWS::Region>:<AWS::AccountId>:*
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiAccount38FC82FE: !!omap
    - Type: AWS::ApiGateway::Account
    - Properties: !!omap
      - CloudWatchRoleArn: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiCloudWatchRole15571B15
          - Arn
    - DependsOn:
      - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointRequestValidator38E09551: !!omap
    - Type: AWS::ApiGateway::RequestValidator
    - Properties: !!omap
      - Name: !!omap
        - Fn::Join:
          - ''
          - - !!omap
              - Ref: AWS::StackName
            - -api-request-validator
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
      - ValidateRequestBody: true
      - ValidateRequestParameters: true
  - ? UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentPlatformEndpointWafDeploymentPlatformEndpointWafWebACL048DBCBA
    : !!omap
    - Type: AWS::WAFv2::WebACL
    - Properties: !!omap
      - CustomResponseBodies: !!omap
        - HeadersNotAllowed: !!omap
          - Content: One of your injected headers is not allowed
          - ContentType: TEXT_PLAIN
      - DefaultAction: !!omap
        - Allow: !!omap []
      - Rules:
        - !!omap
          - Name: AWS-AWSManagedRulesBotControlRuleSet
          - OverrideAction: !!omap
            - None: !!omap []
          - Priority: 0
          - Statement: !!omap
            - ManagedRuleGroupStatement: !!omap
              - Name: AWSManagedRulesBotControlRuleSet
              - VendorName: AWS
          - VisibilityConfig: !!omap
            - CloudWatchMetricsEnabled: true
            - MetricName: AWSManagedRulesBotControlRuleSet
            - SampledRequestsEnabled: true
        - !!omap
          - Name: AWS-AWSManagedRulesKnownBadInputsRuleSet
          - OverrideAction: !!omap
            - None: !!omap []
          - Priority: 1
          - Statement: !!omap
            - ManagedRuleGroupStatement: !!omap
              - Name: AWSManagedRulesKnownBadInputsRuleSet
              - VendorName: AWS
          - VisibilityConfig: !!omap
            - CloudWatchMetricsEnabled: true
            - MetricName: AWSManagedRulesKnownBadInputsRuleSet
            - SampledRequestsEnabled: true
        - !!omap
          - Name: AWS-AWSManagedRulesCommonRuleSet
          - OverrideAction: !!omap
            - None: !!omap []
          - Priority: 2
          - Statement: !!omap
            - ManagedRuleGroupStatement: !!omap
              - Name: AWSManagedRulesCommonRuleSet
              - RuleActionOverrides:
                - !!omap
                  - ActionToUse: !!omap
                    - Count: !!omap []
                  - Name: SizeRestrictions_BODY
              - VendorName: AWS
          - VisibilityConfig: !!omap
            - CloudWatchMetricsEnabled: true
            - MetricName: AWS-AWSManagedRulesCommonRuleSet
            - SampledRequestsEnabled: true
        - !!omap
          - Name: AWS-AWSManagedRulesAnonymousIpList
          - OverrideAction: !!omap
            - None: !!omap []
          - Priority: 3
          - Statement: !!omap
            - ManagedRuleGroupStatement: !!omap
              - Name: AWSManagedRulesAnonymousIpList
              - VendorName: AWS
          - VisibilityConfig: !!omap
            - CloudWatchMetricsEnabled: true
            - MetricName: AWSManagedRulesAnonymousIpList
            - SampledRequestsEnabled: true
        - !!omap
          - Name: AWS-AWSManagedRulesAmazonIpReputationList
          - OverrideAction: !!omap
            - None: !!omap []
          - Priority: 4
          - Statement: !!omap
            - ManagedRuleGroupStatement: !!omap
              - Name: AWSManagedRulesAmazonIpReputationList
              - VendorName: AWS
          - VisibilityConfig: !!omap
            - CloudWatchMetricsEnabled: true
            - MetricName: AWSManagedRulesAmazonIpReputationList
            - SampledRequestsEnabled: true
        - !!omap
          - Name: AWS-AWSManagedRulesAdminProtectionRuleSet
          - OverrideAction: !!omap
            - None: !!omap []
          - Priority: 5
          - Statement: !!omap
            - ManagedRuleGroupStatement: !!omap
              - Name: AWSManagedRulesAdminProtectionRuleSet
              - VendorName: AWS
          - VisibilityConfig: !!omap
            - CloudWatchMetricsEnabled: true
            - MetricName: AWSManagedRulesAdminProtectionRuleSet
            - SampledRequestsEnabled: true
        - !!omap
          - Name: AWS-AWSManagedRulesSQLiRuleSet
          - OverrideAction: !!omap
            - None: !!omap []
          - Priority: 6
          - Statement: !!omap
            - ManagedRuleGroupStatement: !!omap
              - Name: AWSManagedRulesSQLiRuleSet
              - VendorName: AWS
          - VisibilityConfig: !!omap
            - CloudWatchMetricsEnabled: true
            - MetricName: AWSManagedRulesSQLiRuleSet
            - SampledRequestsEnabled: true
        - !!omap
          - Action: !!omap
            - Block: !!omap
              - CustomResponse: !!omap
                - CustomResponseBodyKey: HeadersNotAllowed
                - ResponseCode: 403
          - Name: Custom-BlockRequestHeaders
          - Priority: 7
          - Statement: !!omap
            - SizeConstraintStatement: !!omap
              - ComparisonOperator: GE
              - FieldToMatch: !!omap
                - SingleHeader: !!omap
                  - Name: x-amzn-requestid
              - Size: 0
              - TextTransformations:
                - !!omap
                  - Priority: 0
                  - Type: NONE
          - VisibilityConfig: !!omap
            - CloudWatchMetricsEnabled: true
            - MetricName: Custom-BlockRequestHeaders
            - SampledRequestsEnabled: true
        - !!omap
          - Action: !!omap
            - Block: !!omap []
          - Name: Custom-BlockOversizedBodyNotInDeploy
          - Priority: 8
          - Statement: !!omap
            - AndStatement: !!omap
              - Statements:
                - !!omap
                  - LabelMatchStatement: !!omap
                    - Key: awswaf:managed:aws:core-rule-set:SizeRestrictions_Body
                    - Scope: LABEL
                - !!omap
                  - NotStatement: !!omap
                    - Statement: !!omap
                      - ByteMatchStatement: !!omap
                        - FieldToMatch: !!omap
                          - UriPath: !!omap []
                        - PositionalConstraint: ENDS_WITH
                        - SearchString: /deployments
                        - TextTransformations:
                          - !!omap
                            - Priority: 0
                            - Type: NONE
          - VisibilityConfig: !!omap
            - CloudWatchMetricsEnabled: true
            - MetricName: Custom-BlockOversizedBodyNotInDeploy
            - SampledRequestsEnabled: true
      - Scope: REGIONAL
      - VisibilityConfig: !!omap
        - CloudWatchMetricsEnabled: true
        - MetricName: webACL
        - SampledRequestsEnabled: true
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentPlatformEndpointWafWebACLAssociation37A5F031: !!omap
    - Type: AWS::WAFv2::WebACLAssociation
    - Properties: !!omap
      - ResourceArn: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':apigateway:'
            - !!omap
              - Ref: AWS::Region
            - ::/restapis/
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
            - /stages/
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiDeploymentStageprodE2564A5F
      - WebACLArn: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentPlatformEndpointWafDeploymentPlatformEndpointWafWebACL048DBCBA
          - Arn
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointBadRequestDefaultResponseE22C6436: !!omap
    - Type: AWS::ApiGateway::GatewayResponse
    - Properties: !!omap
      - ResponseParameters: !!omap
        - gatewayresponse.header.gatewayresponse.header.Access-Control-Allow-Origin: '''*'''
        - gatewayresponse.header.gatewayresponse.header.Access-Control-Allow-Headers: '''*'''
      - ResponseType: DEFAULT_4XX
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
      - StatusCode: '400'
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointInternalServerErrorDefaultResponse973BC431: !!omap
    - Type: AWS::ApiGateway::GatewayResponse
    - Properties: !!omap
      - ResponseParameters: !!omap
        - gatewayresponse.header.gatewayresponse.header.Access-Control-Allow-Origin: '''*'''
        - gatewayresponse.header.gatewayresponse.header.Access-Control-Allow-Headers: '''*'''
      - ResponseType: DEFAULT_5XX
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
      - StatusCode: '400'
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointBadRequestBodyResponseEF90EA9F: !!omap
    - Type: AWS::ApiGateway::GatewayResponse
    - Properties: !!omap
      - ResponseParameters: !!omap
        - gatewayresponse.header.gatewayresponse.header.Access-Control-Allow-Origin: '''*'''
        - gatewayresponse.header.gatewayresponse.header.Access-Control-Allow-Headers: '''*'''
      - ResponseTemplates: !!omap
        - application/json: '{"error":{"message":"$context.error.messageString","errors":"$context.error.validationErrorString"}}'
      - ResponseType: BAD_REQUEST_BODY
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
      - StatusCode: '400'
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointBadRequestParametersResponse97FE3D57: !!omap
    - Type: AWS::ApiGateway::GatewayResponse
    - Properties: !!omap
      - ResponseParameters: !!omap
        - gatewayresponse.header.gatewayresponse.header.Access-Control-Allow-Origin: '''*'''
        - gatewayresponse.header.gatewayresponse.header.Access-Control-Allow-Headers: '''*'''
      - ResponseTemplates: !!omap
        - application/json: '{"error":{"message":"$context.error.messageString","errors":"$context.error.validationErrorString"}}'
      - ResponseType: BAD_REQUEST_PARAMETERS
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
      - StatusCode: '400'
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeployUseCaseApiBodyModel2E7FF7C8: !!omap
    - Type: AWS::ApiGateway::Model
    - Properties: !!omap
      - ContentType: application/json
      - Description: Defines the required JSON structure of the POST request to deploy
          a use case
      - Name: DeployUseCaseApiBodyModel
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
      - Schema: !!omap
        - $schema: http://json-schema.org/draft-07/schema#
        - type: object
        - properties: !!omap
          - UseCaseType: !!omap
            - type: string
            - description: Type of the use case to be deployed. Either "Text" or "Agent".
            - enum:
              - Text
              - Agent
          - UseCaseName: !!omap
            - type: string
            - description: Friendly name of the use case to be deployed. For display
                purposes.
          - UseCaseDescription: !!omap
            - type: string
            - description: Description of the use case to be deployed. For display
                purposes
          - DefaultUserEmail: !!omap
            - type: string
            - description: Email address of the user who will be created with permissions
                to use the deployed use-case
            - format: email
          - DeployUI: !!omap
            - type: boolean
            - description: Deploy the CloudFront based UI for the use case
            - default: true
          - FeedbackParams: !!omap
            - type: object
            - description: Parameters for the feedback capability for the use case.
            - properties: !!omap
              - FeedbackEnabled: !!omap
                - type: boolean
                - description: Allow the feedback capability for the use case.
                - default: false
            - required:
              - FeedbackEnabled
            - additionalProperties: false
          - ExistingRestApiId: !!omap
            - type: string
            - description: Rest API ID which will be used to invoke UseCaseDetails
                (and Feedback, if enabled).
          - VpcParams: !!omap
            - type: object
            - description: Parameters for the use case VPC. VPC can be either created
                for you, or provided by the user depending on the parameters provided.
            - properties: !!omap
              - VpcEnabled: !!omap
                - type: boolean
                - description: Should the use case stacks resources be deployed within
                    a VPC
                - default: false
              - CreateNewVpc: !!omap
                - type: boolean
                - description: If true, a new VPC will be created for the use case.
                - default: false
              - ExistingVpcId: !!omap
                - type: string
                - description: If VpcEnabled is true and CreateNewVpc is false, the
                    use case will be deployed within the specified VPC.
                - pattern: ^vpc-\w{8}(\w{9})?$
              - ExistingPrivateSubnetIds: !!omap
                - type: array
                - description: If VpcEnabled is true and CreateNewVpc is false, the
                    use case will be deployed using the specified subnets.
                - items: !!omap
                  - type: string
                  - pattern: ^subnet-\w{8}(\w{9})?$
                - maxItems: 16
                - uniqueItems: true
              - ExistingSecurityGroupIds: !!omap
                - type: array
                - description: If VpcEnabled is true and CreateNewVpc is false, the
                    use case will be deployed using the specified security groups.
                - items: !!omap
                  - type: string
                  - pattern: ^sg-\w{8}(\w{9})?$
                - maxItems: 5
                - uniqueItems: true
            - oneOf:
              - !!omap
                - properties: !!omap
                  - VpcEnabled: !!omap
                    - type: boolean
                    - enum:
                      - true
                  - CreateNewVpc: !!omap
                    - type: boolean
                    - enum:
                      - false
                - required:
                  - ExistingVpcId
                  - ExistingPrivateSubnetIds
                  - ExistingSecurityGroupIds
              - !!omap
                - properties: !!omap
                  - VpcEnabled: !!omap
                    - type: boolean
                    - enum:
                      - true
                  - CreateNewVpc: !!omap
                    - type: boolean
                    - enum:
                      - true
                  - ExistingVpcId: !!omap
                    - not: !!omap []
                  - ExistingPrivateSubnetIds: !!omap
                    - not: !!omap []
                  - ExistingSecurityGroupIds: !!omap
                    - not: !!omap []
              - !!omap
                - properties: !!omap
                  - VpcEnabled: !!omap
                    - type: boolean
                    - enum:
                      - false
                  - CreateNewVpc: !!omap
                    - not: !!omap []
                  - ExistingVpcId: !!omap
                    - not: !!omap []
                  - ExistingPrivateSubnetIds: !!omap
                    - not: !!omap []
                  - ExistingSecurityGroupIds: !!omap
                    - not: !!omap []
            - required:
              - VpcEnabled
            - additionalProperties: false
          - ConversationMemoryParams: !!omap
            - type: object
            - description: Parameters related to storing and using the chat history
            - properties: !!omap
              - ConversationMemoryType: !!omap
                - type: string
                - default: DynamoDB
                - enum:
                  - DynamoDB
              - HumanPrefix: !!omap
                - type: string
                - description: Prefix used in the history when storing messages sent
                    by the user
              - AiPrefix: !!omap
                - type: string
                - description: Prefix used in the history when storing responses from
                    the LLM
              - ChatHistoryLength: !!omap
                - type: integer
                - description: Number of messages to store in the history
                - minimum: 0
            - additionalProperties: false
          - KnowledgeBaseParams: !!omap
            - type: object
            - description: Parameters related to the knowledge base. Based on KnowledgeBaseType,
                different nested parameters are required.
            - properties: !!omap
              - KnowledgeBaseType: !!omap
                - type: string
                - description: The type of knowledge base to use. Required.
                - default: Kendra
                - enum:
                  - Kendra
                  - Bedrock
              - NoDocsFoundResponse: !!omap
                - type: string
                - description: Response text message to use when the knowledge base
                    does not return any documents
                - minLength: 1
              - KendraKnowledgeBaseParams: !!omap
                - type: object
                - description: Parameters specific to Kendra
                - properties: !!omap
                  - ExistingKendraIndexId: !!omap
                    - type: string
                    - description: Index ID of an existing Kendra index to be used
                        for the use case. Required if KendraIndexName is not provided.
                    - pattern: ^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$
                  - KendraIndexName: !!omap
                    - type: string
                    - description: Name of the new Kendra index to be created, if
                        provided. Required if ExistingKendraIndexId is not provided.
                    - pattern: ^[0-9a-zA-Z-]{1,64}$
                  - QueryCapacityUnits: !!omap
                    - type: integer
                    - description: Number of additional query capacity units to provision
                        for the new Kendra index to be created. Can only be provided
                        if if ExistingKendraIndexId is not provided.
                    - default: 0
                    - minimum: 0
                    - maximum: 100
                  - StorageCapacityUnits: !!omap
                    - type: integer
                    - description: Number of additional storage capacity units to
                        provision for the new Kendra index to be created. Can only
                        be provided if if ExistingKendraIndexId is not provided.
                    - default: 0
                    - minimum: 0
                    - maximum: 100
                  - KendraIndexEdition: !!omap
                    - type: string
                    - description: Edition of the Kendra index to be created. Can
                        only be provided if if ExistingKendraIndexId is not provided.
                    - enum:
                      - DEVELOPER_EDITION
                      - ENTERPRISE_EDITION
                    - default: DEVELOPER_EDITION
                  - AttributeFilter: !!omap
                    - type: object
                    - description: 'Filter to apply when querying the Kendra index.
                        See: https://docs.aws.amazon.com/kendra/latest/APIReference/API_AttributeFilter.html'
                  - RoleBasedAccessControlEnabled: !!omap
                    - type: boolean
                    - description: Whether role-based access control is enabled on
                        the Kendra index, used to restrict Kendra queries to documents
                        accessible by user group and id.
                    - default: false
                - oneOf:
                  - !!omap
                    - required:
                      - ExistingKendraIndexId
                    - properties: !!omap
                      - KendraIndexName: !!omap
                        - not: !!omap []
                      - QueryCapacityUnits: !!omap
                        - not: !!omap []
                      - StorageCapacityUnits: !!omap
                        - not: !!omap []
                      - KendraIndexEdition: !!omap
                        - not: !!omap []
                  - !!omap
                    - required:
                      - KendraIndexName
                    - properties: !!omap
                      - ExistingKendraIndexId: !!omap
                        - not: !!omap []
                - additionalProperties: false
              - BedrockKnowledgeBaseParams: !!omap
                - type: object
                - description: Parameters specific to Bedrock Knowledge Bases
                - properties: !!omap
                  - BedrockKnowledgeBaseId: !!omap
                    - type: string
                    - description: ID of the Bedrock knowledge base to use in a RAG
                        use case. Required if KnowledgeBaseType is Bedrock.
                    - pattern: ^[0-9a-zA-Z]{1,10}$
                  - RetrievalFilter: !!omap
                    - type: object
                    - description: 'Filter to apply when querying the Bedrock knowledge
                        base. See: https://docs.aws.amazon.com/bedrock/latest/APIReference/API_agent-runtime_RetrievalFilter.html'
                  - OverrideSearchType: !!omap
                    - type: string
                    - description: If you're using an Amazon OpenSearch Serverless
                        vector store that contains a filterable text field, you can
                        specify whether to query the knowledge base with a HYBRID
                        search using both vector embeddings and raw text, or SEMANTIC
                        search using only vector embeddings. By default (if this is
                        not provided), Amazon Bedrock will choose for you. For other
                        vector store types, passing this parameter will result in
                        a validation error during retrieval. For more information,
                        see https://docs.aws.amazon.com/bedrock/latest/userguide/kb-test-config.html
                    - enum:
                      - HYBRID
                      - SEMANTIC
                      - NONE
                    - default: NONE
                - required:
                  - BedrockKnowledgeBaseId
                - additionalProperties: false
              - NumberOfDocs: !!omap
                - type: integer
                - description: The number of documents returned from the knowledge
                    base which will be used as context to be sent to the LLM
                - default: 2
                - minimum: 1
                - maximum: 100
              - ScoreThreshold: !!omap
                - type: number
                - description: The minimum score a document must have to be returned
                    from the knowledge base
                - default: 0
                - minimum: 0
                - maximum: 1
              - ReturnSourceDocs: !!omap
                - type: boolean
                - description: Whether to return information about the source of documents
                    returned from the knowledge base
                - default: false
            - oneOf:
              - !!omap
                - properties: !!omap
                  - KnowledgeBaseType: !!omap
                    - enum:
                      - Kendra
                  - BedrockKnowledgeBaseParams: !!omap
                    - not: !!omap []
                - required:
                  - KendraKnowledgeBaseParams
              - !!omap
                - properties: !!omap
                  - KnowledgeBaseType: !!omap
                    - enum:
                      - Bedrock
                  - KendraKnowledgeBaseParams: !!omap
                    - not: !!omap []
                - required:
                  - BedrockKnowledgeBaseParams
            - required:
              - KnowledgeBaseType
            - additionalProperties: false
          - AuthenticationParams: !!omap
            - type: object
            - description: Parameters related to the Authentication.
            - properties: !!omap
              - AuthenticationProvider: !!omap
                - type: string
                - description: Supported authentication provider.
                - enum:
                  - Cognito
              - CognitoParams: !!omap
                - type: object
                - description: Cognito user pool related parameters.
                - properties: !!omap
                  - ExistingUserPoolId: !!omap
                    - type: string
                    - description: Existing Cognito User Pool Id.
                    - pattern: ^[\w-]+_[0-9a-zA-Z]+$
                    - minLength: 1
                    - maxLength: 55
                  - ExistingUserPoolClientId: !!omap
                    - type: string
                    - description: Existing Cognito User Pool Client Id.
                    - pattern: ^[\w+]+$
                    - minLength: 1
                    - maxLength: 128
                - required:
                  - ExistingUserPoolId
            - anyOf:
              - !!omap
                - properties: !!omap
                  - AuthenticationProvider: !!omap
                    - enum:
                      - Cognito
                - required:
                  - CognitoParams
            - required:
              - AuthenticationProvider
          - LlmParams: !!omap
            - type: object
            - description: Parameters related to the LLM performing inferences.
            - properties: !!omap
              - ModelProvider: !!omap
                - type: string
                - description: Name of the LLM provider which the use case will use
                - enum:
                  - Bedrock
                  - SageMaker
              - BedrockLlmParams: !!omap
                - type: object
                - description: Parameters specific to use cases using Bedrock as an
                    LLM provider. Can only be provided when "ModelProvider" is Bedrock
                - properties: !!omap
                  - ModelId: !!omap
                    - type: string
                    - description: Depending on whether ModelArn is provided, this
                        will either be used to select the on-demand model to invoke
                        or be used to specify the base model that the selected provisioned/custom
                        model is based on.
                    - pattern: ^([a-z0-9-]{1,63}[.]{1}[a-z0-9-]{1,63}([.:]?[a-z0-9-]{1,63}))|(([0-9a-zA-Z][_-]?)+)$
                  - ModelArn: !!omap
                    - type: string
                    - description: 'ARN of the provisioned/custom model to use from
                        Amazon Bedrock. See: https://docs.aws.amazon.com/bedrock/latest/APIReference/API_runtime_InvokeModel.html#API_runtime_InvokeModel_RequestSyntax'
                    - pattern: ^(arn:aws(-[^:]+)?:bedrock:[a-z0-9-]{1,20}:(([0-9]{12}:custom-model/[a-z0-9-]{1,63}[.]{1}[a-z0-9-:]{1,63}/[a-z0-9]{12})|(:foundation-model/[a-z0-9-]{1,63}[.]{1}[a-z0-9-]{1,63}([.:]?[a-z0-9-]{1,63})([.:]?[a-z0-9-]{1,63}))|([0-9]{12}:provisioned-model/[a-z0-9]{12})))$
                  - InferenceProfileId: !!omap
                    - type: string
                    - description: 'The identifier of the Bedrock inference profile
                        to use when invoking the model. When provided, a ModelId and
                        ModelArn should not be provided. All inference requests will
                        be mapped to the specified inference profile, which can be
                        configured in the Bedrock console. This enables cross region
                        model invocation. See: https://docs.aws.amazon.com/bedrock/latest/userguide/cross-region-inference-use.html'
                    - pattern: ^[a-zA-Z0-9-:.]+$
                  - GuardrailIdentifier: !!omap
                    - type: string
                    - description: 'The unique identifier of the Bedrock guardrail
                        that you want to be applied to all LLM invocations. If you
                        don''t provide a value, no guardrail is applied to the invocation.
                        If provided, you must also provide a GuardrailVersion. See:
                        https://docs.aws.amazon.com/bedrock/latest/APIReference/API_runtime_InvokeModel.html#API_runtime_InvokeModel_RequestSyntax'
                    - pattern: ^(([a-z0-9]+)|(arn:aws(-[^:]+)?:bedrock:[a-z0-9-]{1,20}:[0-9]{12}:guardrail/[a-z0-9]+))$
                  - GuardrailVersion: !!omap
                    - type: string
                    - description: 'Version of the guardrail to be used. Must be provided
                        if GuardrailIdentifier is provided. See: https://docs.aws.amazon.com/bedrock/latest/APIReference/API_runtime_InvokeModel.html#API_runtime_InvokeModel_RequestSyntax'
                    - pattern: ^(([1-9][0-9]{0,7})|(DRAFT))$
                  - BedrockInferenceType: !!omap
                    - type: string
                    - description: The type of Bedrock inference to use. Required
                        for Bedrock LLM params.
                    - default: QUICK_START
                    - enum:
                      - QUICK_START
                      - OTHER_FOUNDATION
                      - INFERENCE_PROFILE
                      - PROVISIONED
                - required:
                  - BedrockInferenceType
                - allOf:
                  - !!omap
                    - oneOf:
                      - !!omap
                        - properties: !!omap
                          - BedrockInferenceType: !!omap
                            - enum:
                              - QUICK_START
                              - OTHER_FOUNDATION
                          - InferenceProfileId: !!omap
                            - not: !!omap []
                        - required:
                          - ModelId
                      - !!omap
                        - properties: !!omap
                          - BedrockInferenceType: !!omap
                            - enum:
                              - INFERENCE_PROFILE
                          - ModelId: !!omap
                            - not: !!omap []
                        - required:
                          - InferenceProfileId
                      - !!omap
                        - properties: !!omap
                          - BedrockInferenceType: !!omap
                            - enum:
                              - PROVISIONED
                        - required:
                          - ModelArn
                  - !!omap
                    - oneOf:
                      - !!omap
                        - required:
                          - GuardrailIdentifier
                          - GuardrailVersion
                      - !!omap
                        - properties: !!omap
                          - GuardrailIdentifier: !!omap
                            - not: !!omap []
                          - GuardrailVersion: !!omap
                            - not: !!omap []
                - additionalProperties: false
              - SageMakerLlmParams: !!omap
                - type: object
                - description: Parameters specific to use cases using a SageMaker
                    model as an LLM provider. Can only be provided when "ModelProvider"
                    is SageMaker
                - properties: !!omap
                  - EndpointName: !!omap
                    - type: string
                    - description: Endpoint for the deployed model to use from SageMaker
                    - pattern: ^[a-zA-Z0-9](-*[a-zA-Z0-9]){0,62}$
                  - ModelInputPayloadSchema: !!omap
                    - type: object
                    - description: An object defining the schema to be used to populate
                        model params for SageMaker endpoint models
                  - ModelOutputJSONPath: !!omap
                    - type: string
                    - description: JSON path where the response should be retrieved
                        from the model output payload. Applicable only to SageMaker
                        endpoints.
                    - pattern: ^\$[\w\.\,\[\]:\'\"\-\(\)\*\?\@]*$
                - required:
                  - EndpointName
                  - ModelInputPayloadSchema
                  - ModelOutputJSONPath
                - additionalProperties: false
              - ModelParams: !!omap
                - type: object
                - description: Additional model params to be passed to the model,
                    whose keys are as defined in the LLM documentation
                - additionalProperties: !!omap
                  - type: object
                  - properties: !!omap
                    - Value: !!omap
                      - type: string
                      - description: Value of the param
                    - Type: !!omap
                      - type: string
                      - enum:
                        - string
                        - integer
                        - float
                        - boolean
                        - list
                        - dictionary
                      - description: Python type of the param, as a string. Will be
                          cast to this type before being fed to LLM.
                  - required:
                    - Value
                    - Type
              - PromptParams: !!omap
                - type: object
                - description: Parameters related to the prompt(s) used by the use
                    case
                - properties: !!omap
                  - PromptTemplate: !!omap
                    - type: string
                    - description: Default prompt template which will be fed to the
                        LLM, barring any overrides by users
                  - UserPromptEditingEnabled: !!omap
                    - type: boolean
                    - description: Whether to allow the user of the use case to edit
                        their own prompt
                    - default: true
                  - MaxPromptTemplateLength: !!omap
                    - type: integer
                    - description: Maximum length (in characters) of the system prompt
                        template that a user can use in the use case
                    - minimum: 0
                  - MaxInputTextLength: !!omap
                    - type: integer
                    - description: Maximum length (in characters) of the input text
                        that can be sent to the LLM.
                    - minimum: 1
                  - RephraseQuestion: !!omap
                    - type: boolean
                    - description: Whether to use the disambiguated query instead
                        of the original user input in the final prompt. Only appluies
                        when using RAG.
                    - default: true
                  - DisambiguationPromptTemplate: !!omap
                    - type: string
                    - description: Prompt which will be internally used to disambiguate
                        new queries in combination with the chat history. Only applies
                        when using RAG.
                  - DisambiguationEnabled: !!omap
                    - type: boolean
                    - description: Whether to perform disambiguation for the use case.
                        Only applies when using RAG.
                    - default: true
                - additionalProperties: false
              - Temperature: !!omap
                - type: number
                - description: Temperature value which will be fed to the LLM. Scale
                    should be chosen based on the supported range of the model provider.
                - default: 0
                - minimum: 0
                - maximum: 100
              - Streaming: !!omap
                - type: boolean
                - description: Whether to stream the LLM responses back to the user
                    or not. Note some providers do not support streaming.
              - RAGEnabled: !!omap
                - type: boolean
                - description: If true, the use case will reference a knowledge base
                    when responding to the user. Otherwise provides chat with the
                    LLM directly.
                - default: true
              - Verbose: !!omap
                - type: boolean
                - description: Whether to print out debug messages to the console
                - default: false
            - oneOf:
              - !!omap
                - properties: !!omap
                  - ModelProvider: !!omap
                    - enum:
                      - Bedrock
                - required:
                  - BedrockLlmParams
              - !!omap
                - properties: !!omap
                  - ModelProvider: !!omap
                    - enum:
                      - SageMaker
                - required:
                  - SageMakerLlmParams
            - additionalProperties: false
          - AgentParams: !!omap
            - type: object
            - description: Parameters for Bedrock agent invocation workflow.
            - properties: !!omap
              - AgentType: !!omap
                - type: string
                - description: The type of agent to use. Required.
                - enum:
                  - Bedrock
              - BedrockAgentParams: !!omap
                - type: object
                - properties: !!omap
                  - AgentId: !!omap
                    - type: string
                    - description: ID of the Bedrock agent to be invoked.
                    - pattern: ^[0-9a-zA-Z]+$
                    - maxLength: 10
                  - AgentAliasId: !!omap
                    - type: string
                    - description: Alias ID of the Bedrock agent to be invoked.
                    - pattern: ^[0-9a-zA-Z]+$
                    - maxLength: 10
                  - EnableTrace: !!omap
                    - type: boolean
                    - description: Whether to enable tracing for the agent invocation.
                    - default: false
                - required:
                  - AgentId
                  - AgentAliasId
                  - EnableTrace
                - additionalProperties: false
            - required:
              - AgentType
            - additionalProperties: false
        - required:
          - UseCaseType
          - UseCaseName
        - oneOf:
          - !!omap
            - properties: !!omap
              - UseCaseType: !!omap
                - enum:
                  - Text
            - required:
              - LlmParams
            - oneOf:
              - !!omap
                - properties: !!omap
                  - LlmParams: !!omap
                    - properties: !!omap
                      - RAGEnabled: !!omap
                        - enum:
                          - false
                  - KnowledgeBaseParams: !!omap
                    - not: !!omap []
              - !!omap
                - properties: !!omap
                  - LlmParams: !!omap
                    - properties: !!omap
                      - RAGEnabled: !!omap
                        - enum:
                          - true
                - required:
                  - KnowledgeBaseParams
          - !!omap
            - properties: !!omap
              - UseCaseType: !!omap
                - enum:
                  - Agent
              - KnowledgeBaseParams: !!omap
                - not: !!omap []
              - LlmParams: !!omap
                - not: !!omap []
            - required:
              - AgentParams
        - additionalProperties: false
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeployUseCaseResponseModel053210C2: !!omap
    - Type: AWS::ApiGateway::Model
    - Properties: !!omap
      - ContentType: application/json
      - Description: Response model to describe response of deploying a use case
      - Name: DeployUseCaseResponseModel
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
      - Schema: !!omap
        - type: object
        - properties: !!omap
          - useCaseId: !!omap
            - type: string
            - description: ID of the use case that was created
        - $schema: http://json-schema.org/draft-04/schema#
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointUpdateUseCaseApiBodyModel556ECDCC: !!omap
    - Type: AWS::ApiGateway::Model
    - Properties: !!omap
      - ContentType: application/json
      - Description: Defines the required JSON structure of the PUT request to update
          a use case
      - Name: UpdateUseCaseApiBodyModel
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
      - Schema: !!omap
        - $schema: http://json-schema.org/draft-07/schema#
        - type: object
        - properties: !!omap
          - UseCaseType: !!omap
            - type: string
            - description: Type of the use case to be deployed. Either "Text" or "Agent".
            - enum:
              - Text
              - Agent
          - UseCaseDescription: !!omap
            - type: string
            - description: Description of the use case to be deployed. For display
                purposes
          - DefaultUserEmail: !!omap
            - type: string
            - description: Email address of the user who will be created with permissions
                to use the deployed use-case
            - format: email
          - DeployUI: !!omap
            - type: boolean
            - description: Deploy the CloudFront based UI for the use case
            - default: true
          - FeedbackParams: !!omap
            - type: object
            - description: Parameters for the feedback capability for the use case.
            - properties: !!omap
              - FeedbackEnabled: !!omap
                - type: boolean
                - description: Allow the feedback capability for the use case.
                - default: false
            - required:
              - FeedbackEnabled
            - additionalProperties: false
          - ExistingRestApiId: !!omap
            - type: string
            - description: Rest API ID which will be used to invoke UseCaseDetails
                (and Feedback, if enabled).
          - VpcParams: !!omap
            - type: object
            - description: Parameters for the use case VPC. Note on updates it is
                only possible to change private subnets and security groups. It is
                not possible to switch the VPC a use case is deployed in, or move
                an existing non-VPC use case into a VPC.
            - properties: !!omap
              - ExistingPrivateSubnetIds: !!omap
                - type: array
                - items: !!omap
                  - type: string
                  - pattern: ^subnet-\w{8}(\w{9})?$
                - maxItems: 16
                - uniqueItems: true
                - description: If VpcEnabled is true and CreateNewVpc is false, the
                    use case will be deployed using the specified subnets.
              - ExistingSecurityGroupIds: !!omap
                - type: array
                - items: !!omap
                  - type: string
                  - pattern: ^sg-\w{8}(\w{9})?$
                - maxItems: 5
                - uniqueItems: true
                - description: If VpcEnabled is true and CreateNewVpc is false, the
                    use case will be deployed using the specified security groups.
            - additionalProperties: false
          - ConversationMemoryParams: !!omap
            - type: object
            - description: Parameters related to storing and using the chat history
            - properties: !!omap
              - ConversationMemoryType: !!omap
                - type: string
                - default: DynamoDB
                - enum:
                  - DynamoDB
              - HumanPrefix: !!omap
                - type: string
                - description: Prefix used in the history when storing messages sent
                    by the user
              - AiPrefix: !!omap
                - type: string
                - description: Prefix used in the history when storing responses from
                    the LLM
              - ChatHistoryLength: !!omap
                - type: integer
                - description: Number of messages to store in the history
                - minimum: 0
            - additionalProperties: false
          - KnowledgeBaseParams: !!omap
            - type: object
            - description: Parameters related to the knowledge base. Based on KnowledgeBaseType,
                different nested parameters are required.
            - properties: !!omap
              - KnowledgeBaseType: !!omap
                - type: string
                - description: The type of knowledge base to use. Required.
                - default: Kendra
                - enum:
                  - Kendra
                  - Bedrock
              - NoDocsFoundResponse: !!omap
                - type: string
                - description: Response text message to use when the knowledge base
                    does not return any documents
                - minLength: 1
              - KendraKnowledgeBaseParams: !!omap
                - type: object
                - description: Parameters specific to Kendra. Note on update we can
                    only reference an existing Kendra index, creating a new one is
                    not supported currently.
                - properties: !!omap
                  - ExistingKendraIndexId: !!omap
                    - type: string
                    - description: Index ID of an existing Kendra index to be used
                        for the use case. Required if KendraIndexName is not provided.
                    - pattern: ^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$
                  - AttributeFilter: !!omap
                    - type: object
                    - description: 'Filter to apply when querying the Kendra index.
                        See: https://docs.aws.amazon.com/kendra/latest/APIReference/API_AttributeFilter.html'
                  - RoleBasedAccessControlEnabled: !!omap
                    - type: boolean
                    - description: Whether role-based access control is enabled on
                        the Kendra index, used to restrict Kendra queries to documents
                        accessible by user group and id.
                    - default: false
                - minProperties: 1
                - additionalProperties: false
              - BedrockKnowledgeBaseParams: !!omap
                - type: object
                - description: Parameters specific to Bedrock Knowledge Bases
                - properties: !!omap
                  - BedrockKnowledgeBaseId: !!omap
                    - type: string
                    - description: ID of the Bedrock knowledge base to use in a RAG
                        use case. Required if KnowledgeBaseType is Bedrock.
                    - pattern: ^[0-9a-zA-Z]{1,10}$
                  - RetrievalFilter: !!omap
                    - type: object
                    - description: 'Filter to apply when querying the Bedrock knowledge
                        base. See: https://docs.aws.amazon.com/bedrock/latest/APIReference/API_agent-runtime_RetrievalFilter.html'
                  - OverrideSearchType: !!omap
                    - type: string
                    - description: If you're using an Amazon OpenSearch Serverless
                        vector store that contains a filterable text field, you can
                        specify whether to query the knowledge base with a HYBRID
                        search using both vector embeddings and raw text, or SEMANTIC
                        search using only vector embeddings. By default (if this is
                        not provided), Amazon Bedrock will choose for you. For other
                        vector store types, passing this parameter will result in
                        a validation error during retrieval. For more information,
                        see https://docs.aws.amazon.com/bedrock/latest/userguide/kb-test-config.html
                    - enum:
                      - HYBRID
                      - SEMANTIC
                      - NONE
                    - default: NONE
                - additionalProperties: false
              - NumberOfDocs: !!omap
                - type: integer
                - description: The number of documents returned from the knowledge
                    base which will be used as context to be sent to the LLM
                - default: 2
                - minimum: 1
                - maximum: 100
              - ScoreThreshold: !!omap
                - type: number
                - description: The minimum score a document must have to be returned
                    from the knowledge base
                - default: 0
                - minimum: 0
                - maximum: 1
              - ReturnSourceDocs: !!omap
                - type: boolean
                - description: Whether to return information about the source of documents
                    returned from the knowledge base
                - default: false
            - oneOf:
              - !!omap
                - properties: !!omap
                  - KnowledgeBaseType: !!omap
                    - not: !!omap []
              - !!omap
                - properties: !!omap
                  - KnowledgeBaseType: !!omap
                    - enum:
                      - Kendra
                  - BedrockKnowledgeBaseParams: !!omap
                    - not: !!omap []
                - required:
                  - KendraKnowledgeBaseParams
                  - KnowledgeBaseType
              - !!omap
                - properties: !!omap
                  - KnowledgeBaseType: !!omap
                    - enum:
                      - Bedrock
                  - KendraKnowledgeBaseParams: !!omap
                    - not: !!omap []
                - required:
                  - BedrockKnowledgeBaseParams
                  - KnowledgeBaseType
            - additionalProperties: false
          - AuthenticationParams: !!omap
            - type: object
            - description: Parameters related to the Authentication.
            - properties: !!omap
              - AuthenticationProvider: !!omap
                - type: string
                - description: Supported authentication provider.
                - enum:
                  - Cognito
              - CognitoParams: !!omap
                - type: object
                - description: Cognito user pool related parameters.
                - properties: !!omap
                  - ExistingUserPoolId: !!omap
                    - type: string
                    - description: Existing Cognito User Pool Id.
                    - pattern: ^[\w-]+_[0-9a-zA-Z]+$
                    - minLength: 1
                    - maxLength: 55
                  - ExistingUserPoolClientId: !!omap
                    - type: string
                    - description: Existing Cognito User Pool Client Id.
                    - pattern: ^[\w+]+$
                    - minLength: 1
                    - maxLength: 128
                - required:
                  - ExistingUserPoolId
            - anyOf:
              - !!omap
                - properties: !!omap
                  - AuthenticationProvider: !!omap
                    - enum:
                      - Cognito
                - required:
                  - CognitoParams
            - required:
              - AuthenticationProvider
          - LlmParams: !!omap
            - type: object
            - properties: !!omap
              - ModelProvider: !!omap
                - type: string
                - description: Name of the LLM provider which the use case will use
                - enum:
                  - Bedrock
                  - SageMaker
              - BedrockLlmParams: !!omap
                - type: object
                - description: Parameters specific to use cases using Bedrock as an
                    LLM provider. Can only be provided when "ModelProvider" is Bedrock
                - properties: !!omap
                  - ModelId: !!omap
                    - type: string
                    - description: Depending on whether ModelArn is provided, this
                        will either be used to select the on-demand model to invoke
                        or be used to specify the base model that the selected provisioned/custom
                        model is based on.
                    - pattern: ^([a-z0-9-]{1,63}[.]{1}[a-z0-9-]{1,63}([.:]?[a-z0-9-]{1,63}))|(([0-9a-zA-Z][_-]?)+)$
                  - ModelArn: !!omap
                    - type: string
                    - description: 'ARN of the provisioned/custom model to use from
                        Amazon Bedrock. See: https://docs.aws.amazon.com/bedrock/latest/APIReference/API_runtime_InvokeModel.html#API_runtime_InvokeModel_RequestSyntax'
                    - pattern: ^(arn:aws(-[^:]+)?:bedrock:[a-z0-9-]{1,20}:(([0-9]{12}:custom-model/[a-z0-9-]{1,63}[.]{1}[a-z0-9-:]{1,63}/[a-z0-9]{12})|(:foundation-model/[a-z0-9-]{1,63}[.]{1}[a-z0-9-]{1,63}([.:]?[a-z0-9-]{1,63})([.:]?[a-z0-9-]{1,63}))|([0-9]{12}:provisioned-model/[a-z0-9]{12})))$
                  - InferenceProfileId: !!omap
                    - type: string
                    - description: 'The identifier of the Bedrock inference profile
                        to use when invoking the model. When provided, a ModelId and
                        ModelArn should not be provided. All inference requests will
                        be mapped to the specified inference profile, which can be
                        configured in the Bedrock console. This enables cross region
                        model invocation. See: https://docs.aws.amazon.com/bedrock/latest/userguide/cross-region-inference-use.html'
                    - pattern: ^[a-zA-Z0-9-:.]+$
                  - GuardrailIdentifier: !!omap
                    - type:
                      - string
                      - 'null'
                    - description: 'The unique identifier of the Bedrock guardrail
                        that you want to be applied to all LLM invocations. If you
                        don''t provide a value, no guardrail is applied to the invocation.
                        If provided, you must also provide a GuardrailVersion. To
                        remove a guardrail set this value to ''null''. See: https://docs.aws.amazon.com/bedrock/latest/APIReference/API_runtime_InvokeModel.html#API_runtime_InvokeModel_RequestSyntax.'
                    - pattern: ^(([a-z0-9]+)|(arn:aws(-[^:]+)?:bedrock:[a-z0-9-]{1,20}:[0-9]{12}:guardrail/[a-z0-9]+))$
                  - GuardrailVersion: !!omap
                    - type:
                      - string
                      - 'null'
                    - description: 'Version of the guardrail to be used. Must be provided
                        if GuardrailIdentifier is provided. See: https://docs.aws.amazon.com/bedrock/latest/APIReference/API_runtime_InvokeModel.html#API_runtime_InvokeModel_RequestSyntax'
                    - pattern: ^(([1-9][0-9]{0,7})|(DRAFT))$
                  - BedrockInferenceType: !!omap
                    - type: string
                    - description: The type of Bedrock inference to use. Required
                        for Bedrock LLM params.
                    - default: QUICK_START
                    - enum:
                      - QUICK_START
                      - OTHER_FOUNDATION
                      - INFERENCE_PROFILE
                      - PROVISIONED
                - required:
                  - BedrockInferenceType
                - oneOf:
                  - !!omap
                    - required:
                      - ModelId
                    - properties: !!omap
                      - BedrockInferenceType: !!omap
                        - enum:
                          - QUICK_START
                          - OTHER_FOUNDATION
                      - InferenceProfileId: !!omap
                        - not: !!omap []
                  - !!omap
                    - required:
                      - InferenceProfileId
                    - properties: !!omap
                      - BedrockInferenceType: !!omap
                        - enum:
                          - INFERENCE_PROFILE
                      - ModelId: !!omap
                        - not: !!omap []
                  - !!omap
                    - properties: !!omap
                      - BedrockInferenceType: !!omap
                        - enum:
                          - PROVISIONED
                    - required:
                      - ModelArn
                  - !!omap
                    - properties: !!omap
                      - ModelId: !!omap
                        - not: !!omap []
                      - InferenceProfileId: !!omap
                        - not: !!omap []
                      - ModelArn: !!omap
                        - not: !!omap []
                - additionalProperties: false
              - SageMakerLlmParams: !!omap
                - type: object
                - description: Parameters specific to use cases using a SageMaker
                    model as an LLM provider. Can only be provided when "ModelProvider"
                    is SageMaker
                - properties: !!omap
                  - EndpointName: !!omap
                    - type: string
                    - description: Endpoint for the deployed model to use from SageMaker
                    - pattern: ^[a-zA-Z0-9](-*[a-zA-Z0-9]){0,62}$
                  - ModelInputPayloadSchema: !!omap
                    - type: object
                    - description: An object defining the schema to be used to populate
                        model params for SageMaker endpoint models
                  - ModelOutputJSONPath: !!omap
                    - type: string
                    - description: JSON path where the response should be retrieved
                        from the model output payload. Applicable only to SageMaker
                        endpoints.
                    - pattern: ^\$[\w\.\,\[\]:\'\"\-\(\)\*\?\@]*$
                - additionalProperties: false
              - ModelParams: !!omap
                - type: object
                - description: Additional model params to be passed to the model,
                    whose keys are as defined in the LLM documentation
                - additionalProperties: !!omap
                  - type: object
                  - properties: !!omap
                    - Value: !!omap
                      - type: string
                      - description: Value of the param
                    - Type: !!omap
                      - type: string
                      - enum:
                        - string
                        - integer
                        - float
                        - boolean
                        - list
                        - dictionary
                      - description: Python type of the param, as a string. Will be
                          cast to this type before being fed to LLM.
                  - required:
                    - Value
                    - Type
              - PromptParams: !!omap
                - type: object
                - description: Parameters related to the prompt(s) used by the use
                    case
                - properties: !!omap
                  - PromptTemplate: !!omap
                    - type: string
                    - description: Default prompt template which will be fed to the
                        LLM, barring any overrides by users
                  - UserPromptEditingEnabled: !!omap
                    - type: boolean
                    - description: Whether to allow the user of the use case to edit
                        their own prompt
                  - MaxPromptTemplateLength: !!omap
                    - type: integer
                    - description: Maximum length (in characters) of the prompt template
                        that a user can use in the use case
                  - MaxInputTextLength: !!omap
                    - type: integer
                    - description: Maximum length (in characters) of the input text
                        that can be sent to the LLM.
                  - RephraseQuestion: !!omap
                    - type: boolean
                    - description: Whether to use the disambiguated query instead
                        of the original user input in the final prompt. Only appluies
                        when using RAG.
                    - default: true
                  - DisambiguationPromptTemplate: !!omap
                    - type: string
                    - description: Prompt which will be internally used to disambiguate
                        new queries in combination with the chat history. Only applies
                        when using RAG.
                  - DisambiguationEnabled: !!omap
                    - type: boolean
                    - description: Whether to disable disambiguation for the use case.
                        Only applies when using RAG.
                - additionalProperties: false
              - Temperature: !!omap
                - type: number
                - description: Temperature value which will be fed to the LLM. Scale
                    should be chosen based on the supported range of the model provider.
                - default: 0
                - minimum: 0
                - maximum: 100
              - Streaming: !!omap
                - type: boolean
                - description: Whether to stream the LLM responses back to the user
                    or not. Note some providers do not support streaming.
              - RAGEnabled: !!omap
                - type: boolean
                - description: If true, the use case will reference a knowledge base
                    when responding to the user. Otherwise provides chat with the
                    LLM directly.
              - Verbose: !!omap
                - type: boolean
                - description: Whether to print out debug messages to the console
            - anyOf:
              - !!omap
                - properties: !!omap
                  - ModelProvider: !!omap
                    - enum:
                      - Bedrock
                - required:
                  - BedrockLlmParams
              - !!omap
                - properties: !!omap
                  - ModelProvider: !!omap
                    - enum:
                      - SageMaker
                - required:
                  - SageMakerLlmParams
              - !!omap
                - properties: !!omap
                  - ModelProvider: !!omap
                    - not: !!omap []
            - additionalProperties: false
          - AgentParams: !!omap
            - type: object
            - description: Parameters for Bedrock agent invocation workflow.
            - properties: !!omap
              - AgentType: !!omap
                - type: string
                - description: The type of agent to use. Required.
                - enum:
                  - Bedrock
              - BedrockAgentParams: !!omap
                - type: object
                - properties: !!omap
                  - AgentId: !!omap
                    - type: string
                    - description: ID of the Bedrock agent to be invoked.
                    - pattern: ^[0-9a-zA-Z]+$
                    - maxLength: 10
                  - AgentAliasId: !!omap
                    - type: string
                    - description: Alias ID of the Bedrock agent to be invoked.
                    - pattern: ^[0-9a-zA-Z]+$
                    - maxLength: 10
                  - EnableTrace: !!omap
                    - type: boolean
                    - description: Whether to enable tracing for the agent invocation.
                    - default: false
                - required:
                  - AgentId
                  - AgentAliasId
                - additionalProperties: false
            - additionalProperties: false
        - anyOf:
          - !!omap
            - required:
              - UseCaseDescription
          - !!omap
            - required:
              - DefaultUserEmail
          - !!omap
            - required:
              - VpcParams
          - !!omap
            - required:
              - ConversationMemoryParams
          - !!omap
            - required:
              - KnowledgeBaseParams
          - !!omap
            - required:
              - LlmParams
          - !!omap
            - required:
              - AgentParams
          - !!omap
            - required:
              - AuthenticationParams
        - required:
          - UseCaseType
        - additionalProperties: false
  - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointUpdateUseCaseResponseModel43C6C5F9: !!omap
    - Type: AWS::ApiGateway::Model
    - Properties: !!omap
      - ContentType: application/json
      - Description: Response model to describe response of updating a use case
      - Name: UpdateUseCaseResponseModel
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
      - Schema: !!omap
        - type: object
        - properties: !!omap
          - useCaseId: !!omap
            - type: string
            - description: ID of the use case that was updated
        - $schema: http://json-schema.org/draft-04/schema#
  - UseCaseManagementSetupRequestProcessorCognitoAdminGroupPolicyTableWriterB481B347: !!omap
    - Type: Custom::CognitoAdminGroupPolicyTableWriter
    - Properties: !!omap
      - ServiceToken: !!omap
        - Fn::GetAtt:
          - DeploymentPlatformSetupInfraSetupCustomResource5473231F
          - Arn
      - Resource: ADMIN_POLICY
      - API_ARN: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':execute-api:'
            - !!omap
              - Ref: AWS::Region
            - ':'
            - !!omap
              - Ref: AWS::AccountId
            - ':'
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
            - /*/*/*
      - POLICY_TABLE_NAME: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
          - Outputs.DeploymentPlatformCognitoSetupCognitoGroupPolicyTableName0C5E8F79
    - DependsOn:
      - UseCaseManagementSetupRequestProcessorCognitoAdminGroupPolicyFA8C586D
      - UseCaseManagementSetupRequestProcessorDeploymentRestAuthorizerAPIGatewayInvoke7E420FA2
      - UseCaseManagementSetupRequestProcessorDeploymentRestAuthorizerDeploymentPlatformStackUseCaseManagementSetupRequestProcessorRestCustomRequestAuthorizer537B59D4Permissions3FBB7A58
      - UseCaseManagementSetupRequestProcessorDeploymentRestAuthorizer2B81EC22
    - UpdateReplacePolicy: Delete
    - DeletionPolicy: Delete
  - UseCaseManagementSetupRequestProcessorCognitoAdminGroupPolicyFA8C586D: !!omap
    - Type: AWS::IAM::Policy
    - Properties: !!omap
      - PolicyDocument: !!omap
        - Statement:
          - !!omap
            - Action:
              - dynamodb:DeleteItem
              - dynamodb:GetItem
              - dynamodb:PutItem
            - Effect: Allow
            - Resource: !!omap
              - Fn::Join:
                - ''
                - - 'arn:aws:dynamodb:'
                  - !!omap
                    - Ref: AWS::Region
                  - ':'
                  - !!omap
                    - Ref: AWS::AccountId
                  - :table/
                  - !!omap
                    - Fn::GetAtt:
                      - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
                      - Outputs.DeploymentPlatformCognitoSetupCognitoGroupPolicyTableName0C5E8F79
        - Version: '2012-10-17'
      - PolicyName: UseCaseManagementSetupRequestProcessorCognitoAdminGroupPolicyFA8C586D
      - Roles:
        - !!omap
          - Fn::Select:
            - 1
            - !!omap
              - Fn::Split:
                - /
                - !!omap
                  - Fn::Select:
                    - 5
                    - !!omap
                      - Fn::Split:
                        - ':'
                        - !!omap
                          - Fn::GetAtt:
                            - DeploymentPlatformSetupCustomResourceLambdaRole3C444A9D
                            - Arn
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseDlq4B523B54: !!omap
    - Type: AWS::SQS::Queue
    - Properties: !!omap
      - KmsMasterKeyId: alias/aws/sqs
    - UpdateReplacePolicy: Delete
    - DeletionPolicy: Delete
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseDlqPolicy4A6E7CAA: !!omap
    - Type: AWS::SQS::QueuePolicy
    - Properties: !!omap
      - PolicyDocument: !!omap
        - Statement:
          - !!omap
            - Action: sqs:*
            - Condition: !!omap
              - Bool: !!omap
                - aws:SecureTransport: 'false'
            - Effect: Deny
            - Principal: !!omap
              - AWS: '*'
            - Resource: !!omap
              - Fn::GetAtt:
                - UseCaseManagementSetupUseCaseEndpointSetupUseCaseDlq4B523B54
                - Arn
        - Version: '2012-10-17'
      - Queues:
        - !!omap
          - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseDlq4B523B54
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseDetailsRole5FD36A48: !!omap
    - Type: AWS::IAM::Role
    - Properties: !!omap
      - AssumeRolePolicyDocument: !!omap
        - Statement:
          - !!omap
            - Action: sts:AssumeRole
            - Effect: Allow
            - Principal: !!omap
              - Service: lambda.amazonaws.com
        - Version: '2012-10-17'
      - Policies:
        - !!omap
          - PolicyDocument: !!omap
            - Statement:
              - !!omap
                - Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                - Effect: Allow
                - Resource: !!omap
                  - Fn::Join:
                    - ''
                    - - 'arn:'
                      - !!omap
                        - Ref: AWS::Partition
                      - ':logs:'
                      - !!omap
                        - Ref: AWS::Region
                      - ':'
                      - !!omap
                        - Ref: AWS::AccountId
                      - :log-group:/aws/lambda/*
              - !!omap
                - Action: logs:PutLogEvents
                - Effect: Allow
                - Resource: !!omap
                  - Fn::Join:
                    - ''
                    - - 'arn:'
                      - !!omap
                        - Ref: AWS::Partition
                      - ':logs:'
                      - !!omap
                        - Ref: AWS::Region
                      - ':'
                      - !!omap
                        - Ref: AWS::AccountId
                      - :log-group:/aws/lambda/*:log-stream:*
            - Version: '2012-10-17'
          - PolicyName: LambdaFunctionServiceRolePolicy
        - !!omap
          - PolicyDocument: !!omap
            - Statement:
              - !!omap
                - Action:
                  - ec2:*ssignPrivateIpAddresses
                  - ec2:CreateNetworkInterface
                - Effect: Allow
                - Resource:
                  - !!omap
                    - Fn::Join:
                      - ''
                      - - 'arn:'
                        - !!omap
                          - Ref: AWS::Partition
                        - ':ec2:'
                        - !!omap
                          - Ref: AWS::Region
                        - ':'
                        - !!omap
                          - Ref: AWS::AccountId
                        - :network-interface/*
                  - !!omap
                    - Fn::Join:
                      - ''
                      - - 'arn:'
                        - !!omap
                          - Ref: AWS::Partition
                        - ':ec2:'
                        - !!omap
                          - Ref: AWS::Region
                        - ':'
                        - !!omap
                          - Ref: AWS::AccountId
                        - :security-group/*
                  - !!omap
                    - Fn::Join:
                      - ''
                      - - 'arn:'
                        - !!omap
                          - Ref: AWS::Partition
                        - ':ec2:'
                        - !!omap
                          - Ref: AWS::Region
                        - ':'
                        - !!omap
                          - Ref: AWS::AccountId
                        - :subnet/*
              - !!omap
                - Action:
                  - ec2:De*NetworkInterface
                  - ec2:DescribeNetworkInterfaces
                - Effect: Allow
                - Resource: '*'
            - Version: '2012-10-17'
          - PolicyName: VPCPolicy
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: Lambda functions has the required permission to write CloudWatch
                Logs. It uses custom policy instead of arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
                with tighter permissions.
            - id: AwsSolutions-IAM5
            - applies_to:
              - Resource::arn:<AWS::Partition>:logs:<AWS::Region>:<AWS::AccountId>:log-group:/aws/lambda/*
          - !!omap
            - reason: Lambda function has the required permission to write CloudWatch
                Log streams. It uses custom policy instead of arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
                with tighter permissions.
            - id: AwsSolutions-IAM5
            - applies_to:
              - Resource::arn:<AWS::Partition>:logs:<AWS::Region>:<AWS::AccountId>:log-group:/aws/lambda/*:log-stream:*
          - !!omap
            - reason: Even though the resource is "*", the actions have been scoped
                down only to the ones required by the solution
            - id: AwsSolutions-IAM5
            - applies_to:
              - Action::ec2:*ssignPrivateIpAddresses
              - Action::ec2:De*NetworkInterface
          - !!omap
            - reason: Networking resources are not known and hence "*". Also there
                are additional conditions to scope it down
            - id: AwsSolutions-IAM5
            - applies_to:
              - Resource::arn:<AWS::Partition>:ec2:<AWS::Region>:<AWS::AccountId>:*
              - Resource::arn:<AWS::Partition>:ec2:<AWS::Region>:<AWS::AccountId>:network-interface/*
              - Resource::arn:<AWS::Partition>:ec2:<AWS::Region>:<AWS::AccountId>:subnet/*
              - Resource::arn:<AWS::Partition>:ec2:<AWS::Region>:<AWS::AccountId>:security-group/*
              - Resource::arn:<AWS::Partition>:ec2:<AWS::Region>:<AWS::AccountId>:instance*
              - Resource::*
          - !!omap
            - reason: Permission generated by the ApiGatewayToLambda construct to
                allow CloudWatch Logs to be used
            - id: AwsSolutions-IAM5
            - applies_to:
              - Resource::arn:<AWS::Partition>:logs:<AWS::Region>:<AWS::AccountId>:*
      - cfn_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - id: W11
            - reason: The exact resource arn is unknown at this time. Hence wildcard.
                The arns are have been restricted to the account and region where
                possible, except for "ec2:Describe" calls which require the arn to
                be a wildcard
          - !!omap
            - id: W12
            - reason: The exact resource arn is unknown at this time. Hence wildcard.
                The arns are have been restricted to the account and region where
                possible, except for "ec2:Describe" calls which require the arn to
                be a wildcard
          - !!omap
            - id: W13
            - reason: The exact resource arn is unknown at this time. Hence wildcard.
                The arns are have been restricted to the account and region where
                possible, except for "ec2:Describe" calls which require the arn to
                be a wildcard
          - !!omap
            - id: F10
            - reason: The inline policy avoids a rare race condition between the lambda,
                Role and the policy resource creation.
    - Condition: UseCaseManagementSetupUseCaseEndpointSetupCreateApiRoutesCondition0060F23A
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseDetailsRoleDefaultPolicy872BE672: !!omap
    - Type: AWS::IAM::Policy
    - Properties: !!omap
      - PolicyDocument: !!omap
        - Statement:
          - !!omap
            - Action: sqs:SendMessage
            - Effect: Allow
            - Resource: !!omap
              - Fn::GetAtt:
                - UseCaseManagementSetupUseCaseEndpointSetupUseCaseDlq4B523B54
                - Arn
          - !!omap
            - Action:
              - xray:PutTelemetryRecords
              - xray:PutTraceSegments
            - Effect: Allow
            - Resource: '*'
          - !!omap
            - Action:
              - dynamodb:BatchGetItem
              - dynamodb:ConditionCheckItem
              - dynamodb:DescribeTable
              - dynamodb:GetItem
              - dynamodb:GetRecords
              - dynamodb:GetShardIterator
              - dynamodb:Query
              - dynamodb:Scan
            - Effect: Allow
            - Resource:
              - !!omap
                - Fn::Join:
                  - ''
                  - - 'arn:'
                    - !!omap
                      - Ref: AWS::Partition
                    - ':dynamodb:'
                    - !!omap
                      - Ref: AWS::Region
                    - ':'
                    - !!omap
                      - Ref: AWS::AccountId
                    - :table/
                    - !!omap
                      - Fn::GetAtt:
                        - DeploymentPlatformStorageDeploymentPlatformStorageNestedStackDeploymentPlatformStorageNestedStackResourceF56260D3
                        - Outputs.DeploymentPlatformStackDeploymentPlatformStorageLLMConfigTable9EB214F1Ref
              - !!omap
                - Ref: AWS::NoValue
        - Version: '2012-10-17'
      - PolicyName: UseCaseManagementSetupUseCaseEndpointSetupUseCaseDetailsRoleDefaultPolicy872BE672
      - Roles:
        - !!omap
          - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseDetailsRole5FD36A48
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: The IAM role requires access to multiple resources with dynamic
                names. The permissions are scoped to specific use case resources.
            - id: AwsSolutions-IAM5
    - Condition: UseCaseManagementSetupUseCaseEndpointSetupCreateApiRoutesCondition0060F23A
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseDetailsLambdaB2D6F726: !!omap
    - Type: AWS::Lambda::Function
    - Properties: !!omap
      - Code: !!omap
        - S3Bucket: !!omap
          - Fn::Sub: solutions-${AWS::Region}
        - S3Key: generative-ai-application-builder-on-aws/v3.0.0/assetcba8978e0a3e172c983f60cd51bd54e2206b1bf80a8beab2da7e9c425b5f5dfb.zip
      - DeadLetterConfig: !!omap
        - TargetArn: !!omap
          - Fn::GetAtt:
            - UseCaseManagementSetupUseCaseEndpointSetupUseCaseDlq4B523B54
            - Arn
      - Description: Lambda function for use case details
      - Environment: !!omap
        - Variables: !!omap
          - LLM_CONFIG_TABLE: !!omap
            - Fn::GetAtt:
              - DeploymentPlatformStorageDeploymentPlatformStorageNestedStackDeploymentPlatformStorageNestedStackResourceF56260D3
              - Outputs.DeploymentPlatformStackDeploymentPlatformStorageLLMConfigTable9EB214F1Ref
          - AWS_SDK_USER_AGENT: '{ "customUserAgent": [["AWSSOLUTION/SO0276/v3.0.0"]]
              }'
          - AWS_NODEJS_CONNECTION_REUSE_ENABLED: '1'
      - Handler: index.handler
      - Layers:
        - !!omap
          - Ref: AwsNodeSdkLayer42C7A59C
        - !!omap
          - Ref: NodeUserAgentLayer02526341
      - Role: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseEndpointSetupUseCaseDetailsRole5FD36A48
          - Arn
      - Runtime: nodejs22.x
      - Timeout: 900
      - TracingConfig: !!omap
        - Mode: Active
      - VpcConfig: !!omap
        - Fn::If:
          - UseCaseManagementSetupUseCaseEndpointSetupDeployVPCIfLambdaExistsFE27E265
          - !!omap
            - SubnetIds: !!omap
              - Fn::Split:
                - ','
                - !!omap
                  - Fn::If:
                    - DeployVPCCondition
                    - !!omap
                      - Fn::GetAtt:
                        - VPCDeploymentPlatformVPCNestedStackDeploymentPlatformVPCNestedStackResource186D2208
                        - Outputs.PrivateSubnetIds
                    - !!omap
                      - Fn::Join:
                        - ','
                        - !!omap
                          - Ref: ExistingPrivateSubnetIds
            - SecurityGroupIds: !!omap
              - Fn::Split:
                - ','
                - !!omap
                  - Fn::If:
                    - DeployVPCCondition
                    - !!omap
                      - Fn::GetAtt:
                        - VPCDeploymentPlatformVPCNestedStackDeploymentPlatformVPCNestedStackResource186D2208
                        - Outputs.SecurityGroupIds
                    - !!omap
                      - Fn::Join:
                        - ','
                        - !!omap
                          - Ref: ExistingSecurityGroupIds
          - !!omap
            - Ref: AWS::NoValue
    - DependsOn:
      - UseCaseManagementSetupUseCaseEndpointSetupUseCaseDetailsRoleDefaultPolicy872BE672
      - UseCaseManagementSetupUseCaseEndpointSetupUseCaseDetailsRole5FD36A48
    - Metadata: !!omap
      - aws:asset:path: asset.cba8978e0a3e172c983f60cd51bd54e2206b1bf80a8beab2da7e9c425b5f5dfb
      - aws:asset:is-bundled: true
      - aws:asset:property: Code
      - cfn_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - id: W89
            - reason: VPC deployment is not enforced. If the solution is deployed
                in a VPC, this lambda function will be deployed with VPC enabled configuration
          - !!omap
            - id: W92
            - reason: The solution does not enforce reserved concurrency
    - Condition: UseCaseManagementSetupUseCaseEndpointSetupCreateApiRoutesCondition0060F23A
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseDetailsLogRetention79CC6C50: !!omap
    - Type: Custom::CW_LOG_RETENTION
    - Properties: !!omap
      - ServiceToken: !!omap
        - Fn::GetAtt:
          - DeploymentPlatformSetupInfraSetupCustomResource5473231F
          - Arn
      - FunctionName: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseEndpointSetupUseCaseDetailsLambdaB2D6F726
          - Arn
      - Resource: CW_LOG_RETENTION
    - UpdateReplacePolicy: Delete
    - DeletionPolicy: Delete
    - Condition: UseCaseManagementSetupUseCaseEndpointSetupCreateApiRoutesCondition0060F23A
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseRestAuthorizerRoleB2D1238D: !!omap
    - Type: AWS::IAM::Role
    - Properties: !!omap
      - AssumeRolePolicyDocument: !!omap
        - Statement:
          - !!omap
            - Action: sts:AssumeRole
            - Effect: Allow
            - Principal: !!omap
              - Service: lambda.amazonaws.com
        - Version: '2012-10-17'
      - Policies:
        - !!omap
          - PolicyDocument: !!omap
            - Statement:
              - !!omap
                - Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                - Effect: Allow
                - Resource: !!omap
                  - Fn::Join:
                    - ''
                    - - 'arn:'
                      - !!omap
                        - Ref: AWS::Partition
                      - ':logs:'
                      - !!omap
                        - Ref: AWS::Region
                      - ':'
                      - !!omap
                        - Ref: AWS::AccountId
                      - :log-group:/aws/lambda/*
              - !!omap
                - Action: logs:PutLogEvents
                - Effect: Allow
                - Resource: !!omap
                  - Fn::Join:
                    - ''
                    - - 'arn:'
                      - !!omap
                        - Ref: AWS::Partition
                      - ':logs:'
                      - !!omap
                        - Ref: AWS::Region
                      - ':'
                      - !!omap
                        - Ref: AWS::AccountId
                      - :log-group:/aws/lambda/*:log-stream:*
            - Version: '2012-10-17'
          - PolicyName: LambdaFunctionServiceRolePolicy
        - !!omap
          - PolicyDocument: !!omap
            - Statement:
              - !!omap
                - Action:
                  - ec2:*ssignPrivateIpAddresses
                  - ec2:CreateNetworkInterface
                - Effect: Allow
                - Resource:
                  - !!omap
                    - Fn::Join:
                      - ''
                      - - 'arn:'
                        - !!omap
                          - Ref: AWS::Partition
                        - ':ec2:'
                        - !!omap
                          - Ref: AWS::Region
                        - ':'
                        - !!omap
                          - Ref: AWS::AccountId
                        - :network-interface/*
                  - !!omap
                    - Fn::Join:
                      - ''
                      - - 'arn:'
                        - !!omap
                          - Ref: AWS::Partition
                        - ':ec2:'
                        - !!omap
                          - Ref: AWS::Region
                        - ':'
                        - !!omap
                          - Ref: AWS::AccountId
                        - :security-group/*
                  - !!omap
                    - Fn::Join:
                      - ''
                      - - 'arn:'
                        - !!omap
                          - Ref: AWS::Partition
                        - ':ec2:'
                        - !!omap
                          - Ref: AWS::Region
                        - ':'
                        - !!omap
                          - Ref: AWS::AccountId
                        - :subnet/*
              - !!omap
                - Action:
                  - ec2:De*NetworkInterface
                  - ec2:DescribeNetworkInterfaces
                - Effect: Allow
                - Resource: '*'
            - Version: '2012-10-17'
          - PolicyName: VPCPolicy
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: Lambda functions has the required permission to write CloudWatch
                Logs. It uses custom policy instead of arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
                with tighter permissions.
            - id: AwsSolutions-IAM5
            - applies_to:
              - Resource::arn:<AWS::Partition>:logs:<AWS::Region>:<AWS::AccountId>:log-group:/aws/lambda/*
          - !!omap
            - reason: Lambda function has the required permission to write CloudWatch
                Log streams. It uses custom policy instead of arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
                with tighter permissions.
            - id: AwsSolutions-IAM5
            - applies_to:
              - Resource::arn:<AWS::Partition>:logs:<AWS::Region>:<AWS::AccountId>:log-group:/aws/lambda/*:log-stream:*
          - !!omap
            - reason: Even though the resource is "*", the actions have been scoped
                down only to the ones required by the solution
            - id: AwsSolutions-IAM5
            - applies_to:
              - Action::ec2:*ssignPrivateIpAddresses
              - Action::ec2:De*NetworkInterface
          - !!omap
            - reason: Networking resources are not known and hence "*". Also there
                are additional conditions to scope it down
            - id: AwsSolutions-IAM5
            - applies_to:
              - Resource::arn:<AWS::Partition>:ec2:<AWS::Region>:<AWS::AccountId>:*
              - Resource::arn:<AWS::Partition>:ec2:<AWS::Region>:<AWS::AccountId>:network-interface/*
              - Resource::arn:<AWS::Partition>:ec2:<AWS::Region>:<AWS::AccountId>:subnet/*
              - Resource::arn:<AWS::Partition>:ec2:<AWS::Region>:<AWS::AccountId>:security-group/*
              - Resource::arn:<AWS::Partition>:ec2:<AWS::Region>:<AWS::AccountId>:instance*
              - Resource::*
          - !!omap
            - reason: Lambda authorizer needs to describe any user pool to validate
                tokens from multiple user pools. Additional scoping down is found
                in the authorizer
            - id: AwsSolutions-IAM5
      - cfn_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - id: W11
            - reason: The exact resource arn is unknown at this time. Hence wildcard.
                The arns are have been restricted to the account and region where
                possible, except for "ec2:Describe" calls which require the arn to
                be a wildcard
          - !!omap
            - id: W12
            - reason: The exact resource arn is unknown at this time. Hence wildcard.
                The arns are have been restricted to the account and region where
                possible, except for "ec2:Describe" calls which require the arn to
                be a wildcard
          - !!omap
            - id: W13
            - reason: The exact resource arn is unknown at this time. Hence wildcard.
                The arns are have been restricted to the account and region where
                possible, except for "ec2:Describe" calls which require the arn to
                be a wildcard
          - !!omap
            - id: F10
            - reason: The inline policy avoids a rare race condition between the lambda,
                Role and the policy resource creation.
    - Condition: UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseRestAuthorizerRoleDefaultPolicy3FCFD071: !!omap
    - Type: AWS::IAM::Policy
    - Properties: !!omap
      - PolicyDocument: !!omap
        - Statement:
          - !!omap
            - Action: cognito-idp:DescribeUserPoolClient
            - Effect: Allow
            - Resource: !!omap
              - Fn::Join:
                - ''
                - - 'arn:aws:cognito-idp:'
                  - !!omap
                    - Ref: AWS::Region
                  - ':'
                  - !!omap
                    - Ref: AWS::AccountId
                  - :userpool/*
        - Version: '2012-10-17'
      - PolicyName: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseRestAuthorizerRoleDefaultPolicy3FCFD071
      - Roles:
        - !!omap
          - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseRestAuthorizerRoleB2D1238D
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: Lambda authorizer needs to describe any user pool to validate
                tokens from multiple user pools. Additional scoping down is found
                in the authorizer
            - id: AwsSolutions-IAM5
    - Condition: UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointLambdaPolicyTablePolicyB5251E29: !!omap
    - Type: AWS::IAM::Policy
    - Properties: !!omap
      - PolicyDocument: !!omap
        - Statement:
          - !!omap
            - Action:
              - dynamodb:BatchGetItem
              - dynamodb:GetItem
              - dynamodb:Query
            - Effect: Allow
            - Resource: !!omap
              - Fn::Join:
                - ''
                - - 'arn:aws:dynamodb:'
                  - !!omap
                    - Ref: AWS::Region
                  - ':'
                  - !!omap
                    - Ref: AWS::AccountId
                  - :table/
        - Version: '2012-10-17'
      - PolicyName: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointLambdaPolicyTablePolicyB5251E29
      - Roles:
        - !!omap
          - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseRestAuthorizerRoleB2D1238D
    - Condition: UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseEndpointAuthorizerLambda67002B14: !!omap
    - Type: AWS::Lambda::Function
    - Properties: !!omap
      - Code: !!omap
        - S3Bucket: !!omap
          - Fn::Sub: solutions-${AWS::Region}
        - S3Key: generative-ai-application-builder-on-aws/v3.0.0/asset51c67e91bc5ff0cbff3158910b74182af37b735b62f380d7c2f49b6a1a72a766.zip
      - Description: Authorizes REST API requests based on Cognito user pool groups
      - Environment: !!omap
        - Variables: !!omap
          - USER_POOL_ID: ''
          - CLIENT_ID: ''
          - COGNITO_POLICY_TABLE_NAME: ''
          - AWS_SDK_USER_AGENT: '{ "customUserAgent": [["AWSSOLUTION/SO0276/v3.0.0"]]
              }'
          - AWS_NODEJS_CONNECTION_REUSE_ENABLED: '1'
      - Handler: rest-authorizer.handler
      - Layers:
        - !!omap
          - Ref: AwsNodeSdkLayer42C7A59C
        - !!omap
          - Ref: NodeUserAgentLayer02526341
      - Role: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseRestAuthorizerRoleB2D1238D
          - Arn
      - Runtime: nodejs22.x
      - Timeout: 900
      - VpcConfig: !!omap
        - Fn::If:
          - DeployVPCCondition
          - !!omap
            - SubnetIds: !!omap
              - Fn::Split:
                - ','
                - !!omap
                  - Fn::If:
                    - DeployVPCCondition
                    - !!omap
                      - Fn::GetAtt:
                        - VPCDeploymentPlatformVPCNestedStackDeploymentPlatformVPCNestedStackResource186D2208
                        - Outputs.PrivateSubnetIds
                    - !!omap
                      - Fn::Join:
                        - ','
                        - !!omap
                          - Ref: ExistingPrivateSubnetIds
            - SecurityGroupIds: !!omap
              - Fn::Split:
                - ','
                - !!omap
                  - Fn::If:
                    - DeployVPCCondition
                    - !!omap
                      - Fn::GetAtt:
                        - VPCDeploymentPlatformVPCNestedStackDeploymentPlatformVPCNestedStackResource186D2208
                        - Outputs.SecurityGroupIds
                    - !!omap
                      - Fn::Join:
                        - ','
                        - !!omap
                          - Ref: ExistingSecurityGroupIds
          - !!omap
            - Ref: AWS::NoValue
    - DependsOn:
      - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseRestAuthorizerRoleDefaultPolicy3FCFD071
      - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseRestAuthorizerRoleB2D1238D
    - Metadata: !!omap
      - aws:asset:path: asset.51c67e91bc5ff0cbff3158910b74182af37b735b62f380d7c2f49b6a1a72a766
      - aws:asset:is-bundled: true
      - aws:asset:property: Code
      - cfn_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - id: W89
            - reason: VPC deployment is not enforced. This REST authorizer is not
                configured within a VPC
          - !!omap
            - id: W92
            - reason: The solution does not enforce reserved concurrency
    - Condition: UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
  - ? UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseEndpointAuthorizerLambdaDeploymentPlatformStackUseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseEndpointAuthorizer40331405Permissions0CF8AA64
    : !!omap
    - Type: AWS::Lambda::Permission
    - Properties: !!omap
      - Action: lambda:InvokeFunction
      - FunctionName: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseEndpointAuthorizerLambda67002B14
          - Arn
      - Principal: apigateway.amazonaws.com
      - SourceArn: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':execute-api:'
            - !!omap
              - Ref: AWS::Region
            - ':'
            - !!omap
              - Ref: AWS::AccountId
            - ':'
            - !!omap
              - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApi9C23F7C7
            - /authorizers/
            - !!omap
              - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseEndpointAuthorizer0B1A9B7A
    - Condition: UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseEndpointAuthorizerLambdaAPIGatewayInvokeCA3CC2A3: !!omap
    - Type: AWS::Lambda::Permission
    - Properties: !!omap
      - Action: lambda:InvokeFunction
      - FunctionName: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseEndpointAuthorizerLambda67002B14
          - Arn
      - Principal: apigateway.amazonaws.com
      - SourceArn: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':execute-api:'
            - !!omap
              - Ref: AWS::Region
            - ':'
            - !!omap
              - Ref: AWS::AccountId
            - ':'
            - !!omap
              - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApi9C23F7C7
            - /*
    - Condition: UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseEndpointAuthorizerLogRetention393EC774: !!omap
    - Type: Custom::CW_LOG_RETENTION
    - Properties: !!omap
      - ServiceToken: !!omap
        - Fn::GetAtt:
          - DeploymentPlatformSetupInfraSetupCustomResource5473231F
          - Arn
      - FunctionName: !!omap
        - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseEndpointAuthorizerLambda67002B14
      - Resource: CW_LOG_RETENTION
    - UpdateReplacePolicy: Delete
    - DeletionPolicy: Delete
    - Condition: UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseEndpointAuthorizer0B1A9B7A: !!omap
    - Type: AWS::ApiGateway::Authorizer
    - Properties: !!omap
      - AuthorizerResultTtlInSeconds: 0
      - AuthorizerUri: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Fn::Select:
                - 1
                - !!omap
                  - Fn::Split:
                    - ':'
                    - !!omap
                      - Fn::GetAtt:
                        - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseEndpointAuthorizerLambda67002B14
                        - Arn
            - ':apigateway:'
            - !!omap
              - Fn::Select:
                - 3
                - !!omap
                  - Fn::Split:
                    - ':'
                    - !!omap
                      - Fn::GetAtt:
                        - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseEndpointAuthorizerLambda67002B14
                        - Arn
            - :lambda:path/2015-03-31/functions/
            - !!omap
              - Fn::GetAtt:
                - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseEndpointAuthorizerLambda67002B14
                - Arn
            - /invocations
      - IdentitySource: method.request.header.Authorization
      - Name: DeploymentPlatformStackUseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseEndpointAuthorizer40331405
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApi9C23F7C7
      - Type: REQUEST
    - Condition: UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointApiAccessLogGroup58F53936: !!omap
    - Type: AWS::Logs::LogGroup
    - Properties: !!omap
      - RetentionInDays: 3653
    - UpdateReplacePolicy: Retain
    - DeletionPolicy: Retain
    - Metadata: !!omap
      - cfn_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - id: W84
            - reason: By default CloudWatchLogs LogGroups data is encrypted using
                the CloudWatch server-side encryption keys (AWS Managed Keys)
    - Condition: UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApi9C23F7C7: !!omap
    - Type: AWS::ApiGateway::RestApi
    - Properties: !!omap
      - Description: API endpoint to access use case related resources
      - EndpointConfiguration: !!omap
        - Types:
          - EDGE
      - Name: !!omap
        - Fn::Join:
          - ''
          - - !!omap
              - Ref: AWS::StackName
            - -UseCasesAPI
    - Condition: UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
  - ? UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApiDeployment46B8C9B6114c3ff5f7acb3e06b654608a11dfc54
    : !!omap
    - Type: AWS::ApiGateway::Deployment
    - Properties: !!omap
      - Description: API endpoint to access use case related resources
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApi9C23F7C7
    - DependsOn:
      - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointBadRequestBodyResponse0F38C01A
      - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointBadRequestDefaultResponse63BE5DCD
      - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointBadRequestParametersResponse73682B10
      - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApiGET54EC4772
      - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointInternalServerErrorDefaultResponseFE8D9460
      - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseEndpointAuthorizer0B1A9B7A
      - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseRequestValidator2EA7C91E
    - Metadata: !!omap
      - cfn_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - id: W45
            - reason: ApiGateway has AccessLogging enabled in AWS::ApiGateway::Stage
                resource, but cfn_nag checks for it in AWS::ApiGateway::Deployment
                resource
    - Condition: UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApiDeploymentStageprodDFECD10F: !!omap
    - Type: AWS::ApiGateway::Stage
    - Properties: !!omap
      - AccessLogSetting: !!omap
        - DestinationArn: !!omap
          - Fn::GetAtt:
            - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointApiAccessLogGroup58F53936
            - Arn
        - Format: $context.identity.sourceIp $context.identity.caller $context.identity.user
            [$context.requestTime] "$context.httpMethod $context.resourcePath $context.protocol"
            $context.status $context.responseLength $context.requestId
      - DeploymentId: !!omap
        - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApiDeployment46B8C9B6114c3ff5f7acb3e06b654608a11dfc54
      - MethodSettings:
        - !!omap
          - DataTraceEnabled: false
          - HttpMethod: '*'
          - LoggingLevel: OFF
          - MetricsEnabled: true
          - ResourcePath: /*
          - ThrottlingBurstLimit: 5
          - ThrottlingRateLimit: 5
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApi9C23F7C7
      - StageName: prod
      - TracingEnabled: true
    - Metadata: !!omap
      - guard: !!omap
        - SuppressedRules:
          - API_GW_CACHE_ENABLED_AND_ENCRYPTED
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: Turning off execution logs as recommended best practice in the
                ApiGateway service documentation
            - id: AwsSolutions-APIG6
    - Condition: UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApiGET54EC4772: !!omap
    - Type: AWS::ApiGateway::Method
    - Properties: !!omap
      - AuthorizationType: CUSTOM
      - AuthorizerId: !!omap
        - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseEndpointAuthorizer0B1A9B7A
      - HttpMethod: GET
      - Integration: !!omap
        - IntegrationResponses:
          - !!omap
            - ResponseParameters: !!omap
              - method.response.header.Content-Type: '''application/json'''
              - method.response.header.Access-Control-Allow-Origin: '''*'''
            - StatusCode: '400'
        - PassthroughBehavior: NEVER
        - Type: MOCK
      - MethodResponses:
        - !!omap
          - ResponseParameters: !!omap
            - method.response.header.Content-Type: true
            - method.response.header.Access-Control-Allow-Origin: true
          - StatusCode: '400'
      - OperationName: UseCaseMockMethod
      - RequestParameters: !!omap
        - method.request.header.authorization: true
      - RequestValidatorId: !!omap
        - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseRequestValidator2EA7C91E
      - ResourceId: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApi9C23F7C7
          - RootResourceId
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApi9C23F7C7
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: A Custom authorizer must be used in order to authenticate using
                Cognito user groups
            - id: AwsSolutions-COG4
    - Condition: UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApiUsagePlan0C45CF7E: !!omap
    - Type: AWS::ApiGateway::UsagePlan
    - Properties: !!omap
      - ApiStages:
        - !!omap
          - ApiId: !!omap
            - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApi9C23F7C7
          - Stage: !!omap
            - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApiDeploymentStageprodDFECD10F
          - Throttle: !!omap []
    - Condition: UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApiCloudWatchRoleBA34DD55: !!omap
    - Type: AWS::IAM::Role
    - Properties: !!omap
      - AssumeRolePolicyDocument: !!omap
        - Statement:
          - !!omap
            - Action: sts:AssumeRole
            - Effect: Allow
            - Principal: !!omap
              - Service: apigateway.amazonaws.com
        - Version: '2012-10-17'
      - Policies:
        - !!omap
          - PolicyDocument: !!omap
            - Statement:
              - !!omap
                - Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                  - logs:DescribeLogGroups
                  - logs:DescribeLogStreams
                  - logs:FilterLogEvents
                  - logs:GetLogEvents
                  - logs:PutLogEvents
                - Effect: Allow
                - Resource: !!omap
                  - Fn::Join:
                    - ''
                    - - 'arn:'
                      - !!omap
                        - Ref: AWS::Partition
                      - ':logs:'
                      - !!omap
                        - Ref: AWS::Region
                      - ':'
                      - !!omap
                        - Ref: AWS::AccountId
                      - :*
            - Version: '2012-10-17'
          - PolicyName: LambdaRestApiCloudWatchRolePolicy
    - Metadata: !!omap
      - guard: !!omap
        - SuppressedRules:
          - IAM_NO_INLINE_POLICY_CHECK
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: Permission generated by the ApiGatewayToLambda construct to
                allow CloudWatch Logs to be used
            - id: AwsSolutions-IAM5
            - applies_to:
              - Resource::arn:<AWS::Partition>:logs:<AWS::Region>:<AWS::AccountId>:*
    - Condition: UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApiAccount80CB17CE: !!omap
    - Type: AWS::ApiGateway::Account
    - Properties: !!omap
      - CloudWatchRoleArn: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApiCloudWatchRoleBA34DD55
          - Arn
    - DependsOn:
      - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApi9C23F7C7
    - Condition: UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseRequestValidator2EA7C91E: !!omap
    - Type: AWS::ApiGateway::RequestValidator
    - Properties: !!omap
      - Name: !!omap
        - Fn::Join:
          - ''
          - - !!omap
              - Ref: AWS::StackName
            - -api-request-validator
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApi9C23F7C7
      - ValidateRequestBody: true
      - ValidateRequestParameters: true
    - Condition: UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseEndpointWafUseCaseEndpointWafWebACL3FBA7C55: !!omap
    - Type: AWS::WAFv2::WebACL
    - Properties: !!omap
      - CustomResponseBodies: !!omap
        - HeadersNotAllowed: !!omap
          - Content: One of your injected headers is not allowed
          - ContentType: TEXT_PLAIN
      - DefaultAction: !!omap
        - Allow: !!omap []
      - Rules:
        - !!omap
          - Name: AWS-AWSManagedRulesBotControlRuleSet
          - OverrideAction: !!omap
            - None: !!omap []
          - Priority: 0
          - Statement: !!omap
            - ManagedRuleGroupStatement: !!omap
              - Name: AWSManagedRulesBotControlRuleSet
              - VendorName: AWS
          - VisibilityConfig: !!omap
            - CloudWatchMetricsEnabled: true
            - MetricName: AWSManagedRulesBotControlRuleSet
            - SampledRequestsEnabled: true
        - !!omap
          - Name: AWS-AWSManagedRulesKnownBadInputsRuleSet
          - OverrideAction: !!omap
            - None: !!omap []
          - Priority: 1
          - Statement: !!omap
            - ManagedRuleGroupStatement: !!omap
              - Name: AWSManagedRulesKnownBadInputsRuleSet
              - VendorName: AWS
          - VisibilityConfig: !!omap
            - CloudWatchMetricsEnabled: true
            - MetricName: AWSManagedRulesKnownBadInputsRuleSet
            - SampledRequestsEnabled: true
        - !!omap
          - Name: AWS-AWSManagedRulesCommonRuleSet
          - OverrideAction: !!omap
            - None: !!omap []
          - Priority: 2
          - Statement: !!omap
            - ManagedRuleGroupStatement: !!omap
              - Name: AWSManagedRulesCommonRuleSet
              - RuleActionOverrides:
                - !!omap
                  - ActionToUse: !!omap
                    - Count: !!omap []
                  - Name: SizeRestrictions_BODY
              - VendorName: AWS
          - VisibilityConfig: !!omap
            - CloudWatchMetricsEnabled: true
            - MetricName: AWS-AWSManagedRulesCommonRuleSet
            - SampledRequestsEnabled: true
        - !!omap
          - Name: AWS-AWSManagedRulesAnonymousIpList
          - OverrideAction: !!omap
            - None: !!omap []
          - Priority: 3
          - Statement: !!omap
            - ManagedRuleGroupStatement: !!omap
              - Name: AWSManagedRulesAnonymousIpList
              - VendorName: AWS
          - VisibilityConfig: !!omap
            - CloudWatchMetricsEnabled: true
            - MetricName: AWSManagedRulesAnonymousIpList
            - SampledRequestsEnabled: true
        - !!omap
          - Name: AWS-AWSManagedRulesAmazonIpReputationList
          - OverrideAction: !!omap
            - None: !!omap []
          - Priority: 4
          - Statement: !!omap
            - ManagedRuleGroupStatement: !!omap
              - Name: AWSManagedRulesAmazonIpReputationList
              - VendorName: AWS
          - VisibilityConfig: !!omap
            - CloudWatchMetricsEnabled: true
            - MetricName: AWSManagedRulesAmazonIpReputationList
            - SampledRequestsEnabled: true
        - !!omap
          - Name: AWS-AWSManagedRulesAdminProtectionRuleSet
          - OverrideAction: !!omap
            - None: !!omap []
          - Priority: 5
          - Statement: !!omap
            - ManagedRuleGroupStatement: !!omap
              - Name: AWSManagedRulesAdminProtectionRuleSet
              - VendorName: AWS
          - VisibilityConfig: !!omap
            - CloudWatchMetricsEnabled: true
            - MetricName: AWSManagedRulesAdminProtectionRuleSet
            - SampledRequestsEnabled: true
        - !!omap
          - Name: AWS-AWSManagedRulesSQLiRuleSet
          - OverrideAction: !!omap
            - None: !!omap []
          - Priority: 6
          - Statement: !!omap
            - ManagedRuleGroupStatement: !!omap
              - Name: AWSManagedRulesSQLiRuleSet
              - VendorName: AWS
          - VisibilityConfig: !!omap
            - CloudWatchMetricsEnabled: true
            - MetricName: AWSManagedRulesSQLiRuleSet
            - SampledRequestsEnabled: true
        - !!omap
          - Action: !!omap
            - Block: !!omap
              - CustomResponse: !!omap
                - CustomResponseBodyKey: HeadersNotAllowed
                - ResponseCode: 403
          - Name: Custom-BlockRequestHeaders
          - Priority: 7
          - Statement: !!omap
            - SizeConstraintStatement: !!omap
              - ComparisonOperator: GE
              - FieldToMatch: !!omap
                - SingleHeader: !!omap
                  - Name: x-amzn-requestid
              - Size: 0
              - TextTransformations:
                - !!omap
                  - Priority: 0
                  - Type: NONE
          - VisibilityConfig: !!omap
            - CloudWatchMetricsEnabled: true
            - MetricName: Custom-BlockRequestHeaders
            - SampledRequestsEnabled: true
        - !!omap
          - Action: !!omap
            - Block: !!omap []
          - Name: Custom-BlockOversizedBodyNotInDeploy
          - Priority: 8
          - Statement: !!omap
            - AndStatement: !!omap
              - Statements:
                - !!omap
                  - LabelMatchStatement: !!omap
                    - Key: awswaf:managed:aws:core-rule-set:SizeRestrictions_Body
                    - Scope: LABEL
                - !!omap
                  - NotStatement: !!omap
                    - Statement: !!omap
                      - ByteMatchStatement: !!omap
                        - FieldToMatch: !!omap
                          - UriPath: !!omap []
                        - PositionalConstraint: ENDS_WITH
                        - SearchString: /deployments
                        - TextTransformations:
                          - !!omap
                            - Priority: 0
                            - Type: NONE
          - VisibilityConfig: !!omap
            - CloudWatchMetricsEnabled: true
            - MetricName: Custom-BlockOversizedBodyNotInDeploy
            - SampledRequestsEnabled: true
      - Scope: REGIONAL
      - VisibilityConfig: !!omap
        - CloudWatchMetricsEnabled: true
        - MetricName: webACL
        - SampledRequestsEnabled: true
    - Condition: UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseEndpointWafWebACLAssociation3ACF4622: !!omap
    - Type: AWS::WAFv2::WebACLAssociation
    - Properties: !!omap
      - ResourceArn: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':apigateway:'
            - !!omap
              - Ref: AWS::Region
            - ::/restapis/
            - !!omap
              - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApi9C23F7C7
            - /stages/
            - !!omap
              - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApiDeploymentStageprodDFECD10F
      - WebACLArn: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseEndpointWafUseCaseEndpointWafWebACL3FBA7C55
          - Arn
    - Condition: UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointBadRequestDefaultResponse63BE5DCD: !!omap
    - Type: AWS::ApiGateway::GatewayResponse
    - Properties: !!omap
      - ResponseParameters: !!omap
        - gatewayresponse.header.gatewayresponse.header.Access-Control-Allow-Origin: '''*'''
        - gatewayresponse.header.gatewayresponse.header.Access-Control-Allow-Headers: '''*'''
      - ResponseType: DEFAULT_4XX
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApi9C23F7C7
      - StatusCode: '400'
    - Condition: UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointInternalServerErrorDefaultResponseFE8D9460: !!omap
    - Type: AWS::ApiGateway::GatewayResponse
    - Properties: !!omap
      - ResponseParameters: !!omap
        - gatewayresponse.header.gatewayresponse.header.Access-Control-Allow-Origin: '''*'''
        - gatewayresponse.header.gatewayresponse.header.Access-Control-Allow-Headers: '''*'''
      - ResponseType: DEFAULT_5XX
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApi9C23F7C7
      - StatusCode: '400'
    - Condition: UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointBadRequestBodyResponse0F38C01A: !!omap
    - Type: AWS::ApiGateway::GatewayResponse
    - Properties: !!omap
      - ResponseParameters: !!omap
        - gatewayresponse.header.gatewayresponse.header.Access-Control-Allow-Origin: '''*'''
        - gatewayresponse.header.gatewayresponse.header.Access-Control-Allow-Headers: '''*'''
      - ResponseTemplates: !!omap
        - application/json: '{"error":{"message":"$context.error.messageString","errors":"$context.error.validationErrorString"}}'
      - ResponseType: BAD_REQUEST_BODY
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApi9C23F7C7
      - StatusCode: '400'
    - Condition: UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointBadRequestParametersResponse73682B10: !!omap
    - Type: AWS::ApiGateway::GatewayResponse
    - Properties: !!omap
      - ResponseParameters: !!omap
        - gatewayresponse.header.gatewayresponse.header.Access-Control-Allow-Origin: '''*'''
        - gatewayresponse.header.gatewayresponse.header.Access-Control-Allow-Headers: '''*'''
      - ResponseTemplates: !!omap
        - application/json: '{"error":{"message":"$context.error.messageString","errors":"$context.error.validationErrorString"}}'
      - ResponseType: BAD_REQUEST_PARAMETERS
      - RestApiId: !!omap
        - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApi9C23F7C7
      - StatusCode: '400'
    - Condition: UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseApidetails554F399A: !!omap
    - Type: AWS::ApiGateway::Resource
    - Properties: !!omap
      - ParentId: !!omap
        - Fn::If:
          - UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
          - !!omap
            - Fn::GetAtt:
              - UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApi9C23F7C7
              - RootResourceId
          - !!omap
            - Fn::GetAtt:
              - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
              - RootResourceId
      - PathPart: details
      - RestApiId: !!omap
        - Fn::If:
          - UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
          - !!omap
            - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApi9C23F7C7
          - !!omap
            - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
    - Condition: UseCaseManagementSetupUseCaseEndpointSetupCreateApiRoutesCondition0060F23A
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseApidetailsuseCaseConfigKeyEF5B18C2: !!omap
    - Type: AWS::ApiGateway::Resource
    - Properties: !!omap
      - ParentId: !!omap
        - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseApidetails554F399A
      - PathPart: '{useCaseConfigKey}'
      - RestApiId: !!omap
        - Fn::If:
          - UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
          - !!omap
            - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApi9C23F7C7
          - !!omap
            - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
    - Condition: UseCaseManagementSetupUseCaseEndpointSetupCreateApiRoutesCondition0060F23A
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseApidetailsuseCaseConfigKeyOPTIONS0A3DA395: !!omap
    - Type: AWS::ApiGateway::Method
    - Properties: !!omap
      - ApiKeyRequired: false
      - AuthorizationType: NONE
      - HttpMethod: OPTIONS
      - Integration: !!omap
        - IntegrationResponses:
          - !!omap
            - ResponseParameters: !!omap
              - method.response.header.Access-Control-Allow-Headers: '''Content-Type,
                  Access-Control-Allow-Headers, X-Requested-With, Authorization'''
              - method.response.header.Access-Control-Allow-Origin: '''*'''
              - method.response.header.Access-Control-Allow-Methods: '''GET,OPTIONS'''
            - StatusCode: '204'
        - RequestTemplates: !!omap
          - application/json: '{ statusCode: 200 }'
        - Type: MOCK
      - MethodResponses:
        - !!omap
          - ResponseParameters: !!omap
            - method.response.header.Access-Control-Allow-Headers: true
            - method.response.header.Access-Control-Allow-Origin: true
            - method.response.header.Access-Control-Allow-Methods: true
          - StatusCode: '204'
      - ResourceId: !!omap
        - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseApidetailsuseCaseConfigKeyEF5B18C2
      - RestApiId: !!omap
        - Fn::If:
          - UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
          - !!omap
            - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApi9C23F7C7
          - !!omap
            - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
    - Condition: UseCaseManagementSetupUseCaseEndpointSetupCreateApiRoutesCondition0060F23A
  - ? UseCaseManagementSetupUseCaseEndpointSetupUseCaseApidetailsuseCaseConfigKeyGETApiPermissionDeploymentPlatformStackUseCaseManagementSetupUseCaseEndpointSetupUseCaseApi3645B980GETdetailsuseCaseConfigKey414322C3
    : !!omap
    - Type: AWS::Lambda::Permission
    - Properties: !!omap
      - Action: lambda:InvokeFunction
      - FunctionName: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseEndpointSetupUseCaseDetailsLambdaB2D6F726
          - Arn
      - Principal: apigateway.amazonaws.com
      - SourceArn: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':execute-api:'
            - !!omap
              - Ref: AWS::Region
            - ':'
            - !!omap
              - Ref: AWS::AccountId
            - ':'
            - !!omap
              - Fn::If:
                - UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
                - !!omap
                  - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApi9C23F7C7
                - !!omap
                  - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
            - /*/GET/details/*
    - Condition: UseCaseManagementSetupUseCaseEndpointSetupCreateApiRoutesCondition0060F23A
  - ? UseCaseManagementSetupUseCaseEndpointSetupUseCaseApidetailsuseCaseConfigKeyGETApiPermissionTestDeploymentPlatformStackUseCaseManagementSetupUseCaseEndpointSetupUseCaseApi3645B980GETdetailsuseCaseConfigKeyCF030818
    : !!omap
    - Type: AWS::Lambda::Permission
    - Properties: !!omap
      - Action: lambda:InvokeFunction
      - FunctionName: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseEndpointSetupUseCaseDetailsLambdaB2D6F726
          - Arn
      - Principal: apigateway.amazonaws.com
      - SourceArn: !!omap
        - Fn::Join:
          - ''
          - - 'arn:'
            - !!omap
              - Ref: AWS::Partition
            - ':execute-api:'
            - !!omap
              - Ref: AWS::Region
            - ':'
            - !!omap
              - Ref: AWS::AccountId
            - ':'
            - !!omap
              - Fn::If:
                - UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
                - !!omap
                  - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApi9C23F7C7
                - !!omap
                  - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
            - /test-invoke-stage/GET/details/*
    - Condition: UseCaseManagementSetupUseCaseEndpointSetupCreateApiRoutesCondition0060F23A
  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseApidetailsuseCaseConfigKeyGET9A40C024: !!omap
    - Type: AWS::ApiGateway::Method
    - Properties: !!omap
      - AuthorizationType: CUSTOM
      - AuthorizerId: !!omap
        - Fn::If:
          - UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
          - !!omap
            - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseEndpointAuthorizer0B1A9B7A
          - !!omap
            - Ref: UseCaseManagementSetupRequestProcessorRestCustomRequestAuthorizerCDD89059
      - HttpMethod: GET
      - Integration: !!omap
        - IntegrationHttpMethod: POST
        - PassthroughBehavior: NEVER
        - Type: AWS_PROXY
        - Uri: !!omap
          - Fn::Join:
            - ''
            - - 'arn:'
              - !!omap
                - Ref: AWS::Partition
              - ':apigateway:'
              - !!omap
                - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - !!omap
                - Fn::GetAtt:
                  - UseCaseManagementSetupUseCaseEndpointSetupUseCaseDetailsLambdaB2D6F726
                  - Arn
              - /invocations
      - OperationName: UseCaseDetails
      - RequestParameters: !!omap
        - method.request.header.authorization: true
      - RequestValidatorId: !!omap
        - Fn::If:
          - UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
          - !!omap
            - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseRequestValidator2EA7C91E
          - !!omap
            - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointRequestValidator38E09551
      - ResourceId: !!omap
        - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseApidetailsuseCaseConfigKeyEF5B18C2
      - RestApiId: !!omap
        - Fn::If:
          - UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
          - !!omap
            - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointDeploymentRestEndPointLambdaRestApi9C23F7C7
          - !!omap
            - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: A Custom authorizer must be used in order to authenticate using
                Cognito user groups
            - id: AwsSolutions-COG4
    - Condition: UseCaseManagementSetupUseCaseEndpointSetupCreateApiRoutesCondition0060F23A
  - UseCaseManagementSetupFeedbackSetupStackNestedStackFeedbackSetupStackNestedStackResourceCA537136: !!omap
    - Type: AWS::CloudFormation::Stack
    - Properties: !!omap
      - Parameters: !!omap
        - ExistingPrivateSubnetIds: !!omap
          - Fn::If:
            - DeployVPCCondition
            - !!omap
              - Fn::GetAtt:
                - VPCDeploymentPlatformVPCNestedStackDeploymentPlatformVPCNestedStackResource186D2208
                - Outputs.PrivateSubnetIds
            - !!omap
              - Fn::Join:
                - ','
                - !!omap
                  - Ref: ExistingPrivateSubnetIds
        - ExistingSecurityGroupIds: !!omap
          - Fn::If:
            - DeployVPCCondition
            - !!omap
              - Fn::GetAtt:
                - VPCDeploymentPlatformVPCNestedStackDeploymentPlatformVPCNestedStackResource186D2208
                - Outputs.SecurityGroupIds
            - !!omap
              - Fn::Join:
                - ','
                - !!omap
                  - Ref: ExistingSecurityGroupIds
        - CustomResourceLambdaArn: !!omap
          - Fn::GetAtt:
            - DeploymentPlatformSetupInfraSetupCustomResource5473231F
            - Arn
        - CustomResourceRoleArn: !!omap
          - Fn::GetAtt:
            - DeploymentPlatformSetupCustomResourceLambdaRole3C444A9D
            - Arn
        - AccessLoggingBucketArn: !!omap
          - Fn::GetAtt:
            - DeploymentPlatformSetupAccessLog67D5D503
            - Arn
        - FeedbackEnabled: Yes
        - ExistingRestApiId: !!omap
          - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
        - ExistingApiRootResourceId: !!omap
          - Fn::GetAtt:
            - UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
            - RootResourceId
        - StackDeploymentSource: DeploymentPlatform
        - ? referencetoDeploymentPlatformStackUseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource1C4303B0OutputsDeploymentPlatformStackUseCaseManagementSetupUseCaseManagementUseCaseManagementDLQ5E4F3FEAArn
          : !!omap
          - Fn::GetAtt:
            - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
            - Outputs.DeploymentPlatformStackUseCaseManagementSetupUseCaseManagementUseCaseManagementDLQ5E4F3FEAArn
        - ? referencetoDeploymentPlatformStackDeploymentPlatformStorageDeploymentPlatformStorageNestedStackDeploymentPlatformStorageNestedStackResource0080A447OutputsDeploymentPlatformStackDeploymentPlatformStorageLLMConfigTable9EB214F1Arn
          : !!omap
          - Fn::GetAtt:
            - DeploymentPlatformStorageDeploymentPlatformStorageNestedStackDeploymentPlatformStorageNestedStackResourceF56260D3
            - Outputs.DeploymentPlatformStackDeploymentPlatformStorageLLMConfigTable9EB214F1Arn
        - ? referencetoDeploymentPlatformStackDeploymentPlatformStorageDeploymentPlatformStorageNestedStackDeploymentPlatformStorageNestedStackResource0080A447OutputsDeploymentPlatformStackDeploymentPlatformStorageUseCasesTable8AE1DCF5Arn
          : !!omap
          - Fn::GetAtt:
            - DeploymentPlatformStorageDeploymentPlatformStorageNestedStackDeploymentPlatformStorageNestedStackResourceF56260D3
            - Outputs.DeploymentPlatformStackDeploymentPlatformStorageUseCasesTable8AE1DCF5Arn
        - ? referencetoDeploymentPlatformStackDeploymentPlatformStorageDeploymentPlatformStorageNestedStackDeploymentPlatformStorageNestedStackResource0080A447OutputsDeploymentPlatformStackDeploymentPlatformStorageLLMConfigTable9EB214F1Ref
          : !!omap
          - Fn::GetAtt:
            - DeploymentPlatformStorageDeploymentPlatformStorageNestedStackDeploymentPlatformStorageNestedStackResourceF56260D3
            - Outputs.DeploymentPlatformStackDeploymentPlatformStorageLLMConfigTable9EB214F1Ref
        - ? referencetoDeploymentPlatformStackDeploymentPlatformStorageDeploymentPlatformStorageNestedStackDeploymentPlatformStorageNestedStackResource0080A447OutputsDeploymentPlatformStackDeploymentPlatformStorageUseCasesTable8AE1DCF5Ref
          : !!omap
          - Fn::GetAtt:
            - DeploymentPlatformStorageDeploymentPlatformStorageNestedStackDeploymentPlatformStorageNestedStackResourceF56260D3
            - Outputs.DeploymentPlatformStackDeploymentPlatformStorageUseCasesTable8AE1DCF5Ref
        - referencetoDeploymentPlatformStackAwsNodeSdkLayer390CBFFFRef: !!omap
          - Ref: AwsNodeSdkLayer42C7A59C
        - referencetoDeploymentPlatformStackNodeUserAgentLayer24384C79Ref: !!omap
          - Ref: NodeUserAgentLayer02526341
        - ? referencetoDeploymentPlatformStackUseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApi854B9E90Ref
          : !!omap
          - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
        - referencetoDeploymentPlatformStackRegistrySetup483F1675Id: !!omap
          - Fn::GetAtt:
            - RegistrySetupCC2515F0
            - Id
      - TemplateURL: !!omap
        - Fn::Join:
          - ''
          - - https://solutions-reference.s3.
            - !!omap
              - Ref: AWS::URLSuffix
            - /
            - generative-ai-application-builder-on-aws/v3.0.0/DeploymentPlatformStackUseCaseManagementSetupFeedbackSetupStack5DB20D5D.nested.template
    - DependsOn:
      - RegistrySetupCC2515F0
    - UpdateReplacePolicy: Delete
    - DeletionPolicy: Delete
    - Metadata: !!omap
      - aws:asset:path: DeploymentPlatformStackUseCaseManagementSetupFeedbackSetupStack5DB20D5D.nested.template.json
      - aws:asset:property: TemplateURL
  - WebConfig: !!omap
    - Type: Custom::WriteWebConfig
    - Properties: !!omap
      - ServiceToken: !!omap
        - Fn::GetAtt:
          - DeploymentPlatformSetupInfraSetupCustomResource5473231F
          - Arn
      - Resource: WEBCONFIG
      - SSMKey: !!omap
        - Fn::Join:
          - ''
          - - /gaab-webconfig/
            - !!omap
              - Ref: AWS::StackName
      - UserPoolId: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
          - Outputs.DeploymentPlatformCognitoSetupUserPoolId0A73EB1C
      - UserPoolClientId: !!omap
        - Fn::GetAtt:
          - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
          - Outputs.DeploymentPlatformCognitoSetupUserPoolClientIdFE2BD0AE
      - CognitoRedirectUrl: !!omap
        - Fn::If:
          - DeployWebAppUIInfrastructureCondition
          - !!omap
            - Fn::Join:
              - ''
              - - https://
                - !!omap
                  - Fn::GetAtt:
                    - WebAppNestedStackWebAppNestedStackResource4E994CA7
                    - Outputs.DeploymentPlatformStackWebAppWebsiteUICloudFrontDistribution38CBCDC5DomainName
          - !!omap
            - Ref: AWS::NoValue
      - IsInternalUser: !!omap
        - Fn::If:
          - IsInternalUserCondition
          - true
          - false
      - RestApiEndpoint: !!omap
        - Fn::Join:
          - ''
          - - https://
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
            - .execute-api.
            - !!omap
              - Ref: AWS::Region
            - .
            - !!omap
              - Ref: AWS::URLSuffix
            - /
            - !!omap
              - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiDeploymentStageprodE2564A5F
            - /
    - DependsOn:
      - DeploymentPlatformSetupGetCognitoUserPoolInfo2A3390CD
      - DeploymentPlatformSetupWriteToSSMBE1096BE
      - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
    - UpdateReplacePolicy: Delete
    - DeletionPolicy: Delete
  - CopyUICustomResourceNestedStackCopyUICustomResourceNestedStackResource298D3A15: !!omap
    - Type: AWS::CloudFormation::Stack
    - Properties: !!omap
      - Parameters: !!omap
        - CustomResourceRoleArn: !!omap
          - Fn::GetAtt:
            - DeploymentPlatformSetupCustomResourceLambdaRole3C444A9D
            - Arn
        - CustomResourceLambdaArn: !!omap
          - Fn::GetAtt:
            - DeploymentPlatformSetupInfraSetupCustomResource5473231F
            - Arn
        - WebConfigKey: !!omap
          - Fn::Join:
            - ''
            - - /gaab-webconfig/
              - !!omap
                - Ref: AWS::StackName
        - WebS3BucketArn: !!omap
          - Fn::GetAtt:
            - WebAppNestedStackWebAppNestedStackResource4E994CA7
            - Outputs.DeploymentPlatformStackWebAppWebsiteBucketF87806D4Arn
        - AccessLoggingBucketArn: !!omap
          - Fn::GetAtt:
            - DeploymentPlatformSetupAccessLog67D5D503
            - Arn
        - referencetoDeploymentPlatformStackRegistrySetup483F1675Id: !!omap
          - Fn::GetAtt:
            - RegistrySetupCC2515F0
            - Id
      - TemplateURL: !!omap
        - Fn::Join:
          - ''
          - - https://solutions-reference.s3.
            - !!omap
              - Ref: AWS::URLSuffix
            - /
            - generative-ai-application-builder-on-aws/v3.0.0/DeploymentPlatformStackCopyUICustomResource964AC335.nested.template
    - DependsOn:
      - DeploymentPlatformSetupAccessLogPolicy2FB262B2
      - RegistrySetupCC2515F0
      - WebConfig
    - UpdateReplacePolicy: Delete
    - DeletionPolicy: Delete
    - Metadata: !!omap
      - aws:asset:path: DeploymentPlatformStackCopyUICustomResource964AC335.nested.template.json
      - aws:asset:property: TemplateURL
    - Condition: DeployWebAppUIInfrastructureCondition
  - RegistrySetupCC2515F0: !!omap
    - Type: AWS::ServiceCatalogAppRegistry::Application
    - Properties: !!omap
      - Description: Service Catalog application to track and manage all your resources
          for the solution generative-ai-application-builder-on-aws
      - Name: !!omap
        - Fn::Join:
          - ''
          - - App-GAAB-Dashboard-
            - !!omap
              - Ref: AWS::StackName
      - Tags: !!omap
        - Solutions:ApplicationType: AWS-Solutions
        - Solutions:SolutionID: SO0276
        - Solutions:SolutionName: generative-ai-application-builder-on-aws
        - Solutions:SolutionVersion: v3.0.0
  - AppRegistryAssociation: !!omap
    - Type: AWS::ServiceCatalogAppRegistry::ResourceAssociation
    - Properties: !!omap
      - Application: !!omap
        - Fn::GetAtt:
          - RegistrySetupCC2515F0
          - Id
      - Resource: !!omap
        - Ref: AWS::StackId
      - ResourceType: CFN_STACK
  - AppAttributesC4C8180E: !!omap
    - Type: AWS::ServiceCatalogAppRegistry::AttributeGroup
    - Properties: !!omap
      - Attributes: !!omap
        - applicationType: AWS-Solutions
        - version: v3.0.0
        - solutionID: SO0276
        - solutionName: generative-ai-application-builder-on-aws
      - Description: Attributes for Solutions Metadata
      - Name: !!omap
        - Fn::Join:
          - ''
          - - AttrGrp-
            - !!omap
              - Ref: AWS::StackName
  - AppAttributesApplicationAttributeGroupAssociation5d45ed99601285052111: !!omap
    - Type: AWS::ServiceCatalogAppRegistry::AttributeGroupAssociation
    - Properties: !!omap
      - Application: !!omap
        - Fn::GetAtt:
          - RegistrySetupCC2515F0
          - Id
      - AttributeGroup: !!omap
        - Fn::GetAtt:
          - AppAttributesC4C8180E
          - Id
  - CustomMetricsPolicyFE11102D: !!omap
    - Type: AWS::IAM::Policy
    - Properties: !!omap
      - PolicyDocument: !!omap
        - Statement:
          - !!omap
            - Action: cloudwatch:PutMetricData
            - Condition: !!omap
              - StringEquals: !!omap
                - cloudwatch:namespace:
                  - AWS/ApiGateway
                  - AWS/Kendra
                  - AWS/Cognito
                  - Langchain/LLM
                  - AWS/Bedrock
            - Effect: Allow
            - Resource: '*'
        - Version: '2012-10-17'
      - PolicyName: CustomMetricsPolicyFE11102D
      - Roles:
        - !!omap
          - Ref: DeploymentPlatformSetupCustomResourceLambdaRole3C444A9D
        - !!omap
          - Ref: UseCaseManagementSetupRequestProcessorRestAuthorizerRole9B42FEFC
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: This policy allows put metric data to CloudWatch. The policy
                is restricted using policy conditions.
            - id: AwsSolutions-IAM5
            - applies_to:
              - Resource::*
  - PythonUserAgentLayer6958F3C0: !!omap
    - Type: AWS::Lambda::LayerVersion
    - Properties: !!omap
      - CompatibleRuntimes:
        - python3.11
        - python3.13
      - Content: !!omap
        - S3Bucket: !!omap
          - Fn::Sub: solutions-${AWS::Region}
        - S3Key: generative-ai-application-builder-on-aws/v3.0.0/assetb93f4b1b7284d404b083509917b72f550054d82f02c86eb9ac55b1c6cc618ad3.zip
      - Description: This layer configures AWS Python SDK initialization to send user-agent
          information
    - Metadata: !!omap
      - aws:asset:path: asset.b93f4b1b7284d404b083509917b72f550054d82f02c86eb9ac55b1c6cc618ad3
      - aws:asset:is-bundled: true
      - aws:asset:property: Content
  - Boto3Layer463A0AEA: !!omap
    - Type: AWS::Lambda::LayerVersion
    - Properties: !!omap
      - CompatibleRuntimes:
        - python3.11
        - python3.13
      - Content: !!omap
        - S3Bucket: !!omap
          - Fn::Sub: solutions-${AWS::Region}
        - S3Key: generative-ai-application-builder-on-aws/v3.0.0/asset9d2cc5e521e687f30ba9f3a3eed99ba7ee9c6be0117b77d7d52c937ebc24db58.zip
      - Description: Boto3 layer to be bundled with python lambda functions
    - Metadata: !!omap
      - aws:asset:path: asset.9d2cc5e521e687f30ba9f3a3eed99ba7ee9c6be0117b77d7d52c937ebc24db58
      - aws:asset:is-bundled: true
      - aws:asset:property: Content
  - CustomMetricsPolicyAnonymousDataAWSConditionA2CDA901: !!omap
    - Type: AWS::IAM::Policy
    - Properties: !!omap
      - PolicyDocument: !!omap
        - Statement:
          - !!omap
            - Action: cloudwatch:PutMetricData
            - Condition: !!omap
              - StringEquals: !!omap
                - cloudwatch:namespace:
                  - AWS/ApiGateway
                  - AWS/Kendra
                  - AWS/Cognito
                  - Langchain/LLM
                  - AWS/Bedrock
            - Effect: Allow
            - Resource: '*'
        - Version: '2012-10-17'
      - PolicyName: CustomMetricsPolicyAnonymousDataAWSConditionA2CDA901
      - Roles:
        - !!omap
          - Ref: DeploymentPlatformSetupScheduledMetricsLambdaRole89420F9F
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: This policy allows put metric data to CloudWatch. The policy
                is restricted using policy conditions.
            - id: AwsSolutions-IAM5
            - applies_to:
              - Resource::*
    - Condition: AnonymousDataAWSCondition
  - NodeUserAgentLayer02526341: !!omap
    - Type: AWS::Lambda::LayerVersion
    - Properties: !!omap
      - CompatibleRuntimes:
        - nodejs18.x
        - nodejs22.x
      - Content: !!omap
        - S3Bucket: !!omap
          - Fn::Sub: solutions-${AWS::Region}
        - S3Key: generative-ai-application-builder-on-aws/v3.0.0/asseta295706e8a7d55b013ae2416ecd8dc9d10120055dab2fa7702de18897b268c99.zip
      - Description: This layer configures AWS Node SDK initialization to send user-agent
          information
    - Metadata: !!omap
      - aws:asset:path: asset.a295706e8a7d55b013ae2416ecd8dc9d10120055dab2fa7702de18897b268c99
      - aws:asset:is-bundled: true
      - aws:asset:property: Content
  - AwsNodeSdkLayer42C7A59C: !!omap
    - Type: AWS::Lambda::LayerVersion
    - Properties: !!omap
      - CompatibleRuntimes:
        - nodejs18.x
        - nodejs22.x
      - Content: !!omap
        - S3Bucket: !!omap
          - Fn::Sub: solutions-${AWS::Region}
        - S3Key: generative-ai-application-builder-on-aws/v3.0.0/asset3fad5600efa590db28dd1a04dbbfe499fdf4b2fdb9db96999034d909b5ab2725.zip
      - Description: AWS Javascript SDK v3 to be bundled with lambda functions as
          a layer
    - Metadata: !!omap
      - aws:asset:path: asset.3fad5600efa590db28dd1a04dbbfe499fdf4b2fdb9db96999034d909b5ab2725
      - aws:asset:is-bundled: true
      - aws:asset:property: Content
  - CustomMetricsPolicyCreateApiRoutesConditionF3852927: !!omap
    - Type: AWS::IAM::Policy
    - Properties: !!omap
      - PolicyDocument: !!omap
        - Statement:
          - !!omap
            - Action: cloudwatch:PutMetricData
            - Condition: !!omap
              - StringEquals: !!omap
                - cloudwatch:namespace:
                  - AWS/ApiGateway
                  - AWS/Kendra
                  - AWS/Cognito
                  - Langchain/LLM
                  - AWS/Bedrock
            - Effect: Allow
            - Resource: '*'
        - Version: '2012-10-17'
      - PolicyName: CustomMetricsPolicyCreateApiRoutesConditionF3852927
      - Roles:
        - !!omap
          - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseDetailsRole5FD36A48
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: This policy allows put metric data to CloudWatch. The policy
                is restricted using policy conditions.
            - id: AwsSolutions-IAM5
            - applies_to:
              - Resource::*
    - Condition: UseCaseManagementSetupUseCaseEndpointSetupCreateApiRoutesCondition0060F23A
  - CustomMetricsPolicyCreateApiResourcesCondition3E7A1DEA: !!omap
    - Type: AWS::IAM::Policy
    - Properties: !!omap
      - PolicyDocument: !!omap
        - Statement:
          - !!omap
            - Action: cloudwatch:PutMetricData
            - Condition: !!omap
              - StringEquals: !!omap
                - cloudwatch:namespace:
                  - AWS/ApiGateway
                  - AWS/Kendra
                  - AWS/Cognito
                  - Langchain/LLM
                  - AWS/Bedrock
            - Effect: Allow
            - Resource: '*'
        - Version: '2012-10-17'
      - PolicyName: CustomMetricsPolicyCreateApiResourcesCondition3E7A1DEA
      - Roles:
        - !!omap
          - Ref: UseCaseManagementSetupUseCaseEndpointSetupUseCaseRestEndpointUseCaseRestAuthorizerRoleB2D1238D
    - Metadata: !!omap
      - cdk_nag: !!omap
        - rules_to_suppress:
          - !!omap
            - reason: This policy allows put metric data to CloudWatch. The policy
                is restricted using policy conditions.
            - id: AwsSolutions-IAM5
            - applies_to:
              - Resource::*
    - Condition: UseCaseManagementSetupCreateApiResourcesConditionF9F71A85
  - CDKMetadata: !!omap
    - Type: AWS::CDK::Metadata
    - Properties: !!omap
      - Analytics: v2:deflate64:H4sIAAAAAAAA/3VTwW7bMAz9lt5ltU2HdbvNTbBeUixzs/VY0DLrqJElV5QSZIL/fbCkJG6xXaL3nhmRfKRmPFx/nfGrC9hTIZptoWTNw6MDsWXzF70CCx06tCOZG91IJ40eSeUVMtjTc6AbHu682KIb9YzSsTJKisNZzjyROyAcmISOh3NcRpVRGLMYhQNT0NUN8PDda3HMP8UrtJ0kGtlRHi9nSzig/Y2WctyUD4xunoEIHfFyPBjuUDviIXaWOxyYUMY3e3Biw8MCaFMbsM34+UQGBr1sweEeDjxU+OaRXOndxlj5Jzk3YcvYSzWG9DKmyXCBvTKHDnW0ccIeHbSxoAQqJOOtwNjhkeSLEn5AtzGxxox+EbS4UhBNeEdKIYzXjuWqf4OSDThj030ftPvUY4XUG00x50fpwTSoYuYIcm9p0sq0xMPStPfW+D7OI+OB7eFlN+Nh/qKfsC7nS3ZCJZERElwa2Rvx8NOjj8kTiL/nBZrQgTUHDZ1par6GWiXHCO1OChTgQJkW+t5iK8nZQ8xe9r2SAk5Lni2dFBFdc87K2js8dfJemdY8sLhd4+ykbtnckzPdP8c2FU8P8Id3vY8b8QB9L3U7sNtP/Ori2/heySg/JqFCGE3OeuHocvwQ0ospTv2nrVubRRQWd5OVLfLrKnuZp7k2KXycyh5rEKqYbPjTUVyb818Gdv35ls8KUP0GjuWJZhur+a/lOTxMXX/v5DAwbRrkr3S5m13x6y98dvFKUhbWayc75FU6/wJbOYJMxwQAAA==
    - Condition: CDKMetadataAvailable
- Outputs: !!omap
  - VpcId: !!omap
    - Description: The ID of the VPC
    - Value: !!omap
      - Fn::If:
        - DeployVPCCondition
        - !!omap
          - Fn::GetAtt:
            - VPCDeploymentPlatformVPCNestedStackDeploymentPlatformVPCNestedStackResource186D2208
            - Outputs.VpcId
        - !!omap
          - Ref: ExistingVpcId
    - Condition: VPCEnabledCondition
  - PrivateSubnetIds: !!omap
    - Description: Comma separated list of private subnet ids
    - Value: !!omap
      - Fn::If:
        - DeployVPCCondition
        - !!omap
          - Fn::GetAtt:
            - VPCDeploymentPlatformVPCNestedStackDeploymentPlatformVPCNestedStackResource186D2208
            - Outputs.PrivateSubnetIds
        - !!omap
          - Fn::Join:
            - ','
            - !!omap
              - Ref: ExistingPrivateSubnetIds
    - Condition: VPCEnabledCondition
  - SecurityGroupIds: !!omap
    - Description: Security group for the lambda functions in the VPC
    - Value: !!omap
      - Fn::If:
        - DeployVPCCondition
        - !!omap
          - Fn::GetAtt:
            - VPCDeploymentPlatformVPCNestedStackDeploymentPlatformVPCNestedStackResource186D2208
            - Outputs.SecurityGroupIds
        - !!omap
          - Fn::Join:
            - ','
            - !!omap
              - Ref: ExistingSecurityGroupIds
    - Condition: VPCEnabledCondition
  - AvailabilityZones: !!omap
    - Description: Comma separated list of AZs in which subnets of the VPCs are created
    - Value: !!omap
      - Fn::If:
        - DeployVPCCondition
        - !!omap
          - Fn::GetAtt:
            - VPCDeploymentPlatformVPCNestedStackDeploymentPlatformVPCNestedStackResource186D2208
            - Outputs.AvailabilityZones
        - !!omap
          - Fn::Join:
            - ','
            - !!omap
              - Ref: VpcAzs
    - Condition: VPCEnabledCondition
  - WebConfigKey: !!omap
    - Value: !!omap
      - Fn::Join:
        - ''
        - - /gaab-webconfig/
          - !!omap
            - Ref: AWS::StackName
  - CloudFrontWebUrl: !!omap
    - Value: !!omap
      - Fn::Join:
        - ''
        - - https://
          - !!omap
            - Fn::GetAtt:
              - WebAppNestedStackWebAppNestedStackResource4E994CA7
              - Outputs.DeploymentPlatformStackWebAppWebsiteUICloudFrontDistribution38CBCDC5DomainName
    - Condition: DeployWebAppUIInfrastructureCondition
  - CognitoClientId: !!omap
    - Value: !!omap
      - Fn::GetAtt:
        - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
        - Outputs.DeploymentPlatformCognitoSetupUserPoolClientIdFE2BD0AE
  - CognitoUserPoolId: !!omap
    - Value: !!omap
      - Fn::GetAtt:
        - UseCaseManagementSetupUseCaseManagementNestedStackUseCaseManagementNestedStackResource7ED7E421
        - Outputs.DeploymentPlatformCognitoSetupUserPoolId0A73EB1C
  - RestEndpointUrl: !!omap
    - Value: !!omap
      - Fn::Join:
        - ''
        - - https://
          - !!omap
            - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiF86B015F
          - .execute-api.
          - !!omap
            - Ref: AWS::Region
          - .
          - !!omap
            - Ref: AWS::URLSuffix
          - /
          - !!omap
            - Ref: UseCaseManagementSetupRequestProcessorDeploymentRestEndpointDeploymentRestEndPointLambdaRestApiDeploymentStageprodE2564A5F
          - /
  - LLMConfigTableName: !!omap
    - Value: !!omap
      - Fn::GetAtt:
        - DeploymentPlatformStorageDeploymentPlatformStorageNestedStackDeploymentPlatformStorageNestedStackResourceF56260D3
        - Outputs.DeploymentPlatformStackDeploymentPlatformStorageLLMConfigTable9EB214F1Ref
  - UseCasesTableName: !!omap
    - Value: !!omap
      - Fn::GetAtt:
        - DeploymentPlatformStorageDeploymentPlatformStorageNestedStackDeploymentPlatformStorageNestedStackResourceF56260D3
        - Outputs.DeploymentPlatformStackDeploymentPlatformStorageUseCasesTable8AE1DCF5Ref
- Mappings: !!omap
  - Solution: !!omap
    - Data: !!omap
      - SendAnonymousUsageData: Yes
      - ID: SO0276
      - Version: v3.0.0
      - SolutionName: generative-ai-application-builder-on-aws
  - FeaturesToDeploy: !!omap
    - Deploy: !!omap
      - CustomDashboard: Yes
  - SourceCode: !!omap
    - General: !!omap
      - S3Bucket: solutions
      - KeyPrefix: generative-ai-application-builder-on-aws/v3.0.0
      - SolNamePrefix: generative-ai-application-builder-on-aws
